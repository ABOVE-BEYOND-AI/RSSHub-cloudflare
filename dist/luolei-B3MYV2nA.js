import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import{load as o}from"cheerio";const s=e=>(e(`img[data-original-src]`).each((n,i)=>{i=e(i),i.replaceWith(t(a.join(r,`templates/description-8179d61b.art`),{images:[{src:i.prop(`data-original-src`)}]}))}),e),c=async t=>{let r=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):50,a=`https://luolei.org`,{data:c}=await i(a),l=o(c),u=l(`html`).prop(`lang`),d=l(`link[rel="modulepreload"]`).toArray().findLast(e=>/theme\..*\.js$/.test(l(e).prop(`href`))),f=d?new URL(l(d).prop(`href`),a).href:void 0,{data:p}=await i(f),m=p.match(/{"title":".*?"string":".*?"}}/g).slice(0,r).map(e=>{e=JSON.parse(e.replaceAll(String.raw`\\"`,String.raw`\"`).replaceAll(String.raw`\\n`,``).replaceAll("\\`","`"));let t=s(o(e.excerpt)),r=e.title,i=t.html(),c=e.cover;return{title:r,description:i,pubDate:n(e.date.time,`x`),link:new URL(e.url,a).href,category:e.categories,author:e.author,content:{html:i,text:i},image:c,banner:c,language:u}});m=await Promise.all(m.map(t=>e.tryGet(t.link,async()=>{if(t.description.length>40)return t;let{data:e}=await i(t.link),n=s(o(e));n(`div.tweet-card`).remove();let r=n(`h2`).first().text(),a=n(`div.vp-doc`).html();return t.title=r,t.description=a,t.content={html:a,text:n(`div.vp-doc`).text()},t.language=u,t})));let h=new URL(l(`img.logo`).prop(`src`),a).href;return{title:l(`title`).first().text(),description:l(`meta[name="description"]`).prop(`content`),link:a,item:m,allowEmpty:!0,image:h,author:l(`meta[property="og:title"]`).prop(`content`),language:u}},l={path:`/`,name:`罗磊的独立博客`,url:`luolei.org`,maintainers:[`nczitzk`],handler:c,example:`/luolei`,description:``,categories:[`blog`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`luolei.org`],target:`/`}]};export{c as handler,l as route};