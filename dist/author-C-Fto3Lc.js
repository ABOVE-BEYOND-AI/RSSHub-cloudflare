import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{got_default as a}from"./got-BaOFZRd4.js";import o from"node:path";import{load as s}from"cheerio";const c={path:`/news/author/:mid`,categories:[`new-media`],example:`/tencent/news/author/5933889`,parameters:{mid:`企鹅号 ID`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{title:`当前作者文章`,source:[`news.qq.com/omn/author/:mid`]}],name:`作者`,maintainers:[`LogicJake`,`miles170`],handler:l};async function l(c){let l=c.req.param(`mid`),u=/^\d+$/.test(l)?`chlid`:`guestSuid`,d=`https://i.news.qq.com/i/getUserHomepageInfo?${u}=${l}`,f=await t.tryGet(d,async()=>(await a(d)).data.userinfo),p=f.nick,m=f.user_desc,h=encodeURIComponent(f.suid),g=`https://i.news.qq.com/getSubNewsMixedList?guestSuid=${h}&tabId=om_index`,_=await t.tryGet(g,async()=>(await a(g)).data.newslist,e.cache.routeExpire,!1),v=await Promise.all(_.map(e=>{let c=e.title,l=r(e.timestamp,`X`),u=e.url,d=e.source,f=e.abstract;return e.articletype===`4`||e.articletype===`118`?{title:c,description:`<a href=${e.url}><img src="${e.articletype===`4`?e.miniProShareImage:e.miniVideoPic}" style="width: 100%"></a>`,link:u,author:d,pubDate:l}:t.tryGet(u,async()=>{let e=await a(u),t=s(e.data),r=JSON.parse(t(`script:contains("window.DATA")`).text().match(/window\.DATA = ({.+});/)[1]),p=s(r.originContent?.text||``,null,!1);return p&&p(`*`).contents().filter((e,t)=>t.type===`comment`).replaceWith((e,t)=>n(o.join(i,`templates/image-65e537e7.art`),{attribute:t.data.trim(),originAttribute:r.originAttribute})),{title:c,description:p.html()||f,link:u,author:d,pubDate:l}})}));return{title:p,description:m,link:`https://new.qq.com/omn/author/${l}`,item:v,image:f?.shareImg}}export{c as route};