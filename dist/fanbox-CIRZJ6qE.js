import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import{ofetch_default as i}from"./ofetch-DRl42yaJ.js";import{__dirname as a}from"./esm-shims-BDPl6Msv.js";import{invalid_parameter_default as o}from"./invalid-parameter-CfUmvEUg.js";import{isValidHost as s}from"./valid-host-JqD2S4D4.js";import c from"node:path";function l(){let t=e.fanbox.session,n=t?`FANBOXSESSID=${t}`:``;return{origin:`https://fanbox.cc`,cookie:n}}function u(e){switch(e.type){case`html`:return e.html;case`fanbox.post`:return n(c.join(a,`templates/fanbox-post-12425d7b.art`),{postUrl:`https://${e.postInfo.creatorId}.fanbox.cc/posts/${e.postInfo.id}`,title:e.postInfo.title,user:e.postInfo.user,excerpt:e.postInfo.excerpt});default:return``}}function d(e){let t=[...e.text];e.styles&&e.styles.map(e=>{switch(e.type){case`bold`:t[e.offset]=`<b>`+t[e.offset],t[e.offset+e.length-1]+=`</b>`;break;default:}return e}),e.links&&e.links.map(e=>(t[e.offset]=`<a href="${e.url}">`+t[e.offset],t[e.offset+e.length-1]+=`</a>`,e));let n=t.join(``);return n}function f(e){return e.text||``}function p(e){let t=e.text||``;for(let n of e.images)t+=`<hr><img src="${n.originalUrl}">`;return t}function m(e){let t=e.text||``;for(let n of e.files)t+=`<br><a href="${n.url}" download="${n.name}.${n.extension}">${n.name}.${n.extension}</a>`;return t}async function h(e){let t=``;switch(e.video.serviceProvider){case`soundcloud`:t+=await y(e.video.videoId);break;case`youtube`:t+=`<iframe src="https://www.youtube-nocookie.com/embed/${e.video.videoId}" frameborder="0"></iframe>`;break;case`vimeo`:t+=`<iframe src="https://player.vimeo.com/video/${e.video.videoId}" frameborder="0"></iframe>`;break;default:}return t+=`<br>${e.text}`,t}async function g(e){let t=[];for(let n=0;n<e.blocks.length;++n){let r=e.blocks[n];switch(t.push(`<p>`),r.type){case`p`:t.push(d(r));break;case`header`:t.push(`<h2>${r.text}</h2>`);break;case`image`:{let n=e.imageMap[r.imageId];t.push(`<img src="${n.originalUrl}">`);break}case`file`:{let n=e.fileMap[r.fileId];t.push(`<a href="${n.url}" download="${n.name}.${n.extension}">${n.name}.${n.extension}</a>`);break}case`url_embed`:t.push(u(e.urlEmbedMap[r.urlEmbedId]));break;default:}}return t=await Promise.all(t),t.join(``)}async function _(e){let t=``;if(e.feeRequired!==0&&(t+=`Fee Required: <b>${e.feeRequired} JPY/month</b><hr>`),e.coverImageUrl&&(t+=`<img src="${e.coverImageUrl}"><hr>`),!e.body)return t+=e.excerpt,t;switch(e.type){case`text`:t+=f(e.body);break;case`file`:t+=m(e.body);break;case`image`:t+=p(e.body);break;case`video`:t+=await h(e.body);break;case`article`:t+=await g(e.body);break;default:t+=`<b>Unsupported content (RSSHub)</b>`}return t}function v(n){return t.tryGet(`fanbox-${n.id}-${n.updatedDatetime}`,async()=>{let t=await i(`https://api.fanbox.cc/post.info?postId=${n.id}`,{headers:{...l(),"User-Agent":e.trueUA}});return{title:n.title||`No title`,description:await _(t.body),pubDate:r(n.updatedDatetime),link:`https://${n.creatorId}.fanbox.cc/posts/${n.id}`,category:n.tags}})}async function y(e){let t=`https://soundcloud.com/${e}`,n=`https://soundcloud.com/oembed?url=${encodeURIComponent(t)}&format=json&maxheight=400&format=json`,r=await i(n);return r.html}const b={path:`/:creator`,categories:[`social-media`],example:`/fanbox/official`,parameters:{creator:`fanbox user name`},maintainers:[`KarasuShin`],name:`Creator`,handler:x,features:{requireConfig:[{name:`FANBOX_SESSION_ID`,description:`Required for private posts. Can be found in browser DevTools -> Application -> Cookies -> https://www.fanbox.cc -> FANBOXSESSID`,optional:!0}],nsfw:!0}};async function x(e){let t=e.req.param(`creator`);if(!s(t))throw new o(`Invalid user name`);let n=`Fanbox - ${t}`,r,a;try{let e=`https://api.fanbox.cc/creator.get?creatorId=${t}`,o=await i(e,{headers:l()});n=`Fanbox - ${o.body.user.name}`,r=o.body.description,a=o.body.user.iconUrl}catch{}let c=await i(`https://api.fanbox.cc/post.listCreator?creatorId=${t}&limit=20`,{headers:l()}),u=await Promise.all(c.body.map(e=>v(e)));return{title:n,link:`https://${t}.fanbox.cc`,description:r,image:a,item:u}}export{b as route};