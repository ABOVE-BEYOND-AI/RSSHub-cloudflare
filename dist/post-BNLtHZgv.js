import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{getSubPath as n}from"./common-utils-C27Jp3s6.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import{load as o}from"cheerio";const s={path:`*`,name:`Unknown`,maintainers:[],handler:c};async function c(s){let c=s.req.query(`limit`)?Number.parseInt(s.req.query(`limit`),10):50,l=`https://aqara.com`,u=`wp-json/wp/v2`,d,f=l,p=new URL(`${u}/posts?_embed=true&per_page=${c}`,l).href,m=n(s).match(/^\/([^/]*)\/([^/]*)\/(.*)$/);if(m){let e=m[1],t=m[2]===`tag`?`tags`:m[2]===`category`?`categories`:m[2],n=decodeURI(m[3].split(`/`).pop()),r=new URL(`${e}/${u}/${t}?search=${n}`,l).href,{data:a}=await i(r),o=a.pop();(o?.id??void 0)&&(d=o.name??n,f=o.link??f,p=new URL(`${e}/${u}/posts?_embed=true&per_page=${c}&${t}=${o.id}`,l).href)}let{data:h}=await i(p),g=h.slice(0,c).map(n=>{let i=n._embedded[`wp:term`],s=o(n.content?.rendered??n.content);return s(`figure`).each(function(){let t=s(this).find(`img`),n=(t.prop(`data-actualsrc`)??t.prop(`data-original`)??t.prop(`src`)).replace(/(-\d+x\d+)/,``),i=t.prop(`data-rawwidth`)??t.prop(`width`),o=t.prop(`data-rawheight`)??t.prop(`height`);s(this).replaceWith(e(a.join(r,`templates/figure-954623e8.art`),{src:n,width:i,height:o}))}),{title:n.title?.rendered??n.title,link:n.link,description:s.html(),author:n._embedded.author.map(e=>e.name).join(`/`),category:i.flat().map(e=>e.name),guid:n.guid?.rendered??n.guid,pubDate:t(n.date_gmt),updated:t(n.modified_gmt)}}),{data:_}=await i(f),v=o(_),y=v(`link[rel="apple-touch-icon"]`).first().prop(`href`),b=v(`meta[property="og:site_name"]`).prop(`content`)??`Aqara`;return{item:g,title:`${b}${d?` - ${d}`:``}`,link:f,description:v(`meta[property="og:title"]`).prop(`content`),language:v(`meta[property="og:locale"]`).prop(`content`),image:v(`meta[name="msapplication-TileImage"]`).prop(`content`),icon:y,logo:y,subtitle:v(`meta[property="og:type"]`).prop(`content`),author:b}}export{s as route};