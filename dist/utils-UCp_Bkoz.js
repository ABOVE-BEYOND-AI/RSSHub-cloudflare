import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{ofetch_default as n}from"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import i from"node:path";import{load as a}from"cheerio";const o=async e=>{let t=await n(`https://api.aeonmedia.co/graphql`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({query:`query getImageById($id: ID!) { image(id: $id) { id url alt caption width height } }`,variables:{id:e,site:`Aeon`},operationName:`getImageById`})});return t.data.image.url};function s(e){let n=e.type.toLowerCase(),o=``,s=``,c=``;switch(n){case`film`:o=t(i.join(r,`templates/video-eb6996af.art`),{article:e});break;case`guide`:{s=e.imageSquare?.url,c=e.authors.map(e=>e.bio).join(` `);let n=[`Need To Know`,`What To Do`,`Key Points`,`Learn More`,`Links & Books`],l=Object.keys(e).filter(e=>e.startsWith(`section`)&&e!==`section`),u=l.map(t=>{let r=a(e[t]);r(`p.pullquote`).remove();let i=n.shift();return`<h2>${i}</h2>`+r.html()}).join(``);o=t(i.join(r,`templates/essay-18b14798.art`),{banner:s,authorsBio:c,content:u});break}case`idea`:{s=e.imageLandscape?.url,c=e.authors.map(e=>e.bio).join(` `);let n=a(e.body);n(`p.pullquote`).remove(),o=t(i.join(r,`templates/essay-18b14798.art`),{banner:s,authorsBio:c,content:n.html()});break}default:break}return o}const c=async t=>{let r=await Promise.all(t.map(t=>e.tryGet(t.link,async()=>{let e=await n(t.json),r=e.pageProps.article;t.pubDate=new Date(r.publishedAt).toUTCString();let i=s(r),c=a(i);await Promise.all(c(`dl > dt`).toArray().map(async e=>{let t=c(e).text(),n=await o(t);c(e).replaceWith(`<img src="${n}" alt="${t}">`)}));let l=``;return l=r.type===`film`?r.creditsShort:r.authors.map(e=>e.name).join(`, `),t.description=c.html(),t.author=l,t})));return r};export{c as getData};