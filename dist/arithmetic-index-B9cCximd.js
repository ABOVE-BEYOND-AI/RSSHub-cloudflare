import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./proxy-BQXcrhTu.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{timezone as a}from"./timezone-BrxBCotj.js";import{invalid_parameter_default as o}from"./invalid-parameter-CfUmvEUg.js";import{puppeteer_default as s}from"./puppeteer-BAoY_Fpy.js";import c from"node:path";import l from"dayjs";import{createDecipheriv as u}from"node:crypto";const d=e.cache.contentExpire,f=async(e,t,n,r,i=`aweme`)=>{let a={url:`https://trendinsight.oceanengine.com/api/open/index/get_multi_keyword_hot_trend`,method:`POST`,data:JSON.stringify({keyword_list:[t],start_date:n,end_date:r,app_name:i})},o=await e.evaluate(e=>{function t(){let t=new Promise(t=>{let n=new XMLHttpRequest;n.open(e.method,e.url,!0),n.setRequestHeader(`accept`,`application/json, text/plain, */*`),n.setRequestHeader(`content-type`,`application/json;charset=UTF-8`),n.setRequestHeader(`tea-uid`,`7054893410171930123`),n.addEventListener(`readystatechange`,()=>{if(n.readyState===4&&n.status===200)t(n.responseText);else return}),n.send(e.data)});return t}return Promise.resolve(t()).then(e=>e)},a);return o[0]},p=e=>{let t=Buffer.from(e,`base64`).toString(`hex`),n=u(`aes-128-cfb`,`anN2bXA2NjYsamlh`,`amlheW91LHFpYW53`),r=n.update(t,`hex`,`utf8`)+n.final(`utf8`);return JSON.parse(r)},m=e=>[`https://tophub.today/search?e=tophub&q=${e}`,`https://www.baidu.com/s?wd=${e}`,`https://www.google.com/search?q=${e}`,`https://m.zhihu.com/search?type=content&q=${e}`,`https://s.weibo.com/weibo/${e}`,`https://www.douyin.com/search/${e}`,`https://so.toutiao.com/search?keyword=${e}`],h=[`今日热榜`,`百度`,`谷歌`,`知乎`,`微博`,`抖音`,`头条`],g=(e,t,r)=>n(c.join(i,`templates/content-1e5ec464.art`),{keyword:e,queryListText:r,queries:t.map(e=>({links:m(encodeURIComponent(e)).map((e,t)=>`<a href="${e}" rel="noopener noreferrer" target="_blank">${h[t]}</a>`),key:e}))}),_={path:`/index/:keyword/:channel?`,name:`Unknown`,maintainers:[`Jkker`],handler:v};async function v(e){let n=l(),i=n.subtract(6,`month`).format(`YYYYMMDD`),c=n.format(`YYYYMMDD`),u=e.req.param(`keyword`);if(!u)throw new o(`Invalid keyword`);if(e.req.param(`channel`)&&![`douyin`,`toutiao`].includes(e.req.param(`channel`)))throw new o("Invalid channel。 Only support `douyin` or `toutiao`");let m=e.req.param(`channel`)===`toutiao`?`toutiao`:`aweme`,h=e.req.param(`channel`)===`toutiao`?`头条`:`抖音`,_=`https://trendinsight.oceanengine.com/arithmetic-index/analysis?keyword=${u}&appName=${m}`,v=await t.tryGet(_,async()=>{let e=await s(),t=await e.newPage();await t.setRequestInterception(!0),t.on(`request`,e=>{e.resourceType()===`document`||e.resourceType()===`script`||e.resourceType()===`xhr`?e.continue():e.abort()}),await t.goto(`https://trendinsight.oceanengine.com/arithmetic-index`);let n=await f(t,u,i,c,m);await e.close();let o=JSON.parse(n).data,l=p(o).hot_list[0],d=Number.parseInt(l.average.search_average);return l.search_top_point_list.map(({date:e,query_list:t})=>{let n=Number.parseInt(l.search_hot_list.find(t=>t.datetime===e).index),i=Math.round((n-d)/d*100),o=i>0?`📈`:`📉`,s=t.filter(e=>e!==u),c=s.join(`, `),f=g(u,[u,...s],c);return{title:`${o} ${u} ${i}% | ${c}`,author:`巨量算数 - ${h}算数指数`,description:f,link:_,pubDate:a(r(e),8),guid:`巨量算数 - ${h}算数指数 | ${u} - ${e}`}})},d,!1);return{title:`${u} - ${h}指数波峰`,link:_,description:`巨量算数 - ${h}算数指数 | 关键词: ${u}`,language:`zh-cn`,item:v}}export{_ as route};