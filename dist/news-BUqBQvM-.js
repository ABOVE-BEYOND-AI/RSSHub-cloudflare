import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import o from"node:path";import{load as s}from"cheerio";import c from"sanitize-html";import l from"p-map";const u=(e,t)=>{let n=e(t);return n.find(`.fSpecCs`).each((t,n)=>{n.parent.name===`nobr`&&e(n).unwrap(),n.name=`b`,n.attribs={}}),t.html()},d=(t,n)=>e.tryGet(n,async()=>{let e=await i(n),t=s(e.data),r=``;return t(`.content img`).each((e,t)=>{let n=t.attribs.src;n&&(r+=r?`<br><img src="${n}">`:`<img src="${n}">`)}),r}),f=(t,n)=>e.tryGet(n,async()=>{let e=await i(n),t=s(e.data),r=t(`script[type="text/javascript"]:not([src])`).html(),a=r.match(/<[^>]*source[^>]+src[^>]+>/g);return a=a&&a.map(e=>e.replaceAll(`'`,`"`).replaceAll(/src="([^"]+)"/g,`src="http://www.kcna.kp$1"`)),`<video controls preload="metadata">${a.join(`
`)}</video>`}),p={path:`/:lang/:category?`,categories:[`traditional-media`],example:`/kcna/en`,parameters:{lang:`Language, refer to the table below`,category:`Category, refer to the table below`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.kcna.kp/:lang`,`www.kcna.kp/:lang/category/articles/q/1ee9bdb7186944f765208f34ecfb5407.kcmsf`,`www.kcna.kp/:lang/category/articles.kcmsf`],target:`/:lang`}],name:`News`,maintainers:[`Rongronggg9`],handler:m,description:"| Language | 조선어 | English | 中国语 | Русский | Español | 日本語 |\n| -------- | ------ | ------- | ------ | ------- | ------- | ------ |\n| `:lang`  | `kp`   | `en`    | `cn`   | `ru`    | `es`    | `jp`   |\n\n| Category                                                         | `:category`                        |\n| ---------------------------------------------------------------- | ---------------------------------- |\n| WPK General Secretary **Kim Jong Un**'s Revolutionary Activities | `54c0ca4ca013a92cc9cf95bd4004c61a` |\n| Latest News (default)                                            | `1ee9bdb7186944f765208f34ecfb5407` |\n| Top News                                                         | `5394b80bdae203fadef02522cfb578c0` |\n| Home News                                                        | `b2b3bcc1b0a4406ab0c36e45d5db58db` |\n| Documents                                                        | `a8754921399857ebdbb97a98a1e741f5` |\n| World                                                            | `593143484cf15d48ce85c26139582395` |\n| Society-Life                                                     | `93102e5a735d03979bc58a3a7aefb75a` |\n| External                                                         | `0f98b4623a3ef82aeea78df45c423fd0` |\n| News Commentary                                                  | `12c03a49f7dbe829bceea8ac77088c21` |"};async function m(p){let{lang:m,category:h=`1ee9bdb7186944f765208f34ecfb5407`}=p.req.param(),g=`http://www.kcna.kp`,_=`${g}/${m}/category/articles/q/${h}.kcmsf`,v=await i(_),y=s(v.data),b=c(y(`head > title`).text(),{allowedTags:[],allowedAttributes:{}}),x=y(`.article-link li a`).toArray().map(e=>{e=y(e);let t=e.find(`.publish-time`),r=t.text().match(/\d+\.\d+\.\d+/);return t.remove(),{title:e.text(),link:g+e.attr(`href`),pubDate:a(n(r[0]),9)}}),S=await l(x,c=>e.tryGet(c.link,async()=>{let e=await i(c.link),l=s(e.data);c.title=l(`article-main-title`).text()||c.title;let m=l(`.publish-time`),h=m.text().match(/\d+\.\d+\.\d+/);m.remove(),c.pubDate=h?a(n(h[0]),9):c.pubDate;let _=u(l,l(`.article-content-body .content-wrapper`)),v=l(`.media-icon a`).toArray().map(e=>g+e.attribs.href),y,b;return await Promise.all(v.map(async e=>{e.includes(`/photo/`)?y=await d(p,e):e.includes(`/video/`)&&(b=await f(p,e))})),c.description=t(o.join(r,`templates/news-b7c0d7df.art`),{description:_,photo:y,video:b}),c}),{concurrency:3});return{title:b,link:_,item:S}}export{p as route};