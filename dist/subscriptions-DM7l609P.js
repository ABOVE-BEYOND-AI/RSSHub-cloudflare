import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{got_default as a}from"./got-BaOFZRd4.js";import{config_not_found_default as o}from"./config-not-found-B7nOMdXp.js";import s from"node:path";import c from"markdown-it";const l=c({html:!0}),u={path:`/subscriptions`,categories:[`anime`],example:`/iwara/subscriptions`,parameters:{},features:{requireConfig:[{name:`IWARA_USERNAME`,description:``},{name:`IWARA_PASSWORD`,description:``}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`ecchi.iwara.tv/`]}],name:`User Subscriptions`,maintainers:[`FeCCC`],handler:d,url:`ecchi.iwara.tv/`,description:`::: warning
  This route requires username and password, therefore it's only available when self-hosting, refer to the [Deploy Guide](https://docs.rsshub.app/deploy/config#route-specific-configurations) for route-specific configurations.
:::`};async function d(){if(!e.iwara||!e.iwara.username||!e.iwara.password)throw new o(`Iwara subscription RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let c=`https://www.iwara.tv`,u=e.iwara.username,d=e.iwara.password,f=await t.tryGet(`iwara:token`,async()=>{let e=await a({method:`post`,url:`https://api.iwara.tv/user/login`,headers:{"content-type":`application/json`},body:JSON.stringify({email:u,password:d})});return{authorization:`Bearer `+e.data.token}},720*60*60,!1),p=await a({method:`post`,url:`https://api.iwara.tv/user/token`,headers:f}),m={authorization:`Bearer `+p.data.accessToken},h=await a({method:`get`,url:`https://api.iwara.tv/videos?page=0&limit=30&subscribed=true`,headers:m}),g=await a({method:`get`,url:`https://api.iwara.tv/images?page=0&limit=30&subscribed=true`,headers:m}),_=h.data.results.map(e=>{let t=e.private===!0?`https://i.iwara.tv/image/original/`:`https://i.iwara.tv/image/thumbnail/`,n=e.file?t+e.file.id.toString().padStart(2,`0`)+`/thumbnail-`+e.thumbnail.toString().padStart(2,`0`)+`.jpg`:``;return{title:e.title,author:e.user.name,link:c+`/video/`+e.id,category:`Video`,imageUrl:n,pubDate:r(e.createdAt),private:e.private}}),v=g.data.results.map(e=>{let t=e.thumbnail?`https://i.iwara.tv/image/thumbnail/`+e.thumbnail.id+`/`+e.thumbnail.id+`.jpg`:``;return{title:e.title,author:e.user.name,link:c+`/image/`+e.id,category:`Image`,imageUrl:t,pubDate:r(e.createdAt)}}),y=[..._,...v],b=await Promise.all(y.map(e=>t.tryGet(e.link,async()=>{let t=n(s.join(i,`templates/subscriptions-f52aca80.art`),{type:e.category,imageUrl:e.imageUrl});if(e.private===!0)return t+=`private`,{title:e.title,author:e.author,link:e.link,category:e.category,pubDate:e.pubDate,description:t};let r=e.link.replace(`www.iwara.tv`,`api.iwara.tv`),o=await a({method:`get`,url:r,headers:m}),c=o.data.body?l.render(o.data.body):``;return t+=c,{title:e.title,author:e.author,link:e.link,category:e.category,pubDate:e.pubDate,description:t}})));return{title:`Iwara Subscription`,link:c,item:b}}export{u as route};