import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{ViewType as a}from"./types-D9T3SQ-7.js";import o from"node:path";import{load as s}from"cheerio";const c=async a=>{let{language:c=`en-us`}=a.req.param(),l=Number.parseInt(a.req.query(`limit`)??`30`,10),u=`https://support.apple.com`,d=new URL(`${c}/100100`,u).href,f=await r(d),p=s(f),m=p(`table.gb-table tbody tr`),h=m.find(`th`).toArray().map(e=>p(e).text()),g=[];return g=m.slice(1,l).toArray().map(e=>{let r=p(e),a=r.find(`td`).first(),s=a.contents().first().text(),l=t(o.join(i,`templates/security-releases-f17de8c3.art`),{headers:h,infos:r.find(`td`).toArray().map(e=>p(e).html()??``)}),d=r.find(`td`).last().text(),f=a.find(`a.gb-anchor`).attr(`href`),m=r.find(`meta[property="og:site_name"]`).attr(`content`),g=d,_={title:s,description:l,pubDate:d?n(d,[`DD MMM YYYY`,`YYYY 年 MM 月 DD 日`]):void 0,link:f?new URL(f,u).href:void 0,author:m,content:{html:l,text:l},updated:g?n(g,[`DD MMM YYYY`,`YYYY 年 MM 月 DD 日`]):void 0,language:c};return _}),g=await Promise.all(g.map(a=>a.link?e.tryGet(a.link,async()=>{let e=await r(a.link),l=s(e),u=a.title??l(`h1.gb-header`).text();l(`h1.gb-header`).remove();let d=a.description+t(o.join(i,`templates/security-releases-f17de8c3.art`),{description:l(`div#sections`).html()}),f=e.match(/publish_date:\s"(\d{8})",/,``)?.[1],p=l(`meta[property="og:site_name"]`).attr(`content`),m=l(`.time`).text()||f,h={title:u,description:d,pubDate:f?n(f,`MMDDYYYY`):a.pubDate,author:p,content:{html:d,text:d},updated:m?n(m,`MMDDYYYY`):a.updated,language:c};return{...a,...h}}):a)),{title:p(`title`).text(),description:p(`meta[property="og:description"]`).attr(`content`),link:d,item:g,allowEmpty:!0,author:p(`meta[property="og:site_name"]`).attr(`content`),language:c,id:d}},l={path:`/security-releases/:language?`,name:`Security releases`,url:`support.apple.com`,maintainers:[`nczitzk`],handler:c,example:`/apple/security-releases`,parameters:{language:{description:"Language, `en-us` by default"}},description:":::tip\nTo subscribe to [Apple security releases](https://support.apple.com/en-us/100100), where the source URL is `https://support.apple.com/en-us/100100`, extract the certain parts from this URL to be used as parameters, resulting in the route as [`/apple/security-releases/en-us`](https://rsshub.app/apple/security-releases/en-us).\n:::\n",categories:[`program-update`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`support.apple.com/:language/100100`],target:e=>{let t=e.language;return`/apple/security-releases${t?`/${t}`:``}`}}],view:a.Articles,zh:{path:`/security-releases/:language?`,name:`安全性发布`,url:`support.apple.com`,maintainers:[`nczitzk`],handler:c,example:`/apple/security-releases`,parameters:{language:{description:"语言，默认为 `en-us`，可在对应页 URL 中找到"}},description:":::tip\n若订阅 [Apple 安全性发布](https://support.apple.com/zh-cn/100100)，网址为 `https://support.apple.com/zh-cn/100100`，请截取 `https://support.apple.com/` 到末尾 `/100100` 的部分 `zh-cn` 作为 `language` 参数填入，此时目标路由为 [`/apple/security-releases/zh-cn`](https://rsshub.app/apple/security-releases/zh-cn)。\n:::\n"}};export{c as handler,l as route};