import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import i from"node:path";import{load as a}from"cheerio";const o={Accept:`text/css`},s={path:`/:source?/:id?`,categories:[`multimedia`],example:`/coomer`,parameters:{source:`Source, see below, Posts by default`,id:`User id, can be found in URL`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1,nsfw:!0},radar:[{source:[`coomer.st/`],target:``},{source:[`coomer.st/:source/user/:id`],target:`/:source/:id`}],name:`Posts`,maintainers:[`nczitzk`,`AiraNadih`],handler:c,description:`Sources

| Posts | OnlyFans | Fansly | CandFans |
| ----- | -------- | ------- | -------- |
| posts | onlyfans | fansly   | candfans |

::: tip
  When \`posts\` is selected as the value of the parameter **source**, the parameter **id** does not take effect.
  There is an optinal parameter **limit** which controls the number of posts to fetch, default value is 25.
:::`};async function c(s){let c=s.req.query(`limit`)?Number.parseInt(s.req.query(`limit`)):25,u=s.req.param(`source`)??`posts`,d=s.req.param(`id`),f=u===`posts`,p=`https://coomer.st`,m=`${p}/api/v1`,h=f?`${m}/posts`:`${m}/${u}/user/${d}/posts`,g=await r({method:`get`,url:h,headers:o}),_=f?g.data.posts:g.data,v=f?``:await l(`${m}/${u}/user/${d}`),y=f?`Coomer Posts`:`Posts of ${v} from ${u} | Coomer`,b=f?`${p}/favicon.ico`:`https://img.coomer.st/icons/${u}/${d}`,x=_.filter(e=>e.content||e.attachments).slice(0,c).map(r=>{r.files=[],`path`in r.file&&r.files.push({name:r.file.name,path:r.file.path,extension:r.file.path.replace(/.*\./,``).toLowerCase()});for(let e of r.attachments)r.files.push({name:e.name,path:e.path,extension:e.path.replace(/.*\./,``).toLowerCase()});let o=e(i.join(n,`templates/source-8cc27d8b.art`),{i:r}),s=a(o),c=s(`img, a, audio, video`).map(function(){return s(this).prop(`outerHTML`)}),l=``;r.content&&(l+=`<div>${r.content}</div>`),s=a(l);let u=0,d=/downloads.fanbox.cc/;s(`a`).each(function(){let e=s(this).attr(`href`);d.test(e)&&(u++,s(this).replaceWith(c[u]))}),l=(c.length>0?c[0]:``)+s.html();for(let e of c.slice(u+1))l+=e;let f={};return a(l)(`audio source, video source`).each(function(){let e=s(this).attr(`src`)??``,t={m4a:`audio/mp4`,mp3:`audio/mpeg`,mp4:`video/mp4`}[e.replace(/.*\./,``).toLowerCase()]||null;t!==null&&(f={enclosure_url:new URL(e,p).toString(),enclosure_type:t})}),{title:r.title||t(r.published),description:l,author:v,pubDate:t(r.published),guid:`coomer:${r.service}:${r.user}:post:${r.id}`,link:`${p}/${r.service}/user/${r.user}/post/${r.id}`,...f}});return{title:y,image:b,link:f?`${p}/posts`:`${p}/${u}/user/${d}`,item:x}}async function l(e){let t=await r({method:`get`,url:`${e}/profile`,headers:o});return t.data.name}export{s as route};