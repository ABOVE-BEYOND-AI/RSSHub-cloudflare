import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import a from"node:path";import{load as o}from"cheerio";const s=async s=>{let{category:c=``}=s.req.param(),l=s.req.query(`limit`)?Number.parseInt(s.req.query(`limit`),10):50,u=`https://www.jiemian.com`,d=new URL(c?`${c}.html`:``,u).href,f=await r(d),p=o(f),m={},h=p(`a`).toArray();for(let e of h){let t=p(e),n=t.prop(`href`),r=n?n.startsWith(`/`)?new URL(n,u).href:n:void 0;r&&/\/(article|video)\/\w+\.html/.test(r)&&(m[r]={title:t.text(),link:r})}m=await Promise.all(Object.values(m).slice(0,l).map(s=>e.tryGet(s.link,async()=>{let e=await r(s.link),c=o(e),l=c(`div.article-img img`).first(),u=c(`#video-player`).first();return s.title=c(`div.article-header h1`).eq(0).text(),s.description=t(a.join(i,`templates/description-55895928.art`),{image:l?{src:l.prop(`src`),alt:l.next(`p`).text()||s.title}:void 0,video:u?{src:u.prop(`data-url`),poster:u.prop(`data-poster`),width:u.prop(`width`),height:u.prop(`height`)}:void 0,intro:c(`div.article-header p`).text(),description:c(`div.article-content`).html()}),s.author=c(`span.author`).first().find(`a`).toArray().map(e=>c(e).text()).join(`/`),s.category=c(`meta.meta-container a`).toArray().map(e=>c(e).text()),s.pubDate=n(c(`div.article-info span[data-article-publish-time]`).prop(`data-article-publish-time`),`X`),s.upvotes=c(`span.opt-praise__count`).text()?Number.parseInt(c(`span.opt-praise__count`).text(),10):0,s.comments=c(`span.opt-comment__count`).text()?Number.parseInt(c(`span.opt-comment__count`).text(),10):0,s})));let g=p(`title`).text(),_=g.split(/_/),v=p(`div.logo img`).prop(`src`),y=new URL(p(`link[rel="icon"]`).prop(`href`),u).href;return{item:m,title:g,link:d,description:p(`meta[name="description"]`).prop(`content`),language:p(`html`).prop(`lang`),image:v,icon:y,logo:y,subtitle:_[0],author:_.pop()}};export{s as handler};