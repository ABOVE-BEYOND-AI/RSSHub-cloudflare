import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import a from"node:path";import{load as o}from"cheerio";const s=`https://www.tmtpost.com`,c=`https://api.tmtpost.com`,l=new URL(`v1/posts/`,c).href,u={"app-version":`web1.0`},d=async(c,d,f,p)=>{let m=await r(f,{query:{limit:c,...d},headers:u}),h=await r(p),g=o(h),_=g(`html`).attr(`lang`)??`zh-CN`,v=[];v=m.data.slice(0,c).map(e=>{let r=e.title,o=t(a.join(i,`templates/description-ca64252b.art`),{intro:e.summary}),s=e.time_published,c=e.share_link,l=e.guid,u=e.thumb_image?.original?.url,d=e.updated??s,f={title:r,description:o,pubDate:s?n(s,`X`):void 0,link:c,guid:l,id:l,content:{html:o,text:e.content??o},image:u,banner:u,updated:d?n(d,`X`):void 0,language:_};return f}),v=(await Promise.all(v.map(o=>o.link?e.tryGet(o.link,async()=>{let e=new URL(o.guid,l).href,c=await r(e,{query:{fields:[`authors`,`tags`,`featured_image`,`categories`,`stock_list`,`big_plate`,`concept_plate`,`plate`,`plate_list`,`share_link`].join(`;`)},headers:u}),d=c.data;if(!d)return o;let f=d.title,p=t(a.join(i,`templates/description-ca64252b.art`),{intro:d.summary,description:d.main}),m=d.time_published,h=d.share_link,g=[...new Set([...d.categories??[],...d.stock_list??[],...d.big_plate??[],...d.concept_plate??[],...d.plate??[],...d.plate_list??[],...d.tags??[]].map(e=>e.title??e.name??e.tag).filter(Boolean))],v=d.authors?.map(e=>({name:e.username,url:new URL(`user/${e.guid}`,s).href,avatar:e.avatar})),y=`tmtpost-${d.post_guid}`,b=d.images?.[0]?.url,x=d.time_updated,S={title:f,description:p,pubDate:m?n(m,`X`):void 0,link:h??o.link,category:g,author:v,guid:y,id:y,content:{html:p,text:p},image:b,banner:b,updated:x?n(x,`X`):void 0,language:_},C=d.audio;if(C){let e=`audio/${C.split(/\./).pop()}`,t=d.duration;S={...S,enclosure_url:C,enclosure_type:e,enclosure_title:f,enclosure_length:void 0,itunes_duration:t,itunes_item_image:b}}let w={};if(d.full_size_images??d.images){let e=d.full_size_images??d.images;for(let t of e){let e=t.url??t;if(!e)continue;let n=`image`,r=Object.values(w).filter(e=>e.medium===n).length+1,i=`${n}${r}`;w[i]={url:e,medium:n,title:f,thumbnail:t.thumbnail??e}}}return S={...S,media:w},{...o,...S}}):o))).filter(e=>!0);let y=g(`title`).text(),b=y.split(/-/).pop();return{title:y,description:g(`meta[property="og:description"]`).attr(`content`),link:p,item:v,allowEmpty:!0,image:g(`meta[property="og:image"]`).attr(`content`),author:y.split(/-/).pop(),language:_,itunes_author:b,itunes_category:`Technology`,id:p}};export{c as apiBaseUrl,s as baseUrl,d as processItems};