import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";const o={path:`/:type?`,categories:[`new-media`],example:`/mittrchina/index`,parameters:{type:`类型，见下表，默认为首页资讯`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`首页`,maintainers:[`EsuRt`,`queensferryme`],handler:s,description:`| 快讯     | 本周热文 | 首页资讯 | 视频  |
| -------- | -------- | -------- | ----- |
| breaking | hot      | index    | video |`};async function s(o){let s={breaking:{title:`快讯`,apiPath:`/flash`},hot:{title:`本周热榜`,apiPath:`/information/hot`},index:{title:`首页资讯`,apiPath:`/information/index`},video:{title:`视频`,apiPath:`/movie/index`}},{type:c=`index`}=o.req.param(),l=o.req.query(`limit`)?Number.parseInt(o.req.query(`limit`),10):10,u=`https://apii.web.mittrchina.com${s[c].apiPath}`,{data:d}=c===`breaking`?await i.post(u,{form:{page:1,size:l}}):await i(u,{searchParams:{limit:l}}),f=c===`hot`?d.data:d.data.items,p=f.map(e=>({title:e.name||e.title,author:(e.authors||e.author||[]).map(e=>e.username).join(`, `),category:e.typeName,description:c===`video`?t(a.join(r,`templates/movie-1179cf74.art`),{poster:e.img,video:{address:e.address,type:e.address.split(`.`).pop()}}):c===`breaking`?e.content:e.summary,pubDate:e.start_time?n(e.start_time,`X`):e.push_time?n(e.push_time,`X`):void 0,id:e.id,link:`https://www.mittrchina.com/news/detail/${e.id}`})),m=p;return c!==`video`&&c!==`breaking`&&(m=await Promise.all(p.map(t=>e.tryGet(t.link,async()=>{let{data:{data:e}}=await i(`https://apii.web.mittrchina.com/information/details?id=${t.id}`);return t.description=e.content,t.author||(t.author=e.authors.map(e=>e.username).join(`, `)),t.pubDate||(t.pubDate=n(e.start_time,`X`)),e.cover&&(t.enclosure_url=e.cover,t.enclosure_type=`image/${e.cover.split(`.`).pop()}`),t})))),{title:`MIT 科技评论 - ${s[c].title}`,link:`https://www.mittrchina.com/${c}`,item:m}}export{o as route};