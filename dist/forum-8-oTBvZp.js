import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{got_default as a}from"./got-BaOFZRd4.js";import{config_not_found_default as o}from"./config-not-found-B7nOMdXp.js";import s from"node:path";const c=`https://zodgame.xyz`,l={path:`/forum/:fid?`,categories:[`bbs`],example:`/zodgame/forum/13`,parameters:{fid:`forum id, can be found in URL`},features:{requireConfig:[{name:`ZODGAME_COOKIE`,description:``}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`forum`,maintainers:[`FeCCC`],handler:u};async function u(l){let u=l.req.param(`fid`),d=`${c}/api/mobile/index.php?version=4&module=forumdisplay&fid=${u}`,f=e.zodgame.cookie;if(f===void 0)throw new o(`Zodgame RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let p=await a({method:`get`,url:d,headers:{Cookie:f}}),m=p.data.Variables,h=m.forum_threadlist.map(e=>{if(!m.threadtypes.types[e.typeid])return;let t=m.threadtypes.types[e.typeid];return{tid:e.tid,title:`[${t}] ${e.subject}`,author:e.author,link:`${c}/forum.php?mod=viewthread&tid=${e.tid}&extra=page%3D1`,category:t,pubDate:r(e.dbdateline*1e3)}}).filter(e=>e!==void 0),g=await Promise.all(h.map(e=>t.tryGet(e.tid,async()=>{let t=await a({method:`get`,url:`${c}/api/mobile/index.php?version=4&module=viewthread&tid=${e.tid}`,headers:{Cookie:f}}),r=t.data.Variables,o=``;return r.thread.freemessage?(o+=r.thread.freemessage,o+=n(s.join(i,`templates/forum-c3ab5e98.art`),{content:r.postlist[0].message})):o+=r.postlist[0].message,{title:e.title,author:e.author,link:e.link,description:o,category:e.category,pubDate:e.pubDate,guid:e.tid,upvotes:Number.parseInt(r.thread.recommend_add,10),downvotes:Number.parseInt(r.thread.recommend_sub,10),comments:Number.parseInt(r.thread.replies,10)}})));return{title:`${m.forum.name} - ZodGame论坛`,link:`${c}/forum.php?mod=forumdisplay&fid=${u}`,item:g}}export{l as route};