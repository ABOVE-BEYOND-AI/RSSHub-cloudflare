import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{invalid_parameter_default as a}from"./invalid-parameter-CfUmvEUg.js";import o from"node:path";import{load as s}from"cheerio";const c={jxrb:`嘉兴日报`,nhwb:`南湖晚报`},l={path:`/:category?/:id?`,name:`Unknown`,maintainers:[],handler:u};async function u(l){let u=l.req.param(`category`)??`jxrb`,d=l.req.param(`id`);if(!Object.keys(c).includes(u))throw new a(`Invalid category`);let f=`https://${u}.cnjxol.com`,p=`${f}/${u}Paper/pc/layout`,m=await i({method:`get`,url:p}),h=s(m.data),g=h(`a`).first().attr(`href`).match(/\d{6}\/\d{2}/)[0],_=[];if(d){let e=`${p}/${g}/node_${d}.html`,t=await i({method:`get`,url:e});h=s(t.data),_=h(`#articlelist .clearfix a`).toArray().map(e=>`${p}/${h(e).attr(`href`)}`.replaceAll(`layout/../../../`,``))}else await Promise.all(h(`#list li a`).toArray().map(async e=>{let t=await i({method:`get`,url:`${p}/${h(e).attr(`href`)}`}),n=s(t.data);_.push(...n(`#articlelist .clearfix a`).toArray().map(e=>`${p}/${n(e).attr(`href`)}`.replaceAll(`layout/../../../`,``)))}));return _=await Promise.all(_.map(a=>e.tryGet(a,async()=>{let e=await i({method:`get`,url:a}),c=s(e.data);return{link:a,title:c(`#Title`).text(),pubDate:n(c(`date`).text()),description:t(o.join(r,`templates/description-b24e1338.art`),{attachment:c(`.attachment`).html(),content:c(`founder-content`).html()})}}))),{title:`${c[u]}${d?` - ${h(`#layout`).text()}`:``}`,link:p,item:_}}export{l as route};