import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{ViewType as a}from"./types-D9T3SQ-7.js";import o from"node:path";import{load as s}from"cheerio";const c=async a=>{let{category:c}=a.req.param(),l=Number.parseInt(a.req.query(`limit`)??`1`,10),u=`https://www.ali213.net`,d=new URL(`/news/zl/${c?c.endsWith(`/`)?c:`${c}/`:``}`,u).href,f=new URL(`ajax/newslist`,`https://mp.ali213.net`).href,p=await r(f,{query:{type:`new`}}),m=await r(d),h=s(m),g=h(`html`).prop(`lang`)??`zh`,_=JSON.parse(p.replace(/^\((.*)\)$/,`$1`)).data.slice(0,l).map(e=>{let r=e.Title,a=t(o.join(i,`templates/description-881baa33.art`),{intro:e.GuideRead??``}),s=`ali213-zl-${e.ID}`,c=e.PicPath?`https:${e.PicPath}`:void 0,l=e.xiaobian;return{title:r,description:a,pubDate:n(e.addtime*1e3),link:e.url?`https:${e.url}`:void 0,author:l,guid:s,id:s,content:{html:a,text:e.GuideRead??``},image:c,banner:c,language:g}});_=(await Promise.all(_.map(n=>!n.link&&typeof n.link!=`string`?n:e.tryGet(n.link,async()=>{let e=await r(n.link),a=s(e),c=a(`h1.newstit`).text(),l=a(`div#Content`).html()??``,u=[];a(`a.currpage`).parent().find(`a:not(.currpage)`).each((e,t)=>{let n=a(t).attr(`href`);n&&u.push(n)});let d=await Promise.all(u.map(async e=>{let t=await r(new URL(e,n.link).href),i=s(t);return i(`div#Content`).html()??``}));l+=d.join(``),l=t(o.join(i,`templates/description-881baa33.art`),{description:l});let f=a(`div.extend_read a`).toArray().map(e=>{let t=a(e);return{url:t.prop(`href`),type:`related`,content_html:t.text()}}).filter(e=>!0);return{title:c,description:l,pubDate:n.pubDate,category:a(`.category`).toArray().map(e=>a(e).text()),author:n.author,doi:a(`meta[name="citation_doi"]`).prop(`content`)||void 0,guid:n.guid,id:n.guid,content:{html:l,text:l},image:n.image,banner:n.image,language:g,_extra:{links:f.length>0?f:void 0}}})))).filter(e=>!0);let v=h(`title`).text(),y=new URL(`news/images/dxhlogo.png`,u).href;return{title:v,description:h(`meta[name="description"]`).prop(`content`),link:d,item:_,allowEmpty:!0,image:y,author:v.split(/_/).pop(),language:g,id:d}},l={path:`/zl/:category?`,name:`大侠号`,url:`www.ali213.net`,maintainers:[`nczitzk`],handler:c,example:`/ali213/zl`,parameters:{category:`分类，默认为首页，可在对应分类页 URL 中找到`},description:"::: tip\n若订阅 [游戏](https://www.ali213.net/news/zl/game/)，网址为 `https://www.ali213.net/news/zl/game/`，请截取 `https://www.ali213.net/news/zl/` 到末尾 `/` 的部分 `game` 作为 `category` 参数填入，此时目标路由为 [`/ali213/zl/game`](https://rsshub.app/ali213/zl/game)。\n:::\n\n| 首页                                     | 游戏                                         | 动漫                                           | 影视                                           | 娱乐                                           |\n| ---------------------------------------- | -------------------------------------------- | ---------------------------------------------- | ---------------------------------------------- | ---------------------------------------------- |\n| [index](https://www.ali213.net/news/zl/) | [game](https://www.ali213.net/news/zl/game/) | [comic](https://www.ali213.net/news/zl/comic/) | [movie](https://www.ali213.net/news/zl/movie/) | [amuse](https://www.ali213.net/news/zl/amuse/) |\n",categories:[`game`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.ali213.net/news/zl/:category`],target:e=>{let t=e.category;return`/ali213/zl${t?`/${t}`:``}`}},{title:`首页`,source:[`www.ali213.net/news/zl/`],target:`/zl`},{title:`游戏`,source:[`www.ali213.net/news/zl/game/`],target:`/zl/game`},{title:`动漫`,source:[`www.ali213.net/news/zl/comic/`],target:`/zl/comic`},{title:`影视`,source:[`www.ali213.net/news/zl/movie/`],target:`/zl/movie`},{title:`娱乐`,source:[`www.ali213.net/news/zl/amuse/`],target:`/zl/amuse`}],view:a.Articles};export{c as handler,l as route};