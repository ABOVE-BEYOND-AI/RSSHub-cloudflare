import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import i from"node:path";import{load as a}from"cheerio";const o=async(e,t,n,i)=>{let{data:a}=await r(`https://${e}.news.yahoo.com/_td-news/api/resource/NCPListService;api=archive;ncpParams=${encodeURIComponent(JSON.stringify({query:{count:t,start:0,providerid:i,tag:n}}))}`);return a},s=async(e,t)=>{let{data:n}=await r(`https://${e}.news.yahoo.com/_td-news/api/resource/StreamService;category=LISTID%3A${t};useNCP=true`);return n},c=(e,t)=>t(`yahoo:${e}:categoryMap`,async()=>{let{PageStore:n}=await u(e,t),{Col1:r}=n.pagesConfigRaw.base.section.regions,{categoryMap:i}=r.find(e=>e.name===`ArchiveFilterBar`).props;for(let[e,t]of Object.entries(i))i[e]={name:t,yctMap:r.find(e=>e.name===`StreamContainerArchive`).props.yctMap[e]};return i}),l=(e,t)=>t(`yahoo:${e}:providerList`,async()=>{let{ProviderListStore:n}=await u(e,t);return n.providerList.flatMap(t=>t.providers.map(n=>({title:`${t.title} - ${n.title}`,key:n.key,link:new URL(n.url,`https://${e}.news.yahoo.com`).href})))}),u=(e,t)=>t(`yahoo:${e}:stores`,async()=>{let{data:t}=await r(`https://${e}.news.yahoo.com/archive`),n=a(t),i=JSON.parse(n(`script:contains("root.App.main")`).text().match(/root.App.main\s+=\s+({.+});/)?.[1]);return i.context.dispatcher.stores}),d=(e,n)=>n.map(n=>({title:n.title,link:n.url.startsWith(`http`)?n.url:new URL(n.url,`https://${e}.news.yahoo.com`).href,description:n.summary,pubDate:t(n.published_at,`X`)})),f=(o,s)=>s(o.link,async()=>{let{data:s}=await r(o.link),c=a(s),l=JSON.parse(c(`script[type="application/ld+json"]`).first().text()),u=`${c(`span.caas-author-byline-collapse`).text()} @${c(`span.caas-attr-provider`).text()}`,d=c(`.atoms`);return d.find(`noscript`).remove(),d.find(`.caas-figure-with-pb, .caas-img-container`).each((e,t)=>{let n=c(t);n.removeAttr(`style`)}),d.find(`img`).each((e,t)=>{let n=c(t),r=n.data(`src`);if(r){let e=r.match(/.*--\/.*--\/(.*)/);e?.[1]&&(r=e?.[1]),n.attr(`src`,r),n.removeAttr(`data-src`)}}),d.find(`.caas-iframe`).each((t,r)=>{let a=c(r);if(a.data(`type`)===`youtube`){let t=a.find(`blockquote`).data(`src`);a.replaceWith(e(i.join(n,`templates/youtube-151badfe.art`),{id:t.split(`/`).pop()?.split(`?`)?.[0]}))}}),o.description=d.html(),o.author=u,o.category=l.keywords,o.pubDate=t(l.datePublished),o.updated=t(l.dateModified),o});export{o as getArchive,c as getCategories,s as getList,l as getProviderList,f as parseItem,d as parseList};