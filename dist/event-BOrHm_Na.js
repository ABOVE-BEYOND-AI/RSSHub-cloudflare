import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{ViewType as a}from"./types-D9T3SQ-7.js";import o from"node:path";import{load as s}from"cheerio";const c=async a=>{let{category:c=`latest`}=a.req.param(),l=Number.parseInt(a.req.query(`limit`)??`30`,10),u=`https://www.oschina.net`,d=new URL(`event?tab=${c}`,u).href,f=new URL(`action/ajax/get_more_event_list`,u).href,p=await r(f,{method:`post`,body:{tab:c}}),m=s(p),h=await r(d),g=s(h),_=g(`html`).attr(`lang`)??`zh-CN`,v=[];return v=m(`div.event-item`).slice(0,l).toArray().map(e=>{let r=m(e),a=r.find(`a.summary`).text(),s=r.find(`header.item-banner img`).attr(`data-delay`),c=t(o.join(i,`templates/description-881baa33.art`),{images:s?[{src:s,alt:a}]:void 0,description:r.html()}),l=r.find(`footer.when-where label`).first().text(),u=r.find(`a.summary`).attr(`href`),d=r.find(`footer.when-where label`).last(),f=[d.text()],p=r.find(`div.sponsor`).toArray(),h=p.map(e=>{let t=m(e);return{name:t.find(`span`).text(),avatar:t.find(`img`).attr(`data-delay`)}}),g=l,v={title:a,pubDate:l?n(l):void 0,link:u,category:f,author:h,content:{html:c,text:c},image:s,banner:s,updated:g?n(g):void 0,language:_};return v}),v=(await Promise.all(v.map(a=>a.link?e.tryGet(a.link,async()=>{let e=await r(a.link),c=s(e),l=c(`h1`).text(),u=c(`div.event-img img`).attr(`src`),d=t(o.join(i,`templates/description-881baa33.art`),{images:u?[{src:u,alt:l}]:void 0,description:c(`div.event-detail`).html()}),f=c(`span.box-fl`).filter((e,t)=>c(t).text().includes(`时间`)).next().text()?.split(`至`)[0]?.trim(),p=c(`val[data-name="weixinUrl"]`).attr(`data-value`),m=[...a.category??[],c(`div.cost span.c`).text()].filter(Boolean),h=c(`div.user-list div.box-aw`).toArray(),g=h.map(e=>{let t=c(e);return{name:t.find(`h3`).text(),url:t.find(`a`).attr(`href`),avatar:t.prev().find(`img`).attr(`src`)}}),v=f,y={title:l,description:d,pubDate:f?n(f):a.pubDate,link:p??a.link,category:m,author:g,content:{html:d,text:d},image:u,banner:u,updated:v?n(v):a.updated,language:_},b=c(`div.aside-list ul li`).toArray(),x=b.map(e=>{let t=c(e);return{url:t.find(`a.list-item`).attr(`href`),type:`related`,content_html:t.find(`a.list-item`).html()}}).filter(e=>!0);return x&&(y={...y,_extra:{links:x}}),{...a,...y}}):a))).filter(e=>!0),{title:g(`title`).text(),description:g(`meta[name="description"]`).attr(`content`),link:d,item:v,allowEmpty:!0,language:_,id:d}},l={path:`/event/:category?`,name:`活动`,url:`www.oschina.net`,maintainers:[`nczitzk`],handler:c,example:`/oschina/event`,parameters:{category:"分类，默认为 `latest`，即最新活动，可在对应分类页 URL 中找到"},description:":::tip\n若订阅 [强力推荐](https://www.oschina.net/event?tab=recommend)，网址为 `https://www.oschina.net/event?tab=recommend`，请截取 `https://www.oschina.net/event?tab=` 到末尾的部分 `recommend` 作为 `category` 参数填入，此时目标路由为 [`/oschina/event/recommend`](https://rsshub.app/oschina/event/recommend)。\n:::\n\n| 强力推荐  | 最新活动 |\n| --------- | -------- |\n| recommend | latest   |\n",categories:[`programming`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.oschina.net`],target:(e,t)=>{let n=new URL(t),r=n.searchParams.get(`tab`)??void 0;return`/oschina/event${r?`/${r}`:``}`}},{title:`强力推荐`,source:[`www.oschina.net`],target:`/event/recommend`},{title:`最新活动`,source:[`www.oschina.net`],target:`/event/latest`}],view:a.Articles};export{c as handler,l as route};