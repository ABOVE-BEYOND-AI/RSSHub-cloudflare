import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import{invalid_parameter_default as o}from"./invalid-parameter-CfUmvEUg.js";import{config_not_found_default as s}from"./config-not-found-B7nOMdXp.js";import c from"node:path";import{load as l}from"cheerio";const u=(e,t)=>e.startsWith(`http`)?e:`${t}${e}`,d={path:`/:language?/:keyword?`,categories:[`traditional-media`],example:`/kyodonews`,parameters:{language:"语言: `china` = 简体中文 (默认), `tchina` = 繁體中文",keyword:`关键词`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`最新报道`,maintainers:[`Rongronggg9`],handler:f,description:"`keyword` 为关键词，由于共同网有许多关键词并不在主页列出，此处不一一列举，可从关键词页的 URL 的最后一级路径中提取。如 `日中关系` 的关键词页 URL 为 `https://china.kyodonews.net/news/japan-china_relationship`, 则将 `japan-china_relationship` 填入 `keyword`。特别地，当填入 `rss` 时，将从共同网官方 RSS 中抓取文章；略去时，将从首页抓取最新报道 (注意：首页更新可能比官方 RSS 稍慢)。"};async function f(d){let f=d.req.param(`language`)??`china`,p=d.req.param(`keyword`)===`RSS`?`rss`:d.req.param(`keyword`)??``;if(![`china`,`tchina`].includes(f))throw new s(`Invalid language`);let m=`https://${f}.kyodonews.net`,h=`${m}/${p?p===`rss`?`rss/news.xml`:`news/${p}`:``}`,g;try{g=await i(h)}catch(e){throw e.response&&e.response.statusCode===404?new o(`Invalid keyword`):e}let _=l(g.data,{xmlMode:p===`rss`}),v,y,b,x;return b=`${m}/apple-touch-icon-180x180.png`,p===`rss`?(v=_(`channel > title`).text(),y=_(`channel > description`).text(),x=_(`item`).toArray().map(e=>{let t=_(e),n=t.find(`link`).text();return{link:n}})):(v=_(`head > title`).text(),y=_(`meta[name="description"]`).attr(`content`),b=u(_(`head > link[rel="apple-touch-icon"]`).attr(`href`),m)||b,x=_(`div.sec-latest > ul > li`).toArray().map(e=>{e=_(e);let t=e.find(`a`).attr(`href`);return{link:u(t,m)}})),x=await Promise.all(x.map(o=>e.tryGet(o.link,async()=>{let e=await i(o.link),s=l(e.data);o.title=s(`head > title`).text(),o.author=s(`meta[name="author"]`).attr(`content`);let u=s(`div.mainpic`);u.find(`div`).each((e,t)=>{t=s(t),t.css(`text-align`,`center`)}),u.find(`img`).each((e,t)=>{t=s(t),t.attr(`src`,t.attr(`data-src`)),t.removeAttr(`data-src`),t.wrap(`<div>`)});let d=u.html();d=d?d.trim():``;let f=s(`div.article-body`).html();f=f?f.trim().replace(/（完）(?=<\/p>\s*$)/m,``):``,o.description=t(c.join(r,`templates/article-a61942d2.art`),{mainPic:d,articleBody:f});let p=s(`script[type="application/ld+json"]`).html(),m=p&&p.match(/"datePublished":"([\d\s-:]*?)"/),h=p&&p.match(/"dateModified":"([\d\s-:]*?)"/);return m&&(o.pubDate=a(n(m[1]),9)),h&&(o.updated=a(n(h[1]),9)),o.category=s(`p.credit > a`).toArray().map(e=>s(e).text()),o}))),{title:v,description:y,link:h,item:x,image:b}}export{d as route};