import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{ofetch_default as n}from"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import i from"node:path";import{load as a}from"cheerio";const o=`https://image.gcores.com`,s={BOLD:{fontWeight:`bold`},CODE:{fontFamily:`monospace`,wordWrap:`break-word`},ITALIC:{fontStyle:`italic`},STRIKETHROUGH:{textDecoration:`line-through`},UNDERLINE:{textDecoration:`underline`}},c={"header-one":{element:`h1`},"header-two":{element:`h2`},"header-three":{element:`h3`},"header-four":{element:`h4`},"header-five":{element:`h5`},"header-six":{element:`h6`},"unordered-list-item":{element:`li`,parentElement:`ul`},"ordered-list-item":{element:`li`,parentElement:`ol`},blockquote:{element:`blockquote`},atomic:{element:void 0},"code-block":{element:`pre`},unstyled:{element:`p`}},l=(e,t)=>{let n=Object.entries(t).map(([e,t])=>`${e.replaceAll(/([A-Z])/g,`-$1`).toLowerCase()}: ${t}`).join(`; `);return`<span style="${n}">${e}</span>`},u=(t,n)=>{switch(t.type){case`EMBED`:return t.data.content.startsWith(`http`)?`<a href="${t.data.content}" target="_blank">${t.data.content}</a>`:t.data.content;case`IMAGE`:return e(i.join(r,`templates/description-57cbf0bd.art`),{images:t.data.path?[{src:new URL(t.data.path,o).href,alt:t.data.caption,width:t.data.width,height:t.data.height}]:void 0}).replaceAll(`
`,``);case`GALLERY`:return!t.data.images||!Array.isArray(t.data.images)?``:e(i.join(r,`templates/description-57cbf0bd.art`),{images:t.data.images.map(e=>({src:new URL(e.path,o).href,alt:e.caption??t.data.caption,width:e.width,height:e.height}))}).replaceAll(`
`,``);case`LINK`:return`<a href="${t.data.url}" target="_blank">${n}</a>`;case`WIDGET`:return`<a href="${t.data.url}" target="_blank">${t.data.title}</a>`;default:return``}},d=(e,t)=>{let n=c[e.type];if(!n)return``;let{text:r,inlineStyleRanges:i,entityRanges:a}=e,o=[];for(let e of i)o.push({...e,styles:[s[e.style]],entity:null});for(let e of a)o.push({...e,styles:[],entity:t[e.key]});o.sort((e,t)=>e.offset-t.offset);let d=new Map,f=[];for(let e of o){let t=`${e.offset}-${e.length}`,n=d.get(t);n||(n={offset:e.offset,length:e.length,styles:[],entities:[]},d.set(t,n),f.push(n)),e.styles.length>0&&n.styles.push(...e.styles),e.entity&&n.entities.push(e.entity)}let p=[],m=0;for(let e of f){p.push(r.substring(m,e.offset));let t=r.substring(e.offset,e.offset+e.length);if(e.styles.length>0){let n={};for(let t of e.styles)for(let[e,r]of Object.entries(t))n[e]=r;t=l(t,n)}if(e.entities.length>0)for(let n of e.entities)t=u(n,t);p.push(t),m=e.offset+e.length}return p.push(r.slice(m)),`${n.element?`<${n.element}>`:``}${p.join(``).replaceAll(`
`,`<br>`)}${n.element?`</${n.element}>`:``}`},f=e=>{let{blocks:t,entityMap:n}=e;if(!t||t.length===0)return``;let r=[],i,a=[];for(let e of t){let t=c[e.type];if(!t)continue;let o=d(e,n);t.parentElement?i===t.parentElement?a.push(o):(i&&r.push(`<${i}>${a.join(``)}</${i}>`),i=t.parentElement,a=[o]):(i&&(r.push(`<${i}>${a.join(``)}</${i}>`),i=void 0,a=[]),r.push(o))}return i&&r.push(`<${i}>${a.join(``)}</${i}>`),r.join(``)},p=`https://www.gcores.com`,m=`https://image.gcores.com`,h=new Set([`radios`,`articles`,`news`,`videos`,`talks`]),g=async(o,s,c,l)=>{let u=await n(c,{query:s??{"page[limit]":o,sort:`-published-at`,include:`category,user,media`,"filter[list-all]":1}}),d=await n(l),g=a(d),_=g(`html`).attr(`lang`)??`zh-CN`,v=u.included,y=[...u.data,...v].filter(e=>h.has(e.type)),b=[];b=y?.slice(0,o).map(n=>{let a=n.attributes,o=n.relationships,s=a.title,c=a[`published-at`],l=`${n.type}/${n.id}`,u=[o?.category?.data,o?.tag?.data,o?.topic?.data].filter(Boolean),d=u.map(e=>{let t=v.find(t=>t.type===e.type&&t.id===e.id)?.attributes;return t?.name??t?.title}).filter(Boolean),h=o?.user?.data,y=h?v.find(e=>e.type===h.type&&e.id===h.id):void 0,b=y?[{name:y.attributes?.nickname,url:y.id?new URL(`${h.type}/${y.id}`,p).href:void 0,avatar:y.thumb?new URL(y.thumb,m).href:void 0}]:void 0,x=`gcores-${n.id}`,S=a.cover??a.thumb?new URL(a.cover??a.thumb,m).href:void 0,C=c,w={title:s,pubDate:c?t(c):void 0,link:new URL(l,p).href,category:d,author:b,guid:x,id:x,image:S,banner:S,updated:C?t(C):void 0,language:_},T,E,D=v.find(e=>e.id===o.media?.data?.id)?.attributes;if(a[`speech-path`]?(T=new URL(`uploads/audio/${a[`speech-path`]}`,`https://alioss.gcores.com`).href,E=`audio/${T?.split(/\./).pop()}`):D&&(D.audio?(T=D.audio,E=`audio/${T?.split(/\./).pop()}`):D[`original-src`]&&(T=D[`original-src`],E=`video/${T?.split(/\?/).pop()?/^id=\d+$/.test(T?.split(/\?/).pop())?`taptap`:T?.split(/\./).pop():``}`)),T){let e=a.duration?Number(a.duration):0;w={...w,enclosure_url:T,enclosure_type:E,enclosure_title:s,enclosure_length:e,itunes_duration:e,itunes_item_image:S}}let O=e(i.join(r,`templates/description-57cbf0bd.art`),{images:a.cover?[{src:new URL(a.cover,m).href,alt:s}]:void 0,audios:E?.startsWith(`audio`)&&T?[{src:T,type:E}]:void 0,videos:E?.startsWith(`video`)&&T?[{src:T,type:E}]:void 0,intro:a.desc||a.excerpt,description:a.content?f(JSON.parse(a.content)):void 0});return w={...w,title:s??g(O).text(),description:O,content:{html:O,text:O}},w});let x=g(`title`).text();return{title:x,description:g(`meta[name="description"]`).attr(`content`),link:l,item:b,allowEmpty:!0,author:x.split(/\|/).pop()?.trim(),language:_,id:g(`meta[property="og:url"]`).attr(`content`)}};export{p as baseUrl,g as processItems};