import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{getSubPath as r}from"./common-utils-C27Jp3s6.js";import{ofetch_default as i}from"./ofetch-DRl42yaJ.js";import{__dirname as a}from"./esm-shims-BDPl6Msv.js";import{timezone as o}from"./timezone-BrxBCotj.js";import s from"node:path";import{load as c}from"cheerio";const l={path:`/stats/*`,name:`国家统计局 通用`,url:`www.stats.gov.cn`,categories:[`government`],maintainers:[`bigfei`,`nczitzk`,`reply2future`],example:`/gov/stats/sj/zxfb`,handler:u,radar:[{title:`国家统计局 通用`,source:[`www.stats.gov.cn/*path`],target:`/gov/stats/*path`}],description:"::: tip\n路径处填写对应页面 URL 中 `http://www.stats.gov.cn/` 后的字段。下面是一个例子。\n\n若订阅 [数据 > 数据解读](http://www.stats.gov.cn/sj/sjjd/)\n则将对应页面 URL `http://www.stats.gov.cn/sj/sjjd/` 中 `http://www.stats.gov.cn/` 后的字段 `sj/sjjd` 作为路径填入。\n此时路由为 [`/gov/stats/sj/sjjd`](https://rsshub.app/gov/stats/sj/sjjd)\n\n若订阅 [新闻 > 时政要闻 > 中央精神](http://www.stats.gov.cn/xw/szyw/zyjs/)\n则将对应页面 URL `http://www.stats.gov.cn/xw/szyw/zyjs/` 中 `http://www.stats.gov.cn/`\n后的字段 `xw/szyw/zyjs` 作为路径填入。此时路由为 [`/gov/stats/xw/szyw/zyjs`](https://rsshub.app/gov/stats/xw/szyw/zyjs)\n:::"};async function u(l){let u=l.req.query(`limit`)?Number.parseInt(l.req.query(`limit`)):15,d=`http://www.stats.gov.cn`,{headers:f}=await i.raw(d),p=f?.getSetCookie().find(e=>e.startsWith(`wzws_sessionid=`))?.split(`;`)[0],m=r(l)===`/stats`?`/sj/zxfb/`:r(l).replace(/^\/stats(.*)/,`$1`),h=`${d}${m.endsWith(`/`)?m:m+`/`}`,g=await i(h,{headers:{Cookie:p,Referer:h}}),_=c(g),v=_(_(`a.pchide`).length===0?`a[title]`:`.list-content a.pchide`).slice(0,u).toArray().map(e=>(e=_(e),{title:e.attr(`title`),link:new URL(e.attr(`href`),h).href}));return v=await Promise.all(v.map(r=>e.tryGet(r.link,async()=>{let e=await i(r.link,{headers:{Cookie:p,Referer:d}}),l=c(e);if(/(news\.cn|www\.gov\.cn)/.test(r.link)){if(l(`.year`).text())r.pubDate=o(n(`${l(`.year`).text()}/${l(`.day`).text()} ${l(`.time`).text()}`,`YYYY/MM/DD HH:mm:ss`),8),r.author=l(`.source`).text().replace(/来源：/,``).trim();else{l(`.pages_print`).remove();let e=l(`.info, .pages-date`).text().split(`来源：`);r.pubDate=o(n(e[0].trim()),8),r.author=e.pop()}return r.title=r.title||l(`h1`).first().text()||l(`h2`).first().text(),r.description=l(`#detail, .xlcontent, .pages_content`).html(),r}return r.author=e.match(/来源：(.*?)</)?.[1]?.trim(),l(`.pchide`).remove(),r.title=r.title||l(`div.detail-title h1`).text(),r.pubDate=o(n(l(`div.detail-title-des h2 p, .info`).first().text().trim()),8),r.description=t(s.join(a,`templates/description-c9fe7148.art`),{description:l(`.TRS_Editor`).html()||l(`.TRS_UEDITOR`).html(),attachments:l(`a[oldsrc]`).toArray().map(e=>(e=_(e),{link:new URL(e.attr(`href`),r.link).href,name:e.text().trim()}))}),r}))),{title:_(`title`).text(),link:h,item:v}}export{l as route};