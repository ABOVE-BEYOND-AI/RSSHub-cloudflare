import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{getSubPath as n}from"./common-utils-C27Jp3s6.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import{load as o}from"cheerio";const s=`https://cbaigui.com`,c=`wp-json/wp/v2`,l=async(e,t)=>{let n=new URL(`${c}/${e}?search=${t}`,s).href,{data:r}=await i(n);return r.findLast(e=>e.name===t)?.id??void 0},u={path:`*`,name:`Unknown`,maintainers:[],handler:d};async function d(u){let d=u.req.query(`limit`)?Number.parseInt(u.req.query(`limit`),10):50,f,p=new URL(n(u).replace(/^\/cbaigui/,``),s).href,m=new URL(`${c}/posts?_embed=true&per_page=${d}`,s).href,h=n(u).match(/^\/post-(tag|category)\/(.*)$/);if(h){f=decodeURI(h[2].split(`/`).pop());let e=h[1]===`tag`?`tags`:`categories`,t=await l(e,f);t&&(m=new URL(`${c}/posts?_embed=true&per_page=${d}&${e}=${t}`,s).href)}let{data:g}=await i(m),_=g.slice(0,d).map(n=>{let i=n._embedded[`wp:term`],s=o(n.content?.rendered??n.content);return s(`figure`).each(function(){let t=s(this).find(`img`),n=t.prop(`data-actualsrc`)??t.prop(`data-original`),i=t.prop(`data-rawwidth`),o=t.prop(`data-rawheight`);s(this).replaceWith(e(a.join(r,`templates/figure-5fc0700a.art`),{src:n,width:i,height:o}))}),s(`p img`).each(function(){let t=s(this),n=t.prop(`src`).split(`!`)[0],i=t.prop(`width`),o=t.prop(`height`);s(this).replaceWith(e(a.join(r,`templates/figure-5fc0700a.art`),{src:n,width:i,height:o}))}),{title:n.title?.rendered??n.title,link:n.link,description:s.html(),author:n._embedded.author.map(e=>e.name).join(`/`),category:[...i[0],...i[1]].map(e=>e.name),guid:n.guid?.rendered??n.guid,pubDate:t(n.date_gmt),updated:t(n.modified_gmt)}}),{data:v}=await i(p),y=o(v),b=y(`link[rel="apple-touch-icon"]`).first().prop(`href`);return{item:_,title:`纪妖${f?` - ${f}`:``}`,link:p,description:y(`meta[name="description"]`).prop(`content`),language:`zh-cn`,image:y(`meta[name="msapplication-TileImage"]`).prop(`content`),icon:b,logo:b,subtitle:y(`p.site-description`).text(),author:y(`p.site-title`).text()}}export{u as route};