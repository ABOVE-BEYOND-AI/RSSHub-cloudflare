import{art as e}from"./render-DE4LRFBD.js";import{md5 as t}from"./md5-15Cn4YyR.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import i from"node:path";import{load as a}from"cheerio";const o=`https://www.iyingdi.com`,s=async(e,t)=>{let n=await Promise.all(t.map(t=>e.tryGet(t.link,async()=>{let e={post_id:t.postId,timestamp:``},{body:n}=await r({method:`post`,url:`https://api.iyingdi.com/web/post/info`,headers:{Host:`api.iyingdi.com`,"Login-Token":`nologin`,Origin:o,Platform:`pc`,Referer:`${o}/`},form:c(e)});return t.description=l(JSON.parse(n).post.content),t})));return n},c=(e,n)=>{let r=n?`8a11ed3712b699e749185674f1dc20b4`:`b8d5b38577b8bb382b0c783b474b95f9`;return e.key=r,e.timestamp=Math.floor(Date.now()/1e3),e.sign=t(new URLSearchParams(e).toString()),delete e.key,e},l=t=>{let r=/(<p>|<div>)(.*?)?<strong>(标准|狂野)日报投稿.*?<\/strong>(.*?)?(<\/p>|<\/div>)(.|\n)*$/,s=a(t.replace(r,``));return s(`.yingdi-car,.bbspost,.deck-set`).each((t,r)=>{let a=s(r).attr(`class`),c=s(r).attr(`data-id`),l=`${o}/web/tools/hearthstone/decks/setdetail?setid=${c}`,u=a===`yingdi-card bbspost`?`${o}/tz/post/${c}`:l,d=s(r).find(`.card-status .time`).text();s(r).find(`.card-info .title`).text((e,t)=>`${t} ${d}`),s(r).find(`.card-status`).remove(),s(r).find(`.card-info`).wrap(e(i.join(n,`templates/card-038fc8ce.art`),{url:u}))}),s(`.yingdi-image.gif`).each((e,t)=>{let n=s(t).attr(`data-original`);s(t).attr(`src`,n)}),s(`.yingdi-audio`).each((e,t)=>{s(t).find(`.audio-cover`).remove(),s(t).find(`.audio-area.hidden`).attr(`class`,`audio-area`)}),s(`.yingdi-video iframe`).each((t,r)=>{let a=s(r).attr(`src`).match(/bvid=(.*?)&/)[1];if(a){let t=`https://www.bilibili.com/video/${a}`;s(r).after(e(i.join(n,`templates/video-54339745.art`),{url:t}))}}),s(`.yingdi-card.user`).each((e,t)=>{s(t).prev(`p`).remove(),s(t).remove()}),s(`.action-button`).remove(),s(`.yingdi-ballot`).remove(),s(`hr`).remove(),s.html()};export{s as ProcessFeed,c as ProcessForm};