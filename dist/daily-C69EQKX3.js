import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import i from"node:path";import a from"dayjs";import{load as o}from"cheerio";const s={path:`/stats/daily/:country`,categories:[`other`],example:`/iknowwhatyoudownload/stats/daily/CN`,url:`iknowwhatyoudownload.com`,name:`Daily Torrents Statistics`,maintainers:[`p3psi-boo`],parameters:{country:`the country of the stats. ISO 3166-1 alpha-2 code.`},handler:c};async function c(s){let{country:c}=s.req.param(),l=`https://iknowwhatyoudownload.com/en/stat/${c}/daily/q?statDate=`,u=Array.from({length:7},(e,t)=>a().subtract(t,`day`)),d=(await Promise.all(u.map(a=>{let s=a.format(`YYYY-MM-DD`),u=`${l}${s}`;return e.tryGet(u,async()=>{let e=await r({method:`get`,url:u});if(!e)return{};let l=o(e.data),d=[];l(`.usePercent`).each((e,t)=>{d.push({percent:l(t).text(),desc:l(t).parent().find(`span`).last().text()})});let f=[],p=e.data.match(/data:\s*\[([\d",\s]+)\]/),m=e.data.match(/labels:\s*\[(.*?)\]/);if(p?.[1]&&m?.[1]){let e=p[1].split(`,`).map(e=>e.trim().replaceAll(`"`,``)),t=m[1].split(`,`).map(e=>e.replaceAll(`"`,``).trim()).filter(e=>e!==``);for(let n in t){let r=t[n],i=e[n],[a,o]=r.split(` `);f.push({key:a,count:i,percent:o})}}let h=l(`.tab-pane`).toArray().map(e=>({title:l(e).attr(`id`)?.toUpperCase(),content:l(e).find(`ul`).toString()})),g=t(i.join(n,`templates/daily-c7388d5f.art`),{numStats:d,tableData:f,topList:h});return{title:`Daily Torrents Statistics in ${c} for ${s}`,link:u,description:g,pubDate:a.toDate()}})}))).filter(e=>Object.keys(e).length>0);return{title:`Daily Torrents Statistics in ${c} - iknownwhatyoudownload`,link:`https://iknowwhatyoudownload.com`,item:d}}export{s as route};