import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import i from"node:path";import{load as a}from"cheerio";import o from"crypto-js";const s=`huxiu.com`,c=`https://www.${s}`,l=`https://api-article.${s}`,u=`https://api-brief.${s}`,d=`https://api-account.${s}`,f=`https://moment-api.${s}`,p=`https://search-api.${s}`,m=t=>{let r=a(t);return r(`div.neirong-shouquan`).remove(),r(`em.vote__bar, div.vote__btn, div.vote__time`).remove(),r(`p img`).each((t,a)=>{a=r(a),(a.prop(`src`)??a.prop(`_src`))!==void 0&&a.parent().replaceWith(e(i.join(n,`templates/description-31b75578.art`),{image:{src:(a.prop(`src`)??a.prop(`_src`)).split(/\?/)[0],width:a.prop(`data-w`),height:a.prop(`data-h`)}}))}),r(`p, span`).each((e,t)=>{t=r(t),t.contents().length===1&&/^\s*$/.test(t.text())?t.remove():(t.removeClass(),t.removeAttr(`data-check-id label class`))}),r(`.text-big-title`).each((e,t)=>{t.tagName=`h3`,t=r(t),t.removeClass(),t.removeAttr(`class`)}),r(`.text-sm-title`).each((e,t)=>{t.tagName=`h4`,t=r(t),t.removeClass(),t.removeAttr(`class`)}),r.html()},h=async e=>{let t=new URL(`briefColumn/detail`,u).href,{data:{data:n}}=await r.post(t,{form:{platform:`www`,brief_column_id:e}}),i=new URL(`club/${n.club_id}.html`,c).href,{data:o}=await r(i),s=a(o),l=`${n.name}-${n.sub_name}`,d=new URL(s(`link[rel="apple-touch-icon"]`).prop(`href`),c).href,f=s(`meta[name="author"]`).prop(`content`);return{title:`${l}-${f}`,link:i,description:n.summary,language:s(`html`).prop(`lang`),image:n.head_img,icon:d,logo:d,subtitle:l,author:f,itunes_author:f,itunes_category:`News`,allowEmpty:!0}},g=async e=>{let t=new URL(`club/${e}.html`,c).href,{data:n}=await r(t),i=a(n),o=i(`title`).text(),s=new URL(i(`link[rel="apple-touch-icon"]`).prop(`href`),c).href,l=i(`meta[name="author"]`).prop(`content`);return{data:{title:o,link:t,description:i(`ul.content-item li.content`).text().trim(),language:i(`html`).prop(`lang`),image:i(`div.header img.img`).prop(`data-src`)?.split(/\?/)[0]??void 0,icon:s,logo:s,subtitle:o.split(/-/)[0],author:l,itunes_author:l,itunes_category:`News`,allowEmpty:!0},briefColumnId:n.match(/"brief_column_id":"(\d+)",/)[1]}},_=async e=>{let{data:t}=await r(e),n=a(t),i=new URL(n(`link[rel="apple-touch-icon"]`).prop(`href`),c).href,o=n(`meta[name="author"]`).prop(`content`);return{title:n(`title`).text(),link:e,description:n(`div.tag-content`).text()||n(`span.author-intro`).text()||n(`p.collection__intro`).text()||n(`meta[name="description"]`).prop(`content`),language:n(`html`).prop(`lang`),icon:i,logo:i,subtitle:n(`title`).text().split(/-/)[0],author:o,itunes_author:o,itunes_category:`News`,allowEmpty:!0}},v=async a=>{let{data:o}=await r(a.link),s=x(o),c=s?.briefStoreModule?.brief_detail.brief??s?.articleDetail?.articleDetail??void 0;if(!c)return a;let{processed:l,processedItem:u={}}=C(c.audio_info);Object.keys(u).length!==0&&(u.itunes_item_image=c.pic_path??c.share_info?.share_img??void 0);let{processed:d,processedItem:f={}}=E(c.video_info);return a.title=c.title??a.title,a.description=e(i.join(n,`templates/description-31b75578.art`),{image:{src:c.pic_path},video:d,audio:l,preface:m(c.content_preface??c.preface),summary:c.ai_summary,description:m(c.content)}),a.author=c.user_info?.username??a.author,a.category=[c.video_article_tag,c.brief_column?.name??void 0,c.club_info?.name??void 0,...c.tags_info?.map(e=>e.name)??[],...c.relation_info?.channel?.map(e=>e.name)??[]].filter(Boolean),a.pubDate=t(c.dateline??c.publish_time,`X`),a.upvote=c.agreenum??a.upvote,a.comments=c.commentnum??c.total_comment_num??a.comments,a.upvote=Number.parseInt(a.upvote,10),a.comments=Number.parseInt(a.comments,10),{...u,...f,...a}},y=()=>{let e=``;for(let t=0;t<16;t++)e+=`abcdefghijklmnopqrstuvwxyz1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ`.charAt(Math.floor(Math.random()*62));return e},b=()=>{let e=Math.round(Date.now()/1e3).toString(),t=y(),n=[`hUzaABtNfDE-6UiyaYhfsmjW-8dnoyVc`,e,t].sort();return{nonce:t,timestamp:e,signature:o.SHA1(n[0]+n[1]+n[2]).toString()}},x=e=>{let t=e.match(/window\.__INITIAL_STATE__=({.*?});\(function\(\)/);if(t)return JSON.parse(t[1])},S=[``,`low`],C=e=>{let t=e?S.find(t=>Object.hasOwn(e,`audio_${t===``?``:`${t}_`}path`)):void 0;if(t===void 0)return{processed:void 0,processedItem:{}};let n=`audio_${t}path`,r=`audio_${t}size`,i={duration:e.format_length_new??e.format_length,size:Object.hasOwn(e,r)?e[r]:void 0,src:e[n],type:`audio/${e[n].split(/\./).pop()}`},a={itunes_duration:i.duration,enclosure_url:i.src,enclosure_length:i.size,enclosure_type:i.type};return{processed:i,processedItem:a}},w=async(r,a,o)=>(r=r.map(r=>{let a=``,o=``;if(r.moment_id)a=`huxiu-moment-${r.moment_id}`,o=r.url||new URL(`moment/${r.moment_id}.html`,c).href;else if(r.brief_id||/huxiu\.com\/brief\//.test(r.url))r.brief_id=r.brief_id??r.aid,a=`huxiu-brief-${r.brief_id}`,o=new URL(`brief/${r.brief_id}.html`,c).href;else if(r.aid)a=`huxiu-article-${r.aid}`,o=new URL(`article/${r.aid}.html`,c).href;else return``;let{processed:s,processedItem:l={}}=C(r.audio_info);Object.keys(l).length!==0&&(l.itunes_item_image=r.pic_path??r.share_info?.share_img??void 0);let{processed:u,processedItem:d={}}=E(r.video_info),f=r.count_info?.agree??r.count_info?.favtimes??r.agree_num??0,p=r.count_info?.disagree??0,m=r.count_info?.total_comment_num??r.count_info?.commentnum??r.total_comment_num??r.commentnum??0;return{...l,...d,title:(r.title??r.summary??r.content)?.replace(/<\/?(?:em|br)?>/g,``),link:o,description:e(i.join(n,`templates/description-31b75578.art`),{image:{src:r.origin_pic_path??r.pic_path??r.big_pic_path?.split(/\?/)[0]??void 0},audio:s,video:u,summary:r.summary??r.content??r.preface}),author:r.user_info?.username??r.brief_column?.name??r.author_info?.username??r.author,guid:a,pubDate:r.publish_time??r.dateline?t(r.publish_time??r.dateline,`X`):void 0,upvotes:Number.parseInt(f,10),downvotes:Number.parseInt(p,10),comments:Number.parseInt(m,10)}}).filter(Boolean).slice(0,a),await Promise.all(r.map(e=>o(e.guid,async()=>{if(new RegExp(s,`i`).test(new URL(e.link).hostname)){if(!e.guid.startsWith(`huxiu-moment`))return await v(e)}else return e;return e})))),T=[`fhd`,`fhd_medium`,`wifi`,`fhd_low`,`flow`,`hd`,`sd`],E=e=>{let t=e?T.find(t=>Object.hasOwn(e,`${t}_link`)):void 0;if(t===void 0)return{processed:void 0,processedItem:{}};let n=`${t}_link`,r=`origin_${t}_size`,i={duration:e.duration??e.origin_duration,poster:e.cover??e.custom_cover_path??e.gif_path,size:Object.hasOwn(e,r)?e[r]:void 0,src:e[n],type:`video/${e[n].split(/\./).pop()}`},a={itunes_item_image:i.poster,itunes_duration:i.duration,enclosure_url:i.src,enclosure_length:i.size,enclosure_type:i.type};return{processed:i,processedItem:a}};export{l as apiArticleRootUrl,u as apiBriefRootUrl,d as apiMemberRootUrl,f as apiMomentRootUrl,p as apiSearchRootUrl,h as fetchBriefColumnData,g as fetchClubData,_ as fetchData,b as generateSignature,w as processItems,c as rootUrl};