import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import{load as o}from"cheerio";const s={path:`/:region?/:category{.+}?`,name:`Unknown`,maintainers:[],handler:c};async function c(s){let{region:c=`cn-en`,category:l=`news`}=s.req.param(),u=s.req.query(`limit`)?Number.parseInt(s.req.query(`limit`),10):30,d=`https://www.kantarworldpanel.com/`,f=new URL(`${c}/${l}`,d).href,{data:p}=await i(f),m=o(p),h=m(`ul.slide, #newssource`).find(`li`).slice(0,u).toArray().map(e=>{e=m(e);let i=e.find(`a`),o=e.find(`img`),s=e.find(`h3.mediumFont`).text().trim(),c=i.prop(`href`);return c=c===`#`?f:c,{title:s,link:c,description:t(a.join(r,`templates/description-742410ab.art`),{description:e.find(`p.gowhite`).text(),image:o.prop(`src`)?{src:o.prop(`src`),alt:o.prop(`alt`)}:void 0}),guid:c.startsWith(d)?`${c}#${s}`:c,pubDate:n(e.find(`p.medGrey`).text(),`DD/MM/YYYY`)}});h=await Promise.all(h.map(t=>e.tryGet(t.link,async()=>{if(t.link===f||!t.link.startsWith(d))return t;if(/dwl\.php/.test(t.link))return t.enclosure_url=t.link,t.enclosure_type=`application/pdf`,t;let e=await i(t.link);if(!e.url.startsWith(d))return t;let r=o(e.data);return t.title=r(`h1.newshead`).text(),t.description=r(`div.center-content div.left-layout-col`).html(),t.category=r(`meta[name="keywords"]`).prop(`content`)?.split(/,\s?/)??[],t.pubDate=n(r(`p.newsdateshare`).text(),`DD/MM/YYYY`),t})));let g=new URL(`favicon.ico`,d).href;return{item:h,title:m(`title`).text(),link:f,description:m(`meta[name="description"]`).prop(`content`),language:m(`html`).prop(`lang`),image:m(`#logoprint img`).prop(`src`),icon:g,logo:g,subtitle:m(`meta[name="keywords"]`).prop(`content`),allowEmpty:!0}}export{s as route};