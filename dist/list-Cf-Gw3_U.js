import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{timezone as a}from"./timezone-BrxBCotj.js";import{ViewType as o}from"./types-D9T3SQ-7.js";import s from"node:path";import{load as c}from"cheerio";const l=async o=>{let{id:l=`datalist`}=o.req.param(),u=Number.parseInt(o.req.query(`limit`)??`30`,10),d=new URL(l.endsWith(`/`)?l:`${l}/`,`http://www.fangchan.com`).href,f=new URL(`api/${l.endsWith(`/`)?l.replace(/\/$/,``):l}.json`,`http://news.fangchan.com`).href,p=await r(d),m=c(p),h=m(`html`).attr(`lang`)??`zh-CN`,g=await r(f,{query:{pagesize:u,page:1}}),_=[];_=g.data.slice(0,u).map(e=>{let r=e.title,a=t(s.join(i,`templates/description-ca64252b.art`),{intro:e.zhaiyao}),o=e.createtime,c=e.url,l=[...new Set([e.topcolumn,e.subcolumn,...e.keyword?.split(/,/)??[]].filter(Boolean))],u=e.pic,d=e.createtime,f={title:r,description:a,pubDate:o?n(o,`X`):void 0,link:c,id:l,content:{html:a,text:e.zhaiyao??a},image:u,banner:u,updated:d?n(d,`X`):void 0,language:h};return f}),_=(await Promise.all(_.map(t=>t.link?e.tryGet(t.link,async()=>{let e=await r(t.link),i=c(e),o=i(`div.summary-text h`).text(),s=(t.description??``)+(i(`div.top-info`).html()??``)+(i(`div.summary-text-p`).html()??``),l=i(`span.news-date`).text().match(/\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}/)?.[1],u=i(`a.news-column, div.label span`).toArray(),d=[...new Set([...t.id,...u.map(e=>i(e).text()).filter(Boolean)].filter(Boolean))],f=i(`span.news-date`).text()?.split(/\d{4}-\d{2}-\d{2}/)?.[0]?.trim()?.split(/\s/)?.map(e=>({name:e})),p=l,m={title:o,description:s,pubDate:l?a(n(l),8):t.pubDate,id:d,author:f,content:{html:s,text:s},updated:p?a(n(p),8):t.updated,language:h},g=i(`ul.xgxw-ul li a`).toArray(),_=g.map(e=>{let t=i(e);return{url:t.attr(`href`),type:`related`,content_html:t.text()}}).filter(e=>!0);return _&&(m={...m,_extra:{links:_}}),{...t,...m}}):t))).filter(e=>!0);let v=`中房网`;return{title:`${v} - ${m(`div.curmbs a`).text()}`,description:m(`meta[name="description"]`).attr(`content`),link:d,item:_,allowEmpty:!0,author:v,language:h}},u={path:`/list/:id?`,name:`列表`,url:`www.fangchan.com`,maintainers:[`nczitzk`],handler:l,example:`/fangchan/list/datalist`,parameters:{id:{description:"分类，默认为 `datalist`，即数据研究，可在对应分类页 URL 中找到",options:[{label:`数据研究`,value:`datalist`},{label:`行业测评`,value:`industrylist`},{label:`政策法规`,value:`policylist`}]}},description:":::tip\n若订阅 [列表](https://www.fangchan.com/)，网址为 `https://www.fangchan.com/`，请截取 `https://www.fangchan.com/` 到末尾 `.html` 的部分 `datalist` 作为 `id` 参数填入，此时目标路由为 [`/fangchan/datalist`](https://rsshub.app/fangchan/datalist)。\n:::\n\n| [数据研究](https://www.fangchan.com/datalist)         | [行业测评](https://www.fangchan.com/industrylist)             | [政策法规](https://www.fangchan.com/policylist)           |\n| ----------------------------------------------------- | ------------------------------------------------------------- | --------------------------------------------------------- |\n| [datalist](https://rsshub.app/fangchan/list/datalist) | [industrylist](https://rsshub.app/fangchan/list/industrylist) | [policylist](https://rsshub.app/fangchan/list/policylist) |\n",categories:[`new-media`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.fangchan.com/:id`],target:e=>{let t=e.id;return`/fangchan/list/${t?`/${t}`:``}`}},{title:`数据研究`,source:[`www.fangchan.com/datalist`],target:`/list/datalist`},{title:`行业测评`,source:[`www.fangchan.com/industrylist`],target:`/list/industrylist`},{title:`政策法规`,source:[`www.fangchan.com/policylist`],target:`/list/policylist`}],view:o.Articles};export{l as handler,u as route};