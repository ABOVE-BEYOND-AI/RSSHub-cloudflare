import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import{ofetch_default as i}from"./ofetch-DRl42yaJ.js";import{__dirname as a}from"./esm-shims-BDPl6Msv.js";import o from"node:path";import{load as s}from"cheerio";import c from"p-map";const l={path:`/comic/:id/:chapterCnt?`,categories:[`anime`],example:`/copymanga/comic/dianjuren/5`,parameters:{id:`漫画ID`,chapterCnt:"返回章节的数量，默认为 `10`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`漫画更新`,maintainers:[`btdwv`,`marvolo666`],handler:u};async function u(l){let u=l.req.param(`id`),d=Number(l.req.param(`chapterCnt`)||10),f=`www.mangacopy.com`,p=`https://${f}`,m=`https://${f}`,h=`${m}/api/v3/comic/${u}/group/default/chapters`,g=await t.tryGet(h,async()=>{let e=!1,t=[],n=0;do{e=!1;let r=await i(h,{headers:{platform:``},query:{limit:500,offset:n}}),{code:a,results:o}=r;if(a!==200)break;o.limit+o.offset<o.total&&(e=!0),n+=500,t=[...t,...o.list]}while(e);return t=t.map(({comic_path_word:e,uuid:t,name:n,size:i,datetime_created:a,ordered:o})=>({link:`${p}/comic/${e}/chapter/${t}`,guid:`https://copymanga.site/comic/${e}/chapter/${t}`,uuid:t,title:n,size:i,pubDate:r(a,`YYYY-MM-DD`),ordered:o})).sort((e,t)=>t.ordered-e.ordered),t},e.cache.routeExpire,!1),{bookTitle:_,bookIntro:v}=await t.tryGet(`${p}/comic/${u}`,async()=>{let e=await i(`${p}/comic/${u}`),t=s(e);return{bookTitle:t(`.comicParticulars-title-right > ul > li > h6`).text(),bookIntro:t(`.intro`).text()}}),y=async e=>{let{code:t,results:r}=await i(`${m}/api/v3/comic/${u}/chapter/${e.uuid}`,{headers:{webp:`1`}}),s=t===210?[]:r.chapter.contents.map(e=>({url:e.url.replace(`.c800x.`,`.c1500x.`)}));return{link:e.link,guid:e.guid,title:e.title,description:n(o.join(a,`templates/comic-da154ac8.art`),{size:e.size,contents:s}),pubDate:e.pubDate}},b=await c(g.slice(0,d),e=>t.tryGet(e.link,()=>y(e)),{concurrency:3}),x=[...b,...g.slice(d)];return{title:`拷贝漫画 - ${_}`,link:`${p}/comic/${u}`,description:v,item:x}}export{l as route};