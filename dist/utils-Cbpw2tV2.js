import{config as e}from"./config-HRWLmo66.js";import{art as t}from"./render-DE4LRFBD.js";import{md5 as n}from"./md5-15Cn4YyR.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import a from"node:path";import o from"crypto-js";function s(e){let t=``;for(let n=0;n<e;n++)t+=c(16*Math.random());return l(t,e)}function c(e){return Math.ceil(e).toString(16).toUpperCase()}function l(e,t){let n=``;if(e.length<t)for(let r=0;r<t-e.length;r++)n+=`0`;return n+e}function u(){let e=Date.now().toString(16).toUpperCase(),t=s(8)+`_`+e;return t}function d(){let e=s(8),t=s(4),n=s(4),r=s(4),i=s(12),a=Date.now();return e+`-`+t+`-`+n+`-`+r+`-`+i+l((a%1e5).toString(),5)+`infoc`}function f(e){let t=``;for(let n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)-1);return t}function p(e){let t=o.HmacSHA256(`ts${e}`,f(`YhxToH[2q`)),n=o.enc.Hex.stringify(t);return n}function m(e,t){return`${e}&w_webid=${encodeURIComponent(t)}`}function h(e,t){let r=new URLSearchParams(e);r.sort();let i=r.toString(),a=Math.round(Date.now()/1e3),o=n(`${i}&wts=${a}${t}`);return`${e}&w_rid=${o}&wts=${a}`}function g(e,t){let n=Math.PI*2,r=Math.random(),i=Math.random(),a=Math.sqrt(-2*Math.log(r))*Math.cos(n*i);return Math.round(a*t+e)}function _(){if(e.bilibili.dmImgList!==void 0){let t=JSON.parse(e.bilibili.dmImgList);return JSON.stringify([t[Math.floor(Math.random()*t.length)]])}let t=Math.max(g(1245,5),0),n=Math.max(g(1285,5),0),r=[{x:3*t+2*n,y:4*t-5*n,z:0,timestamp:Math.max(g(30,5),0),type:0}];return JSON.stringify(r)}function v(){if(e.bilibili.dmImgInter!==void 0){let t=JSON.parse(e.bilibili.dmImgInter);return JSON.stringify([t[Math.floor(Math.random()*t.length)]])}let t=S(274,601),n=x(134,30),r=S(332,64),i=x(1101,338),a=x(0,0),o=S(1245,1285),s=[{t:y(`div`),c:b(`clearfix g-search search-container`),p:[t[0],t[2],t[1]],s:[n[2],n[0],n[1]]},{t:y(`div`),c:b(`wrapper`),p:[r[0],r[2],r[1]],s:[i[2],i[0],i[1]]}];return JSON.stringify({ds:s,wh:o,of:a})}function y(e){return{a:4,article:29,button:7,div:2,em:27,form:17,h1:11,h2:12,h3:13,h4:14,h5:15,h6:16,img:5,input:6,label:25,li:10,ol:9,option:20,p:3,section:28,select:19,span:1,strong:26,table:21,td:23,textarea:18,th:24,tr:22,ul:8}[e]}function b(e){return Buffer.from(e).toString(`base64`).slice(0,-2)}function x(e,t){let n=Math.floor(514*Math.random());return[3*e+2*t+n,4*e-4*t+2*n,n]}function S(e,t){let n=Math.floor(114*Math.random());return[2*e+2*t+3*n,4*e-t+n,n]}function C(e,t){let n=Buffer.from(`no webgl`).toString(`base64`).slice(0,-2),r=Buffer.from(`no webgl`).toString(`base64`).slice(0,-2);return`${e}&dm_img_list=${t}&dm_img_str=${n}&dm_cover_img_str=${r}`}function w(e,t,n){return`${C(e,t)}&dm_img_inter=${n}`}const T=(t,n)=>n.tryGet(`bilibili:getBangumi:${t}`,async()=>{let e=await r(`https://api.bilibili.com/pgc/view/web/media`,{query:{media_id:t}});return e.result.share_url===void 0&&(e.result.share_url=`https://www.bilibili.com/bangumi/media/md${e.result.media_id}`),e.result},e.cache.routeExpire,!1),E=(t,n)=>n.tryGet(`bilibili:getBangumiItems:${t}`,async()=>{let e=await r(`https://api.bilibili.com/pgc/web/season/section`,{query:{season_id:t}});return e.result},e.cache.routeExpire,!1),D=(e,n,r,o,s,c)=>{let l=t(a.join(i,`templates/description-61f6e33d.art`),{embed:e,ugc:!0,aid:o,cid:s,bvid:c,img:n.replace(`http://`,`https://`),description:r});return l},O=(e,n,r,o,s)=>{let c=t(a.join(i,`templates/description-61f6e33d.art`),{embed:e,ogv:!0,seasonId:o,episodeId:s,img:n.replace(`http://`,`https://`),description:r});return c};function k(e){return e?`https://www.bilibili.com/blackboard/newplayer.html?isOutside=true&autoplay=true&danmaku=true&muted=false&highQuality=true&bvid=${e}`:void 0}const A=e=>e?`https://www.bilibili.com/blackboard/live/live-activity-player.html?cid=${e}`:void 0;var j={lsid:u,_uuid:d,hexsign:p,addWbiVerifyInfo:h,getDmImgList:_,getDmImgInter:v,addDmVerifyInfo:C,addDmVerifyInfoWithInter:w,bvidTime:1589990400,addRenderData:m,getBangumi:T,getBangumiItems:E,renderUGCDescription:D,renderOGVDescription:O,getVideoUrl:k};export{A as getLiveUrl,k as getVideoUrl,j as utils_default};