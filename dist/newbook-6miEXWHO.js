import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import o from"node:path";const s={path:String.raw`/lib/space/:path{newbook.*}`,name:`图书馆 - 新书速递`,url:`space.lib.buaa.edu.cn/mspace/newBook`,maintainers:[`OverflowCat`],example:`/buaa/lib/space/newbook/`,handler:c,description:"可通过参数进行筛选：`/buaa/lib/space/newbook/key1=value1&key2=value2...`\n- `dcpCode`：学科分类代码\n  - 例：\n    - 工学：`08`\n    - 工学 > 计算机 > 计算机科学与技术：`080901`\n  - 默认值：`nolimit`\n  - 注意事项：不可与 `clsNo` 同时使用。\n- `clsNo`：中图分类号\n  - 例：\n    - 计算机科学：`TP3`\n  - 默认值：无\n  - 注意事项\n    - 不可与 `dcpCode` 同时使用。\n    - 此模式下获取不到上架日期。\n- `libCode`：图书馆代码\n  - 例：\n    - 本馆：`00000`\n  - 默认值：无\n  - 注意事项：只有本馆一个可选值。\n- `locaCode`：馆藏地代码\n  - 例：\n    - 五层西-中文新书借阅室(A-Z类)：`02503`\n  - 默认值：无\n  - 注意事项：必须与 `libCode` 同时使用。\n\n示例：\n- `buaa/lib/space/newbook` 为所有新书\n- `buaa/lib/space/newbook/clsNo=U&libCode=00000&locaCode=60001` 为沙河教2图书馆所有中图分类号为 U（交通运输）的书籍\n",categories:[`university`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1}};async function c(e){let t=e.req.param(`path`),n=t.indexOf(`/`),r=n===-1?``:t.slice(n+1),a=new URLSearchParams(r),o=a.get(`dcpCode`),s=a.get(`clsNo`);if(o&&s)throw Error(`dcpCode and clsNo cannot be used at the same time`);a.set(`pageSize`,`100`),a.set(`page`,`1`),!o&&!s&&a.set(`dcpCode`,`nolimit`);let c=`https://space.lib.buaa.edu.cn/meta-local/opac/new/100/${s?`byclass`:`bysubject`}?${a.toString()}`,{data:u}=await i(c),d=u?.data?.dataList||[],f=await Promise.all(d.map(async e=>await l(e))),p={title:`北航图书馆 - 新书速递`,item:f,description:`北京航空航天大学图书馆新书速递`,language:`zh-CN`,link:`https://space.lib.buaa.edu.cn/space/newBook`,author:`北京航空航天大学图书馆`,allowEmpty:!0,image:`https://lib.buaa.edu.cn/apple-touch-icon.png`};return p}async function l(i){return await e.tryGet(i.isbn,async()=>{let e=await u(i.isbn),s=JSON.parse(i.holdings),c=`https://space.lib.buaa.edu.cn/space/searchDetailLocal/${i.bibId}`,l=t(o.join(r,`templates/newbook-d3aea22a.art`),{item:i,info:e,holdings:s});return{language:i.language===`eng`?`en`:`zh-CN`,title:i.title,pubDate:i.onSelfDate?a(n(i.onSelfDate),8):void 0,description:l,link:c}})}async function u(e){let t=`https://space.lib.buaa.edu.cn/meta-local/opac/third_api/douban/${e}/info`,n=await i(t);return JSON.parse(n.body).data}export{s as route};