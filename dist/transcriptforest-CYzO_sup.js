import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import{load as o}from"cheerio";const s=e=>{let t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60),i=String(t).padStart(2,`0`),a=String(n).padStart(2,`0`),o=String(r).padStart(2,`0`);return`${i}:${a}:${o}`},c={path:`/:channel?`,radar:[{source:[`www.transcriptforest.com/en/channel`],target:``}],name:`Unknown`,maintainers:[`nczitzk`],handler:l,url:`www.transcriptforest.com/en/channel`};async function l(c){let l=c.req.param(`channel`),u=c.req.query(`limit`)?Number.parseInt(c.req.query(`limit`),10):10,d=`https://www.transcriptforest.com`,{data:f}=await i(d),p=JSON.parse(f.match(/({"props".*"scriptLoader":\[]})<\/script>/)?.[1]),m=p.buildId,h=p.defaultLocale,g=p.props.pageProps.listChannel,_=l?g.find(e=>e.channel_id===l||e.channel_name===l):void 0,v=new URL(`_next/data/${m}/en${_?`/channel/${_.channel_id}`:``}.json`,d).href,y=new URL(_?`${h}/channel/${_.channel_id}`:``,d).href,{data:b}=await i(v,{searchParams:{channelName:_?_.channel_id:``,offset:0}}),x=b.pageProps.listEpisode.data.slice(0,u).map(e=>({title:e.episode_name,link:new URL(`${h}/${e.channel_id}/${e.episode_id}`,d).href,detailUrl:new URL(`_next/data/${m}/${h}/${e.channel_id}/${e.episode_id}.json`,d).href,description:t(a.join(r,`templates/description-e0151c0f.art`),{texts:e.episode_description.split(/\n\n/).map(e=>({text:e}))}),author:e.channel_name,guid:e.id,pubDate:n(e.published_at),updated:n(e.updated_at),itunes_item_image:e.episode_cover.split(/\?/)[0],itunes_duration:e.episode_duration,enclosure_url:e.source_media,enclosure_type:`audio/mpeg`}));x=await Promise.all(x.map(n=>e.tryGet(n.link,async()=>{let{data:e}=await i(n.detailUrl),{data:o}=await i(e.pageProps.currentEpisode.ps4_url);return n.description=t(a.join(r,`templates/description-e0151c0f.art`),{audios:[{src:e.pageProps.currentEpisode.media,type:`audio/mpeg`}]})+n.description+t(a.join(r,`templates/description-e0151c0f.art`),{texts:o.map(e=>({startTime:s(e.startTime),endTime:s(e.endTime),text:e.readOnlyText}))}),delete n.detailUrl,n})));let{data:S}=await i(y),C=o(S),w=C(`title`).text(),T=C(`meta[property="og:image"]`).prop(`content`),E=new URL(C(`link[rel="apple-touch-icon"]`).prop(`href`),d).href,D=w.split(/\|/)[0].trim();return{item:x,title:w,link:y,description:C(`meta[name="description"]`).prop(`content`),language:C(`html`).prop(`lang`),image:T,icon:E,logo:E,author:D,itunes_author:D,allowEmpty:!0}}export{c as route};