import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t,parseRelativeDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{invalid_parameter_default as a}from"./invalid-parameter-CfUmvEUg.js";import{queryToBoolean as o}from"./readable-social-Dobs5p4y.js";import s from"node:path";import{load as c}from"cheerio";const l=async(e,i)=>{let a=`https://bgm.tv/subject/${e}/comments`,o=await r(a),s=c(o),l=s(`.nameSingle`).find(`a`).text(),u=s(`.item`).toArray().map(e=>{let r=s(e),i=r.find(`.starlight`),a=null;i.length>0&&(a=i.attr(`class`).match(/stars(\d)/)[1]);let o=r.find(`small.grey`).text().slice(2),c=o.includes(`ago`)?n(o):t(o);return{user:r.find(`.l`).text(),rate:a||`无`,content:r.find(`p`).text(),date:c}}).filter(e=>e.content.length>=i);return{title:`${l}的 Bangumi 吐槽箱`,link:a,item:u.map(e=>({title:`${e.user}的吐槽`,description:`【评分：${e.rate}】  ${e.content}`,guid:`${a}#${e.user}`,pubDate:e.date,link:a}))}};var u=l;const d=(e,t)=>t?e.name||e.name_cn:e.name_cn||e.name,f=e=>{let n={blog:{en:`reviews`,cn:`评论`},topic:{en:`board`,cn:`讨论`}};return async(i,a)=>{let o=`https://api.bgm.tv/subject/${i}?responseGroup=large`,s=await r(o);return{title:`${d(s,a)}的 Bangumi ${n[e].cn}`,link:`https://bgm.tv/subject/${s.id}/${n[e].en}`,item:s[e].map(e=>({title:`${e.user.nickname}：${e.title}`,description:e.summary||``,link:e.url.replace(`http:`,`https:`),pubDate:t(e.timestamp,`X`),author:e.user.nickname}))}}};var p=f;const m=async(n,a)=>{let o=`https://api.bgm.tv/subject/${n}?responseGroup=large`,c=await r(o),l=c.eps.filter(e=>e.status===`Air`);return{title:d(c,a),link:`https://bgm.tv/subject/${n}`,description:c.summary,item:l.map(n=>({title:`ep.${n.sort} ${d(n,a)}`,description:e(s.join(i,`templates/ep-e0bc570f.art`),{e:n,epsInfo:c}),pubDate:t(n.airdate),link:n.url.replace(`http:`,`https:`)}))}};var h=m;const g={path:`/subject/:id/:type?/:showOriginalName?`,categories:[`anime`],example:`/bangumi.tv/subject/328609/ep/true`,parameters:{id:`条目 id, 在条目页面的地址栏查看`,type:"条目类型，可选值为 `ep`, `comments`, `blogs`, `topics`，默认为 `ep`",showOriginalName:`显示番剧标题原名，可选值 0/1/false/true，默认为 false`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`bgm.tv/subject/:id`],target:`/tv/subject/:id`}],name:`条目的通用路由格式`,maintainers:[`JimenezLi`],handler:_,description:`::: warning
  此通用路由仅用于对路由参数的描述，具体信息请查看下方与条目相关的路由
:::`};async function _(e){let t=e.req.param(`id`),n=e.req.param(`type`)||`ep`,r=o(e.req.param(`showOriginalName`)),i;switch(n){case`ep`:i=await h(t,r);break;case`comments`:i=await u(t,Number(e.req.query(`minLength`))||0);break;case`blogs`:i=await p(`blog`)(t,r);break;case`topics`:i=await p(`topic`)(t,r);break;default:throw new a(`暂不支持对${n}的订阅`)}return i}export{g as route};