import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./proxy-BQXcrhTu.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{not_found_default as i}from"./not-found-BfsMaUzS.js";import{__dirname as a}from"./esm-shims-BDPl6Msv.js";import{getPuppeteerPage as o}from"./puppeteer-BAoY_Fpy.js";import s from"node:path";import{load as c}from"cheerio";const l={path:`/profile/:id/:type?/:functionalFlag?`,categories:[`social-media`],example:`/picuki/profile/linustech`,parameters:{id:`Tiktok user id (without @)`,type:{description:`Type of profile page`,options:[{value:`profile`,label:`Profile Page`},{value:`story`,label:`Story Page`}],default:`profile`},functionalFlag:{description:`Functional flag for video embedding`,options:[{value:`0`,label:`Off, only show video poster as an image`},{value:`1`,label:`On`}],default:`1`}},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.picuki.com/profile/:id`],target:`/profile/:id`},{source:[`www.picuki.com/story/:id`],target:`/profile/:id/story`}],name:`User Profile - Picuki`,maintainers:[`hoilc`,`Rongronggg9`,`devinmugen`,`NekoAria`],handler:u};async function u(l){let u=l.req.param(`id`),d=l.req.param(`type`)??`profile`,f=l.req.param(`functionalFlag`)??`1`,p=f!==`0`,m=`https://www.picuki.com`,h=`${m}/${d===`story`?`story`:`profile`}/${u}`,g=await t.tryGet(`picuki:${d}:${u}`,async()=>{let t;try{t=await r(h,{headers:{"User-Agent":e.trueUA}})}catch(e){if(e.status===403){let{page:e,destory:n}=await o(h,{onBeforeLoad:async e=>{let t=new Set([`document`,`script`,`xhr`,`fetch`]);await e.setRequestInterception(!0),e.on(`request`,e=>{t.has(e.resourceType())?e.continue():e.abort()})}});await e.waitForSelector(`.content`),t=await e.content(),await n()}else throw new i(e.message)}let n=c(t);if(n(`.posts-empty`).length)throw Error(n(`.posts-empty`).text().trim()||`No posts found`);if(n(`.error-p`).length)throw Error(n(`.error-p span`).text().trim()||`Profile not found`);let a=n(`.profile-info .username`).text().trim(),s=n(`.posts-video .posts__video-item`).toArray().map(e=>{let t=n(e),r=t.attr(`href`)?.split(`/`).pop(),i=t.find(`img`);return{title:i.attr(`alt`)||``,author:a,renderData:{poster:i.attr(`src`),source:t.find(`.popup-open`).data(`source`),id:r},link:`${m}/media/${r}`,guid:`https://www.tiktok.com/@${u}/video/${r}`}});return{title:n(`head title`).text(),description:n(`.posts-current`).text().trim(),image:n(`.profile-image`).attr(`src`),items:s}}),_=g.items.map(e=>({...e,description:n(s.join(a,`templates/user-3df0b995.art`),{poster:e.renderData.poster,source:e.renderData.source,useIframe:p,id:e.renderData.id})}));return{title:g.title,link:h,image:g.image,description:g.description,item:_}}export{l as route};