import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{invalid_parameter_default as a}from"./invalid-parameter-CfUmvEUg.js";import{rss_parser_default as o}from"./rss-parser-Dx7FersL.js";import s from"node:path";import{load as c}from"cheerio";const l=new Set([`tw`,`hk`]),u={path:`/:region?`,categories:[`new-media`],example:`/eprice/tw`,parameters:{region:`地区，预设为 tw`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`最新消息`,maintainers:[`TonyRL`],handler:d,description:`地区：

| hk   | tw   |
| ---- | ---- |
| 香港 | 台湾 |`};async function d(u){let d=u.req.param(`region`)??`tw`;if(!l.has(d))throw new a(`Invalid region`);let f=await o.parseURL(`https://www.eprice.com.${d}/news/rss.xml`);for(let e of f.items)e.link=e.link.replace(/^http:\/\//i,`https://`);let p=await Promise.all(f.items.map(a=>e.tryGet(a.link,async()=>{let e=await i(a.link,{headers:{Referer:`https://www.eprice.com.${d}`}}),o=c(e.data);return o(`noscript`).remove(),o(`div[id^=dablewidget]`).remove(),o(`div[class^=parallax-ads]`).remove(),o(`.adsbygoogle, .join-eprice-fb, .teads`).remove(),o(`div.ad-336x280-g, div.ad-728x90-g`).remove(),o(`div.clear, div.news-vote, div.signature`).remove(),o(`ul.inner, ul.navigator, ul.infobar`).remove(),o(`iframe[src^="https://www.facebook.com/plugins/like.php"]`).remove(),a.category=a.categories,o(`a`).each((e,n)=>{n=o(n),n.attr(`href`)&&n.attr(`href`).endsWith(`.jpg`)&&(n.after(t(s.join(r,`templates/image-7c03cac4.art`),{alt:n.attr(`title`),src:n.attr(`href`)})),n.remove())}),o(`img`).each((e,t)=>{t=o(t),t.attr(`data-original`)&&t.attr(`src`,t.attr(`data-original`))}),delete a.categories,delete a.content,delete a.contentSnippet,delete a.creator,delete a.enclosure,delete a.isoDate,a.description=o(`div.user-comment-block`).html()||o(`div.content`).html()||o(`li.inner`).html()||o(`div.section-content`).html()||o(`.article__content`).html(),a.pubDate=n(a.pubDate),a}))),m={title:f.title,link:f.link,description:f.description,item:p,image:f.image.url,language:f.language};return u.set(`json`,m),m}export{u as route};