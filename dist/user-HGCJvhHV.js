import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import{ViewType as i}from"./types-D9T3SQ-7.js";import a from"node:path";import{load as o}from"cheerio";const s={"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`},c={path:`/:userid`,categories:[`social-media`],view:i.Audios,example:`/changba/skp6hhF59n48R-UpqO3izw`,parameters:{userid:`用户ID, 可在对应分享页面的 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!0,supportScihub:!1},radar:[{source:[`changba.com/s/:userid`]}],name:`用户`,maintainers:[`kt286`,`xizeyoupan`,`pseudoyu`],handler:l};async function l(i){let c=i.req.param(`userid`),l=`https://changba.com/wap/index.php?s=${c}`,u=await r({method:`get`,url:l,headers:s}),d=u.data,f=o(d),p=f(`.user-work .work-info`).toArray(),m=f(`div.user-main-info > span.txt-info > a.uname`).text(),h=f(`div.user-main-info > .poster > img`).attr(`data-src`),g=await Promise.all(p.map(i=>{let c=o(i),l=c(`a`).attr(`href`);return e.tryGet(l,async()=>{let e=await r({method:`get`,url:l,headers:s}),i=/workid: '\d+'/,o;try{o=e.data.match(i)[0]}catch{return null}if(o=o.split(`'`)[1],!o)return null;let u=`https://upscuw.changba.com/${o}.mp3`,d=t(a.join(n,`templates/work_description-7637ee4a.art`),{desc:c(`div.des`).text(),mp3url:u}),f=c(`div.work-cover`).attr(`style`).replace(`)`,``).split(`url(`)[1];return{title:c(`.work-title`).text(),description:d,link:l,author:m,itunes_item_image:f,enclosure_url:u,enclosure_type:`audio/mpeg`}})}));return g=g.filter(Boolean),{title:m+` - 唱吧`,link:l,description:f(`meta[name="description"]`).attr(`content`)||m+` - 唱吧`,item:g,image:h,itunes_author:m,itunes_category:`唱吧`}}export{c as route};