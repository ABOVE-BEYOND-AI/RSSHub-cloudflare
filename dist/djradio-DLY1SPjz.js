import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{got_default as a}from"./got-BaOFZRd4.js";import o from"node:path";const s={path:`/music/djradio/:id/:info?`,categories:[`multimedia`],example:`/163/music/djradio/347317067`,parameters:{id:`节目 id, 可在电台节目页 URL 中找到`,info:`默认在正文尾部显示节目相关信息，任意值为不显示`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!0,supportScihub:!1},name:`电台节目`,maintainers:[`magic-akari`],handler:l},c=(n,r,i)=>t.tryGet(`163:music:djradio:${n}:${r}:${i}`,async()=>await a.post(`https://music.163.com/api/dj/program/byradio`,{headers:{Referer:`https://music.163.com/`},form:{radioId:n,limit:r,offset:i}}),e.cache.routeExpire,!1);async function l(e){let t=e.req.param(`id`),a=!e.req.param(`info`),s=await c(t,1,0),l=s.data.programs||[],{radio:u,dj:d}=l[0]||{radio:{},dj:{}},f=s.data.count||0,p=Array.from({length:Math.ceil(f/500)},(e,t)=>t),m=await Promise.all(p.map(async e=>{let s=await c(t,500,e*500),l=s.data.programs||[],u=l.map(e=>{let t=(e.description||``).split(`
`).map(e=>e),s=Math.trunc(e.duration/1e3),c=`${(s/60).toFixed(0).padStart(2,`0`)}:${(s%60).toFixed(0).padStart(2,`0`)}`,l=n(o.join(i,`templates/djradio-content-def0dea8.art`),{pg:e,description:t,itunes_duration:c,info:a});return{title:e.name,link:`https://music.163.com/program/`+e.id,pubDate:r(e.createTime),published:r(e.createTime),author:e.dj.nickname,description:l,content:{html:l},itunes_item_image:e.coverUrl,enclosure_url:`https://music.163.com/song/media/outer/url?id=${e.mainTrackId}.mp3`,enclosure_type:`audio/mpeg`,itunes_duration:s}});return u}));return{title:u.name,link:`https://music.163.com/djradio?id=${t}`,subtitle:u.desc,description:u.desc,author:d.nickname,updated:u.lastProgramCreateTime,icon:u.picUrl,image:u.picUrl,itunes_author:d.nickname,itunes_category:u.category,item:m.flat()}}export{s as route};