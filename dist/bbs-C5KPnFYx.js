import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import o from"node:path";import{load as s}from"cheerio";const c={path:[`/bbs/:id?/:order?`,`/bxj/:id?/:order?`],categories:[`bbs`],example:`/hupu/bbs/topic-daily`,parameters:{id:`编号，可在对应社区 URL 中找到，默认为#步行街主干道`,order:"排序方式，可选 `0` 即 最新回复 或 `1` 即 最新发布，默认为最新回复"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`m.hupu.com/:category`,`m.hupu.com/`],target:`/:category`}],name:`社区`,maintainers:[`LogicJake`,`nczitzk`],handler:l,description:`::: tip
  更多社区参见 [社区](https://bbs.hupu.com)
:::`};async function l(c){let l=c.req.param(`id`)??`34`,u=c.req.param(`order`)??`1`,d=`https://bbs.hupu.com`,f=`${d}/${l}${u===`1`?`-postdate`:``}`,p=await i({method:`get`,url:f}),m=s(p.data);m(`.page-icon`).remove();let h=m(`.bbs-sl-web-post-layout .post-title a`).toArray().map(e=>(e=m(e),{title:e.text(),link:`${d}${e.attr(`href`)}`,pubDate:a(n(e.parent().parent().find(`.post-time`).text(),`MM-DD HH:mm`),8)}));return h=await Promise.all(h.map(n=>e.tryGet(n.link,async()=>{try{let e=await i({method:`get`,url:n.link}),a=s(e.data);a(`.seo-dom`).remove(),n.author=a(`.post-user-comp-info-top-name`).first().text(),n.description=a(`.main-thread`).first().html();let c=e.data.match(/matchId=(\d+)-BATTLE_REPORT/);if(c){e=await i({method:`get`,url:`https://games.mobileapi.hupu.com/1/7.5.36/basketballapi/news/battleReport?relationId=${c[1]}&relationType=BATTLE_REPORT`});let a=e.data.result;n.description=t(o.join(r,`templates/match-de0cf42f.art`),{image:a.img,description:a.beginContent,keyEvent:a.keyEvent,playerImage:a.playerScoreImg})}}catch{}return n}))),{title:`虎扑社区 - ${m(`.bbs-sl-web-intro-detail-title`).text()}`,link:f,item:h,description:m(`.bbs-sl-web-intro-detail-desc-text`).first().text()}}export{c as route};