import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{ViewType as a}from"./types-D9T3SQ-7.js";import o from"node:path";import s from"query-string";function c(e,n,i){let{id:a,source:s,owner:c,file_url:l,tags:u,score:d}=e,f=/^https?:\/\//.test(s),p=f?new URL(s).host:s||`unknown`,m={sample:`sample_url`,orig:`file_url`},h=[`mp4`,`webm`],g=l.slice(l.lastIndexOf(`.`)+1),_=h.includes(g),v=e[m[i]]||l;return _&&(v=l),t(o.join(r,`templates/description-c8a48435.art`),{id:a,source:s,owner:c,tags:u,link:n,isHttp:f,sourceHost:p,contentURL:v,isVideo:_,score:d||0})}function l(){return{apiKey:e.gelbooru.apiKey||``,userId:e.gelbooru.userId||``}}const u={path:`/post/:tags?/:quality?`,categories:[`picture`],view:a.Pictures,example:`/gelbooru/post/1girl rating:general`,parameters:{tags:"要搜索的标签，多个标签用 ` `（空格）隔开",quality:{description:"图片质量，可选值为 `sample`（压缩后的图片，推荐值） 或 `orig`（原图），默认为 `sample`",default:`sample`}},features:{requireConfig:[{name:`GELBOORU_API_KEY`,description:"Gelbooru 偶尔会开启 API 认证，需配合 `GELBOORU_USER_ID`，从 `https://gelbooru.com/index.php?page=account&s=options` 获取",optional:!0},{name:`GELBOORU_USER_ID`,description:"参见 `GELBOORU_API_KEY`",optional:!0}],requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`gelbooru.com/index.php`]}],name:`标签查询`,maintainers:[`magicFeirl`],description:"\n- 默认查询: `/gelbooru/post` 功能等同查询 Gelbooru 网站最新的投稿\n- 单标签查询: `/gelbooru/post/1girl` 查询 `1girl` 的最新投稿\n- 多标签查询: `/gelbooru/post/1girl school_uniform rating:general`\n- 指定为原图: `/gelbooru/post/1girl school_uniform rating:general/orig`\n- 更多例子: 请参考 Gelbooru 官方 wiki https://gelbooru.com/index.php?page=wiki&s=&s=view&id=25921\n\n**可选的 URL 参数**\n- limit 页面返回数据量，默认 40，可选 1 ~ 100\n\ne.g.: `/gelbooru/post?limit=20&`\n",handler:d};async function d(e){let{tags:t=``,quality:r=`sample`}=e.req.param(),a=decodeURIComponent(t).trim(),{limit:o=40}=e.req.query(),{apiKey:u,useId:d}=l(),f=await i({url:`https://gelbooru.com/index.php`,searchParams:s.stringify({page:`dapi`,s:`post`,q:`index`,tags:a,api_key:u,user_id:d,limit:o<=0||o>100?40:o,json:1})}),p=f.data.post;return{title:a?`${a} - gelbooru.com`:`gelbooru.com post list`,link:`https://gelbooru.com/index.php?page=post&s=list&tags=${a}`,icon:`https://gelbooru.com/favicon.png`,logo:`https://gelbooru.com/favicon.png`,description:`Gelbooru post list`,item:p.map(e=>({title:e.id,id:e.id,link:`https://gelbooru.com/index.php?page=post&s=view&id=${e.id}`,author:e.owner,pubDate:n(e.created_at),description:c(e,`https://gelbooru.com/index.php?page=post&s=view&id=${e.id}`,r),upvotes:e.score,updated:n(e.change),media:{content:{url:e.file_url},thumbnail:{url:e.preview_url}},category:e.tags.split(/\s+/g)}))}}export{u as route};