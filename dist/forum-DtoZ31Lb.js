import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{got_default as a}from"./got-BaOFZRd4.js";import o from"node:path";import s from"crypto-js";const c=`https://api.wfdata.club`,l=`https://www.feng.com`,u=e=>{let t=new URL(e).pathname,n=s.enc.Utf8.parse(`url=`+t+`$time=`+Date.now()+`000000`),r=s.enc.Utf8.parse(`2b7e151628aed2a6`),i=s.AES.encrypt(n,r,{iv:r,mode:s.mode.CBC,padding:s.pad.Pkcs7}).toString();return i},d=n=>{let r=`${c}/v1/topic/category`;return t.tryGet(r,async()=>{let e=await a(r,{headers:{Referer:`${l}/forum/${n}`,"X-Request-Id":u(r)}});return e.data},e.cache.routeExpire,!1)},f=async e=>{let t=await d(e);return Object.values(t.data.dataList).find(t=>t.dataList.find(t=>t.topicId===e))},p=(n,r)=>{let i=`${c}/v1/topic/${n}/thread?topicId=${n}&type=${r}&pageCount=50&order=${r===`newest`?`replyTime`:`postTime`}&page=1`;return t.tryGet(i,async()=>{let e=await a(i,{headers:{Referer:`${l}/forum/${n}`,"X-Request-Id":u(i)}});return e.data},e.cache.routeExpire,!1)},m=(e,n)=>{let r=`${c}/v1/thread/${e}`;return t.tryGet(r,async()=>{let e=await a(r,{headers:{Referer:`${l}/forum/${n}`,"X-Request-Id":u(r)}});return e.data})},h={path:`/forum/:id/:type?`,categories:[`bbs`],example:`/feng/forum/1`,parameters:{id:`版块 ID，可在版块 URL 找到`,type:"排序，见下表，默认为 `all`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`feng.com/forum/photo/:id`,`feng.com/forum/:id`],target:`/forum/:id`}],name:`社区`,maintainers:[`TonyRL`],handler:g,description:`| 最新回复 | 最新发布 | 热门 | 精华    |
| -------- | -------- | ---- | ------- |
| newest   | all      | hot  | essence |`};async function g(e){let t=Number(e.req.param(`id`)),{type:a=`all`}=e.req.param(),s=await f(t),c=s.dataList.find(e=>e.topicId===t),u=(await p(t,a)).data.dataList.map(e=>({title:e.title,pubDate:r(e.dateline*1e3),author:e.userBaseInfo.userName,link:`${l}/post/${e.tid}`,tid:e.tid})),d=await Promise.all(u.map(async e=>{let r=await m(e.tid,t);if(r.status.code===0){let t=n(o.join(i,`templates/img-8d8353ed.art`),{images:r.data.thread.fengTalkImage.length?r.data.thread.fengTalkImage:void 0});e.description=r.data.thread.message+t}else e.description=n(o.join(i,`templates/deleted-48cd3c75.art`),{});return delete e.tid,e}));return{title:`${c.topicName} - 社区 - 威锋 - 千万果粉大本营`,description:c.topicDescription,link:`${l}/forum/${t}`,item:d}}export{h as route};