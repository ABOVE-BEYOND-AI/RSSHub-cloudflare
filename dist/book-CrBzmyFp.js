import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import o from"crypto-js";const s=`https://api.creative-comic.tw`,c=`web_desktop`,l=(e,t)=>i(`${s}/book/${e}/info`,{headers:{device:c,uuid:t}}),u=(e,t)=>i(`${s}/book/chapter/${e}`,{headers:{device:c,uuid:t}}),d=(e,t)=>i(`${s}/book/${e}/chapter`,{headers:{device:c,uuid:t}}),f=async(e,t)=>{let{data:n}=await i(`https://storage.googleapis.com/ccc-www/fs/chapter_content/encrypt/${e}/${t}`,{headers:{device:c},responseType:`buffer`});return Buffer.from(n).toString(`base64`)},p=(e,t)=>i(`${s}/book/chapter/image/${e}`,{headers:{device:c,uuid:t}}),m=e=>e(`creative-comic:uuid`,async()=>{let{data:e}=await i(`${s}/guest`,{headers:{device:c}});return e.data}),h=(e,t)=>o.AES.decrypt(e,o.enc.Hex.parse(t.key),{iv:o.enc.Hex.parse(t.iv),mode:o.mode.CBC,padding:o.pad.Pkcs7}).toString(o.enc.Utf8),g=e=>{let t=o.SHA512(e).toString();return{key:t.slice(0,64),iv:t.slice(30,62)}},_=(e,t=`freeforccc2020reading`)=>{let n=g(t),r=h(e,n),i=r.split(`:`);return{key:i[0],iv:i[1]}},v={path:`/book/:id/:coverOnly?/:quality?`,categories:[`anime`],example:`/creative-comic/book/117`,parameters:{id:`漫畫 ID，可在 URL 中找到`,coverOnly:"僅獲取封面，非 `true` 時將獲取**全部**頁面，預設 `true`",quality:"閱讀品質，標準畫質 `1`，高畫質 `2`，預設 `1`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`creative-comic.tw/book/:id/*`],target:`/:id`}],name:`漫畫`,maintainers:[`TonyRL`],handler:y};async function y(i){let{id:o,coverOnly:c=`true`,quality:g=`1`}=i.req.param(),v=await m(e.tryGet),{data:{data:y}}=await l(o,v),{data:{data:b}}=await d(o,v),x=await Promise.all(b.chapters.sort((e,t)=>t.idx-e.idx).slice(0,i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`),10):3).map(async i=>{let o;if(c!==`true`&&c!==`1`){let{data:{data:t}}=await u(i.id,v);(t.chapter.free_day===null||t.chapter.free_day===0)&&(o=await Promise.all(t.chapter.proportion.map(async t=>{let{data:n}=await p(t.id,v);n=n.data.key;let r=_(n),i=await f(t.id,g);return e.tryGet(`${s}/fs/chapter_content/encrypt/${t.id}/${g}`,()=>h(i,r))})))}return{title:i.vol_name,description:t(a.join(r,`templates/chapter-a1c569be.art`),{chapter:i,pages:o,cover:i.image1}),pubDate:n(i.online_at),updated:n(i.updated_at),link:`https://www.creative-comic.tw/reader_comic/${i.id}`,author:y.author.map(e=>e.name).join(`, `),category:y.tags.map(e=>e.name)}}));return{title:`${y.name} | CCC創作集`,description:`${y.brief} ${y.description}`,link:y.share_link,image:y.image1,item:x,language:`zh-hant`}}export{v as route};