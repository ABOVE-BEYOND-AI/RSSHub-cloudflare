import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{ViewType as a}from"./types-D9T3SQ-7.js";import o from"node:path";import{load as s}from"cheerio";function c(e){let t=``;switch(String(e)){case`0`:t=`调高`;break;case`1`:t=`调低`;break;case`2`:t=`首次`;break;case`3`:t=`维持`;break;case`4`:t=`无`;break;default:t=`-`;break}return t}function l(e,t){let n=``;return e!==void 0&&(n=e===``?``:Number(e).toFixed(t)),n}const u={path:`/report/:category`,categories:[`finance`],view:a.Articles,example:`/eastmoney/report/strategyreport`,parameters:{category:{description:`研报类型`,options:[{value:`strategyreport`,label:`策略报告`},{value:`macresearch`,label:`宏观研究`},{value:`brokerreport`,label:`券商晨报`},{value:`industry`,label:`行业研报`},{value:`stock`,label:`个股研报`}]}},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`data.eastmoney.com/report/:category`]}],name:`研究报告`,maintainers:[`syzq`],handler:d,description:`| 策略报告       | 宏观研究    | 券商晨报     | 行业研究 | 个股研报 |
| -------------- | ----------- | ------------ | -------- | -------- |
| strategyreport | macresearch | brokerreport | industry | stock    |`};async function d(a){let u=`https://data.eastmoney.com`,{category:d=`strategyreport`}=a.req.param(),f={brokerreport:`券商晨报`,industry:`行业研报`,macresearch:`宏观研究`,strategyreport:`策略报告`,stock:`个股研报`},p={brokerreport:`zw_brokerreport`,industry:`zw_industry`,macresearch:`zw_macresearch`,strategyreport:`zw_strategy`,stock:`info`},m=await i(`${u}/report/${d}`),h=s(m.data),g=JSON.parse(h(`script`).text().match(/var initdata(.=?)(.*?);/)[2]),_=g.data.map(e=>{let t=d===`stock`?`[${e.stockName}]`:``;return{title:`[${e.orgSName}]${t}${e.title}`,link:`${u}/report/${p[d]}`+(d===`stock`?`/${e.infoCode}.html`:`.jshtml?encodeUrl=${e.encodeUrl}`),pubDate:n(e.publishDate),author:e.researcher,originItem:e}}),v=await Promise.all(_.map(n=>{let a=n.originItem;return delete n.originItem,e.tryGet(n.link,async()=>{try{let{data:e}=await i(n.link),u=s(e);if(d===`stock`){let{title:e,stockName:i,stockCode:s,emRatingName:d,ratingChange:f,orgSName:p,indvInduName:m}=a,h=c(f),g=new Date().getFullYear(),_=g+1,v=u(`.newsContent`).html(),y=u(`#ContentBody .rightlab`).attr(`href`),b=l(a.predictThisYearEps,3),x=l(a.predictThisYearPe,2),S=l(a.predictNextYearEps,3),C=l(a.predictNextYearPe,2);n.enclosure_url=y,n.description=t(o.join(r,`templates/stock_description-13fa7813.art`),{title:e,stockName:i,stockCode:s,emRatingName:d,ratingChangeStr:h,description:v,orgSName:p,predictThisYearEps:b,predictThisYearPe:x,predictNextYearEps:S,predictNextYearPe:C,indvInduName:m,currentYear:g,nextYear:_,enclosureUrl:y})}else n.link=u(`.pdf-link`).attr(`href`),n.description=u(`.ctx-content`).text();return n}catch{return n}})}));return{title:`东方财富网-${f[d]}`,link:u,item:v}}export{u as route};