import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import{load as o}from"cheerio";import s from"query-string";const c={path:`/mmda/tags/:tags?`,categories:[`picture`],example:`/booru/mmda/tags/full_body%20blue_eyes`,parameters:{tags:"标签，多个标签使用 `%20` 连接，如需根据作者查询则在 `user:` 后接上作者名，如：`user:xxxx`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`mmda.booru.org/index.php`]}],name:`MMDArchive 标签查询`,maintainers:[`N78Wy`],handler:l,description:"For example:\n\n  -   默认查询 (什么 tag 都不加)：`/booru/mmda/tags`\n  -   默认查询单个 tag：`/booru/mmda/tags/full_body`\n  -   默认查询多个 tag：`/booru/mmda/tags/full_body%20blue_eyes`\n  -   默认查询根据作者查询：`/booru/mmda/tags/user:xxxx`"};async function l(c){let l=`https://mmda.booru.org`,u=c.req.param(`tags`),d=s.stringify({tags:u,page:`post`,s:`list`},{skipNull:!0}),{data:f}=await i(`${l}/index.php`,{searchParams:d}),p=o(f),m=p(`#post-list > div.content > div > div:nth-child(3) span`).toArray().map(e=>{e=p(e);let n=e.find(`a`).first(),i=e.find(`script[type="text/javascript"]`).first().text(),o=i.match(/user':'(.*?)'/)?.[1]??``,s=n.find(`img`).first().attr(`title`)??``,c=n.find(`img`).first().attr(`src`)??``;return{title:s,link:`${l}/${n.attr(`href`)}`,image:c,author:o,description:t(a.join(r,`templates/description-0e2d1b3e.art`),{title:s,image:c,by:o})}}),h=await Promise.all(m.map(s=>e.tryGet(s.link,async()=>{let{data:e}=await i(s.link),c=o(e),l=c(`#tag_list > ul`);l.find(`li, br, strong`).remove();let u=l.text(),d=/(?<key>[^\s:]+)\s*:\s*(?<value>.+)/gm,f={};for(let e of u.matchAll(d)){let{key:t,value:n}=e.groups??{};f[t.trim().toLocaleLowerCase()]=n.trim()}let p=c(`#image`).attr(`src`);return f.posted&&(s.pubDate=n(f.posted)),s.description=t(a.join(r,`templates/description-0e2d1b3e.art`),{title:s.title,image:p??s.image,posted:s.pubDate??``,by:f.by,source:f.source,rating:f.rating,score:f.score}),s})));return{title:u,link:`${l}/index.php?${d}`,item:h}}export{c as route};