import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{invalid_parameter_default as a}from"./invalid-parameter-CfUmvEUg.js";import o from"node:path";import{load as s}from"cheerio";const c={1:`同人誌 漢化`,2:`同人誌 CG畫集`,3:`同人誌 Cosplay`,5:`同人誌`,6:`單行本`,7:`雜誌&短篇`,9:`單行本 漢化`,10:`雜誌&短篇 漢化`,12:`同人誌 日語`,13:`單行本 日語`,14:`雜誌&短篇 日語`,16:`同人誌 English`,17:`單行本 English`,18:`雜誌&短篇 English`,19:`韓漫`,20:`韓漫 漢化`,21:`韓漫 生肉`,22:`同人誌 3D漫畫`},l=`https://www.wnacg.com`;async function u(u){let{cid:d,tag:f}=u.req.param();if(d&&!Object.keys(c).includes(d))throw new a(`此分类不存在`);let p=`${l}/albums${d?`-index-cate-${d}`:``}${f?`-index-tag-${f}`:``}.html`,{data:m}=await i(p),h=s(m),g=h(`.gallary_item`).toArray().map(e=>{e=h(e);let t=e.find(`a`).attr(`href`),r=t.match(/^\/photos-index-aid-(\d+)\.html$/)[1];return{title:e.find(`a`).attr(`title`),link:`${l}${t}`,pubDate:n(e.find(`.info_col`).text().replace(/\d+張照片，\n創建於/,``),`YYYY-MM-DD`),aid:r}}),_=await Promise.all(g.map(n=>e.tryGet(n.link,async()=>{let{data:e}=await i(n.link,{headers:{referer:encodeURI(p)}}),a=s(e),c=a(`.uwuinfo p`).first().text(),u=a(`.tagshow`).toArray().map(e=>a(e).text());a(`.addtags`).remove();let d=a(`.uwconn`).html(),{data:f}=await i(`${l}/photos-gallery-aid-${n.aid}.html`,{headers:{referer:`${l}/photos-slide-aid-${n.aid}.html`}});a=s(f);let m=a(`script`).text().match(/var imglist = (\[.*]);"\);/)[1],h=JSON.parse(m.replaceAll(`url:`,`"url":`).replaceAll(`caption:`,`"caption":`).replaceAll(`fast_img_host+\\`,``).replaceAll(`\\`,``));return n.author=c,n.category=u,n.description=t(o.join(r,`templates/manga-9c92a0ba.art`),{description:d,imgList:h}),n})));return{title:h(`head title`).text(),link:p,item:_}}export{u as handler};