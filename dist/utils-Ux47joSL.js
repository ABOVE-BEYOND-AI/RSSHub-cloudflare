import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";const o=[`misskey.io`,`madost.one`,`mk.nixnet.social`],s=(e,i,s=!1)=>e.map(e=>{let c=e.renote&&Object.keys(e.renote).length>0,l=e.reply&&Object.keys(e.reply).length>0,u=c?e.renote:e,d=u.user.host??i,f=s?String(u.user.name):`${u.user.name} (${u.user.username}@${d})`,p=t(a.join(r,`templates/note-b4364264.art`),{text:u.text,files:u.files,reply:e.reply,site:i}),m=``;if(l&&e.reply){let t=e.reply.user.host??i,n=s?e.reply.user.name:`${e.reply.user.name} (${e.reply.user.username}@${t})`;m=`Reply to ${n}: "${u.text??``}"`}else m=c?`Renote: ${f}: "${u.text??``}"`:`${f}: "${u.text??``}"`;let h=u.id;if(c){let t=e.user.host??i,n=u.user.host??i;(t!==n||!o.includes(n))&&(h=e.id)}let g=`https://${d}/notes/${h}`,_=n(u.createdAt);return{title:m,description:p,pubDate:_,link:g,author:f}});async function c(t,n,{withRenotes:r=!1,mediaOnly:a=!1}){let o=`https://${n}/api/users/search-by-username-and-host`,s=`misskey_username/${n}/${t}`,c=await e.tryGet(s,async()=>{let e=await i({method:`post`,url:o,json:{username:t,host:n,detail:!0,limit:1}}),r=e.data.find(e=>e.username===t);if(!r)throw Error(`username ${t} not found`);return r}),l=c.id,u=c.avatarUrl,d=`https://${n}/api/users/notes`,f=await i({method:`post`,url:d,json:{userId:l,withChannelNotes:!0,withRenotes:r,withReplies:!a,withFiles:a,limit:10,offset:0}}),p=f.data;return{site:n,accountId:l,accountData:p,avatarUrl:u}}var l={parseNotes:s,getUserTimelineByUsername:c,allowSiteList:o};export{l as utils_default};