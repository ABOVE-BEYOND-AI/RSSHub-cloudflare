import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{baseUrl as a,fetchUserDate as o}from"./utils-D7XwgEJg.js";import s from"node:path";import c from"dayjs";const l={path:`/posts/:author`,categories:[`new-media`],example:`/zhiy/posts/long`,parameters:{author:`作者 ID，可在URL中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`zhiy.cc/:author`]}],name:`笔记`,maintainers:[`TonyRL`],handler:u};async function u(l){t.defaults.imports={dayjs:c,...t.defaults.imports};let u=l.req.param(`author`),d=await o(u),{author_id:f,author_name:p,author_signature:m,author_avatar_url:h}=d,{data:{result:g}}=await i(`${a}/api/app/share/garden/users/${f}/posts`,{searchParams:{page:1,limit:l.req.query(`limit`)?Number.parseInt(l.req.query(`limit`)):100}}),_=g.map(e=>({title:e.title,pubDate:n(e.create_time,`X`),link:`${a}/b${e.share_md5}`,guid:`${a}/b${e.share_md5}:${e.link_amount}:${e.note_amount}`,postId:e.id,shareMD5:e.share_md5})),v=await Promise.all(_.map(n=>e.tryGet(n.link,async()=>{let{data:e}=await i(`${a}/api/app/share/posts/${n.shareMD5}`),{data:{result:o}}=await i(`${a}/api/app/share/posts/${n.postId}/notes`,{searchParams:{page:1,limit:100}});return n.description=t(s.join(r,`templates/post-2ebad52a.art`),{postMeta:e,postDate:c(e.create_time,`X`).format(`YYYY-MM-DD HH:mm:ss`),posts:o}),n})));return{title:p,link:`${a}/${u}`,description:m,image:h,item:v}}export{l as route};