import"./config-HRWLmo66.js";import{logger_default as e}from"./logger-DHpG8Bim.js";import"./proxy-BQXcrhTu.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{got_default as a}from"./got-BaOFZRd4.js";import{puppeteer_default as o}from"./puppeteer-BAoY_Fpy.js";import{setCookies as s}from"./puppeteer-utils-DuxVCYwW.js";import c from"node:path";import{load as l}from"cheerio";import{CookieJar as u}from"tough-cookie";const d={path:`/:topicPath{.+}?`,radar:[{source:[`pnas.org/*topicPath`],target:`/:topicPath`}],name:`Unknown`,maintainers:[],handler:f,url:`pnas.org/*topicPath`};async function f(d){let f=`https://www.pnas.org`,p=d.req.param(`topicPath`),m=`${f}/${p??`latest`}`,h=await t.get(`pnas:cookieJar`),g=!h;h=g?new u:u.fromJSON(h);let{data:_}=await a(m,{cookieJar:h});g&&await t.set(`pnas:cookieJar`,h.toJSON());let v=l(_),y=v(`.card--row-reversed .card-content`).toArray().map(e=>{e=v(e);let t=e.find(`.article-title a`);return{title:t.text(),link:new URL(t.attr(`href`),f).href,pubDate:r(e.find(`.card__meta__date`).text())}}),b=await o(),x=await Promise.all(y.map(r=>t.tryGet(r.link,async()=>{let t=await b.newPage();await s(t,await h.getCookieString(r.link),`.pnas.org`),await t.setRequestInterception(!0),t.on(`request`,e=>{e.resourceType()===`document`?e.continue():e.abort()}),e.http(`Requesting ${r.link}`),await t.goto(r.link,{waitUntil:`domcontentloaded`,referer:m}),await t.waitForSelector(`.core-container`);let a=await t.evaluate(()=>document.documentElement.innerHTML);await t.close();let o=l(a),u=JSON.parse(o(`script`).text().match(/PNASdataLayer =(.*?);/)[1]);o(`.signup-alert-ad, .citations-truncation button`).remove();let{keywords:d,topic:f}=u.page.attributes;return r.category=[...d,f],r.author=u.page.pageInfo.author,r.doi=u.page.pageInfo.DOI,r.description=n(c.join(i,`templates/article-8214e5db.art`),{access:u.user.access===`yes`,abstracts:o(`#abstracts .core-container`).html(),articleBody:o(`[property=articleBody]`).html(),dataAvailability:o(`#data-availability`).html(),acknowledgments:o(`#acknowledgments`).html(),supplementaryMaterials:o(`#supplementary-materials`).html(),bibliography:o(`#bibliography`).html()}),r})));return await b.close(),{title:`${v(`.banner-widget__content h1`).text()} - PNAS`,description:v(`.banner-widget__content p`).text(),image:`https://www.pnas.org/favicon.ico`,language:`en-US`,link:m,item:x}}export{d as route};