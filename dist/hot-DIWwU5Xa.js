import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{ViewType as a}from"./types-D9T3SQ-7.js";import o from"node:path";import{load as s}from"cheerio";let c=`false`,l=`false`;const u={path:`/search/hot/:fulltext?`,categories:[`social-media`],view:a.SocialMedia,example:`/weibo/search/hot`,parameters:{fulltext:{description:"\n-   使用`/weibo/search/hot`可以获取热搜条目列表；\n-   使用`/weibo/search/hot/fulltext`可以进一步获取热搜条目下的摘要信息（不含图片视频）；\n-   使用`/weibo/search/hot/fulltext?pic=true`可以获取图片缩略（但需要配合额外的手段，例如浏览器上的 Header Editor 等来修改 referer 参数为`https://weibo.com`，以规避微博的外链限制，否则图片无法显示。）\n-   使用`/weibo/search/hot/fulltext?pic=true&fullpic=true`可以获取 Original 图片（但需要配合额外的手段，例如浏览器上的 Header Editor 等来修改 referer 参数为`https://weibo.com`，以规避微博的外链限制，否则图片无法显示。）"}},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`s.weibo.com/top/summary`]}],name:`热搜榜`,maintainers:[`xyqfer`,`shinemoon`],handler:d,url:`s.weibo.com/top/summary`};async function d(e){c=e.req.query(`pic`)??`false`,l=e.req.query(`fullpic`)??`false`;let{data:{data:n}}=await i({method:`get`,url:`https://m.weibo.cn/api/container/getIndex?containerid=106003type%3D25%26t%3D3%26disable_hot%3D1%26filter_type%3Drealtimehot&title=%E5%BE%AE%E5%8D%9A%E7%83%AD%E6%90%9C&extparam=filter_type%3Drealtimehot%26mi_cid%3D100103%26pos%3D0_0%26c_type%3D30%26display_time%3D1540538388&luicode=10000011&lfid=231583`,headers:{Referer:`https://s.weibo.com/top/summary?cate=realtimehot`,"MWeibo-Pwa":1,"X-Requested-With":`XMLHttpRequest`,"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`}}),r=null;if(e.req.param(`fulltext`)===`fulltext`){let e=n.cards[0].card_group,i=e.map(e=>{let t=e.desc,n=`https://m.weibo.cn/search?containerid=100103type%3D1%26q%3D${encodeURIComponent(e.desc)}`,r=`https://m.weibo.cn/api/container/getIndex?containerid=100103type%3D1%26q%3D${encodeURIComponent(e.desc)}`;return{title:t,link:n,plink:r}});r=await Promise.all(i.map(e=>t.tryGet(e.plink,async()=>{let t=await f(e.plink);return e.description=t.content,e})))}else r=n.cards[0].card_group.map(e=>{let t=e.desc,n=`https://m.weibo.cn/search?containerid=100103type%3D1%26q%3D${encodeURIComponent(e.desc)}`,r=e.desc;return{title:t,description:r,link:n}});return{title:`微博热搜榜`,link:`https://s.weibo.com/top/summary?cate=realtimehot`,description:`实时热点，每分钟更新一次`,item:r}}async function f(t){let n=e.weibo.cookies??``,r=await i(t,{headers:{Cookie:n}}),a=``;try{let e=r.data,t=e.data.cards;a=p(t)}catch{}let o=a;return{content:o}}function p(e){let t=s(`<div id="wbcontent"></div>`),i=t(`#wbcontent`);for(let t of e){if(t.card_type===9){let e=t.mblog.thumbnail_pic??``,a=e.lastIndexOf(`/`),u=e.slice(0,a+1),d=s(t.mblog.text);c===`true`?d(`img`).attr(`width`,`1em`).attr(`height`,`1em`):d(`img`).remove();let f=n(o.join(r,`templates/digest-69514cd7.art`),{author:{link:t.mblog.user.profile_url,name:t.mblog.user.screen_name},msg:d.html(),link:t.scheme,postinfo:t.mblog.created_at,picnum:c===`true`?t.mblog.pic_num:0,pics:c===`true`&&t.mblog.pic_num>0?t.mblog.pics.map(e=>{let t=e.pid;return l===`false`?{url:u+t+`.jpg`,rurl:e.url}:{url:e.url,rurl:e.url}}):[]});i.append(f)}t.card_type===11&&i.append(p(t.card_group))}return i.html()}export{u as route};