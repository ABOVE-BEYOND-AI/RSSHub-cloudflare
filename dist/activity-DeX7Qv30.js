import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as e}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as t}from"./esm-shims-BDPl6Msv.js";import{got_default as n}from"./got-BaOFZRd4.js";import r from"node:path";import{load as i}from"cheerio";const a={path:`/activity/:city/:category/:subcategory/:keyword?`,categories:[`shopping`],example:`/damai/activity/上海/音乐会/全部/柴可夫斯基`,parameters:{city:"城市，如果不需要限制，请填入`全部`",category:"分类，如果不需要限制，请填入`全部`",subcategory:"子分类，如果不需要限制，请填入`全部`",keyword:`搜索关键字，置空为不限制`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`票务更新`,maintainers:[`hoilc`,`Konano`],handler:o,description:`城市、分类名、子分类名，请参见[大麦网搜索页面](https://search.damai.cn/search.htm)`};async function o(a){let o=a.req.param(`city`)===`全部`?``:a.req.param(`city`),s=a.req.param(`category`)===`全部`?``:a.req.param(`category`),c=a.req.param(`subcategory`)===`全部`?``:a.req.param(`subcategory`),l=a.req.param(`keyword`)??``,u=await n(`https://search.damai.cn/searchajax.html`,{searchParams:{keyword:l,cty:o,ctl:s,sctl:c,tsg:0,st:``,et:``,order:3,pageSize:30,currPage:1,tn:``}}),d=u.data,f=d.pageData.resultData||[];return{title:`大麦网票务 - ${o||`全国`} - ${s||`全部分类`}${c?` - `+c:``}${l?` - `+l:``}`,link:`https://search.damai.cn/search.htm`,allowEmpty:!0,item:f.map(n=>({title:n.nameNoHtml,author:n.actors?i(n.actors,null,!1).text():`大麦网`,description:e(r.join(t,`templates/activity-eedb4947.art`),{item:n}),link:`https://detail.damai.cn/item.htm?id=${n.projectid}`}))}}export{a as route};