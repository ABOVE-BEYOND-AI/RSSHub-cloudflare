import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import{invalid_parameter_default as o}from"./invalid-parameter-CfUmvEUg.js";import{isValidHost as s}from"./valid-host-JqD2S4D4.js";import c from"node:path";import{load as l}from"cheerio";const u={path:`/:id?/:category{.+}?`,name:`Unknown`,maintainers:[],handler:d};async function d(u){let{id:d=`news`,category:f=`china`}=u.req.param();if(!s(d))throw new o(`Invalid id`);let p=u.req.query(`limit`)?Number.parseInt(u.req.query(`limit`),10):30,m=`http://${d}.m4.cn`,h=new URL(f?`/${f.replace(/\/$/,``)}/`:`/`,m).href,{data:g}=await i(h),_=l(g),v=_(`div.articleitem0 div.aheader0`).slice(0,p).toArray().map(e=>{e=_(e);let i=e.find(`a`).first();return{title:i.text(),link:i.prop(`href`),description:t(c.join(r,`templates/description-881baa33.art`),{images:[{src:e.parent().find(`div.aimg0 a img`).prop(`src`),alt:i.text()}]}),category:e.find(`a.aclass`).toArray().map(e=>_(e).text().replaceAll(`[]`,``).trim()),pubDate:a(n(e.find(`span.atime`).text()),8)}});v=await Promise.all(v.map(o=>e.tryGet(o.link,async()=>{let{data:e}=await i(o.link),s=l(e);return o.title=s(`h1`).first().text(),o.description=t(c.join(r,`templates/description-881baa33.art`),{intro:s(`div.aintro1, p.cont-summary`).text(),description:s(`div.content0, div.cont-detail`).html()}),o.category=s(`span.dd0 a, a[rel="category"]`).toArray().map(e=>s(e).text()).slice(1),o.pubDate=a(n(s(`span.atime1, span.post-time`).text()),8),o})));let y=_(`a.logo0_b img`).prop(`src`);return{item:v,title:_(`title`).text(),link:h,description:_(`meta[name="description"]`).prop(`content`),language:`zh`,image:y,subtitle:_(`meta[name="keywords"]`).prop(`content`),author:_(`meta[name="author"]`).prop(`content`),allowEmpty:!0}}export{u as route};