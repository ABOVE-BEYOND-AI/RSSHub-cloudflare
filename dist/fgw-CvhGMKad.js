import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import o from"node:path";import{load as s}from"cheerio";const c=async c=>{let{category:l=`fgw_zxxxgk`}=c.req.param(),u=c.req.query(`limit`)?Number.parseInt(c.req.query(`limit`),10):20,d=`https://fgw.sh.gov.cn`,f=new URL(`${l}/index.html`,d).href,{data:p}=await i(f),m=s(p),h=m(`html`).prop(`lang`),g=m(`ul.nowrapli li`).slice(0,u).toArray().map(e=>(e=m(e),{title:e.find(`a`).prop(`title`),pubDate:n(e.find(`span.time`).text()),link:new URL(e.find(`a`).prop(`href`),d).href,language:h}));g=await Promise.all(g.map(c=>e.tryGet(c.link,async()=>{if(!c.link.endsWith(`.html`))return c.enclosure_url=c.link,c.enclosure_type=c.link?`application/${c.link.split(/\./).pop()}`:void 0,c.enclosure_title=c.title,c;let{data:e}=await i(c.link),l=s(e),u=l(`meta[name="ArticleTitle"]`).prop(`content`),f=l(`div.pdf-content img`).first().prop(`src`),p=t(o.join(r,`templates/description-16be3a2a.art`),{images:f?[{src:f,alt:u}]:void 0,description:l(`div#ivs_content`).html()});c.title=u,c.description=p,c.pubDate=a(n(l(`meta[name="PubDate"]`).prop(`content`)),8),c.category=[...new Set([l(`meta[name="ColumnName"]`).prop(`content`),l(`meta[name="ColumnKeywords"]`).prop(`content`)])].filter(Boolean),c.author=l(`meta[name="ContentSource"]`).prop(`content`),c.content={html:p,text:l(`div#ivs_content`).text()},c.image=f,c.banner=f,c.language=h;let m=l(`div.pdf-content a, div.xgfj a`).first().prop(`href`);return c.enclosure_url=m?new URL(m,d).href:void 0,c.enclosure_type=m?`application/${m.split(/\./).pop()}`:void 0,c.enclosure_title=u,c})));let _=m(`meta[name="SiteName"]`).prop(`content`),v=m(`span.logo-icon img`).prop(`src`);return{title:`${_} - ${m(`meta[name="ColumnName"]`).prop(`content`)}`,description:m(`meta[name="ColumnDescription"]`).prop(`content`),link:f,item:g,allowEmpty:!0,image:v,author:_,language:h}},l={path:[`/sh/fgw/:category{.+}?`,`/shanghai/fgw/:category{.+}?`],name:`上海市发展和改革委员会`,url:`fgw.sh.gov.cn`,maintainers:[`nczitzk`],handler:c,example:`/gov/sh/fgw/fgw_zxxxgk`,parameters:{category:"分类，默认为 `fgw_zxxxgk`，即最新信息公开，可在对应分类页 URL 中找到"},description:"::: tip\n  若订阅 [最新信息公开](https://fgw.sh.gov.cn/fgw_zxxxgk/index.html)，网址为 `https://fgw.sh.gov.cn/fgw_zxxxgk/index.html`。截取 `https://fgw.sh.gov.cn/` 到末尾 `/index.html` 的部分 `fgw_zxxxgk` 作为参数填入，此时路由为 [`/gov/sh/fgw/fgw_zxxxgk`](https://rsshub.app/gov/sh/fgw/fgw_zxxxgk)。\n:::\n\n| 最新信息公开 | 要闻动态   |\n| ------------ | ---------- |\n| fgw_zxxxgk   | fgw_fzggdt |\n  ",categories:[`government`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`fgw.sh.gov.cn/:category`],target:e=>{let t=e.category.replace(/\/index\.html/,``);return`/gov/sh/fgw${t?`/${t}`:``}`}},{title:`最新信息公开`,source:[`fgw.sh.gov.cn/fgw_zxxxgk/index.html`],target:`/sh/fgw/fgw_zxxxgk`},{title:`要闻动态`,source:[`fgw.sh.gov.cn/fgw_fzggdt/index.html`],target:`/sh/fgw/fgw_fzggdt`}]};export{c as handler,l as route};