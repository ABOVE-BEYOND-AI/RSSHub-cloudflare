import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as e}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as t}from"./esm-shims-BDPl6Msv.js";import{got_default as n}from"./got-BaOFZRd4.js";import{fallback as r,queryToInteger as i}from"./readable-social-Dobs5p4y.js";import a from"node:path";const o={path:`/recommended/:type?/:routeParams?`,categories:[`social-media`],example:`/douban/recommended/tv`,parameters:{type:`片单类型剧集/电影，tv或movie，默认为tv`,routeParams:`额外参数；请参阅以下说明和表格`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`豆瓣每月推荐片单`,maintainers:[`honue`],handler:s,description:`| 额外参数 | 含义                   | 接受的值 | 默认值 |
| -------- | ---------------------- | -------- | ------ |
| playable | 仅看有可播放片源的影片 | 0/1      | 0      |
| score    | 筛选评分               | 0-10     | 0      |

  用例：\`/douban/recommended/tv/playable=0&score=8\`

::: tip
  整合了 /douban/list/ 路由，省去每月手动更新 id 参数，因为当月推荐剧集片单中，会有还未播出 / 开评分剧集、海外平台播出剧集，请自行考虑是否使用额外参数。
:::`};async function s(o){let s=o.req.param(`type`)||`tv`,c=`https://frodo.douban.com/api/v2/skynet/new_playlists?apikey=0ac44ae016490db2204ce0a042db2916&subject_type=${s}`,l=await n({method:`get`,url:c,headers:{"User-Agent":`MicroMessenger/`,Referer:`https://servicewechat.com/wx2f9b06c1de1ccfca/91/page-frame.html`}}),u=new Date,d=u.getFullYear(),f=u.getMonth()+1,p=f<10?`0`+f:f.toString(),m=l.data.data[0].items,h=m.find(e=>e.title.startsWith(`${d}年${p}月`)).id,g=Object.fromEntries(new URLSearchParams(o.req.param(`routeParams`))),_=r(void 0,i(g.playable),0),v=r(void 0,i(g.score),0);c=`https://m.douban.com/rexxar/api/v2/subject_collection/${h}/items?playable=${_}`,l=await n({method:`get`,url:c,headers:{Referer:`https://m.douban.com/subject_collection/${h}`}});let y=l.data.subject_collection.description;return m=l.data.subject_collection_items.filter(e=>{let t=e.rating?e.rating.value:0;return t>=v}).map(n=>{let r=n.title,i=n.url,o=e(a.join(t,`templates/list_description-833a570f.art`),{ranking_value:n.ranking_value,title:r,original_title:n.original_title,rate:n.rating?n.rating.value:null,card_subtitle:n.card_subtitle,description:n.cards?n.cards[0].content:n.abstract,cover:n.cover_url||n.cover?.url});return{title:r,link:i,description:o}}),{title:`豆瓣 - ${l.data.subject_collection.name}`,link:`https://m.douban.com/subject_collection/${h}`,item:m,description:y}}export{o as route};