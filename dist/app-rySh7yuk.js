import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import{load as o}from"cheerio";const s=`https://app.theinitium.com/`,c={path:`/app/:category?`,categories:[`new-media`],example:`/theinitium/app`,parameters:{category:`Category, see below, latest_sc by default`},features:{requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`App`,maintainers:[`quiniapiezoelectricity`],radar:[{source:[`app.theinitium.com/t/latest/:category`],target:`/app/:category`}],handler:p,description:`抓取[The Initium App](https://app.theinitium.com/)的文章列表

::: warning
此路由暂不支持登陆认证
:::

Category 栏目：

| ----- | 简体中文     | 繁體中文      |
| ----- | ----------------- | ---------------- |
| 最新   | latest_sc | latest_tc |
| 日报   | daily_brief_sc | daily_brief_tc |
| 速递   | whats_new_sc | whats_new_tc |
| 专题   | report_sc | report_tc |
| 评论   | opinion_sc | opinion_tc |
| 国际   | international_sc | international_tc |
| 大陆   | mainland_sc | mainland_tc |
| 香港   | hongkong_sc | hongkong_tc |
| 台湾   | taiwan_sc | taiwan_tc |
| 播客   | article_audio_sc | article_audio_tc |`},l=(e,t,n,r)=>{let i=e(t);if(r)try{let e=i.attr(n);e&&i.attr(n,new URL(e,r).href)}catch{}};async function u(e){return await i({method:`get`,url:e,headers:{"User-Agent":`PugpigBolt v4.1.8 (iPhone, iOS 18.2.1) on phone (model iPhone15,2)`}})}async function d(e){let t=await u(e.href),i=o(t.data);i(`a, area`).each((e,t)=>{l(i,t,`href`,s)}),i(`img, video, audio, source, iframe, embed, track`).each((e,t)=>{l(i,t,`src`,s),i(t).removeAttr(`srcset`)}),i(`video[poster]`).each((e,t)=>{l(i,t,`poster`,s)});let c=i(`.pp-article__body`);return c.find(`.block-related-articles`).remove(),c.find(`.copyright`).wrapInner(`<small></small>`).wrapInner(`<figure></figure>`),c.find(`figure.wp-block-pullquote`).children().unwrap(),c.find(`div.block-explanation-note`).wrapInner(`<blockquote></blockquote>`),c.find(`div.wp-block-tcc-author-note`).wrapInner(`<em></em>`).after(`<hr>`),c.find(`p.has-small-font-size`).wrapInner(`<small></small>`),n(a.join(r,`templates/description-4a91cdc4.art`),{standfirst:i(`.pp-header-group__standfirst`).html(),coverImage:i(`.pp-media__image`).attr(`src`),coverCaption:i(`.pp-media__caption`).html(),article:c.html()})}async function f(e){let t=await i(e.href),s=o(t.data),c=s(`.entry-content`);return c.find(`.block-related-articles`).remove(),c.find(`.cta-subscription`).remove(),c.find(`.entry-copyright`).wrapInner(`<small></small>`).wrapInner(`<figure></figure>`),c.find(`figure.wp-block-pullquote`).children().unwrap(),c.find(`div.block-explanation-note`).wrapInner(`<blockquote></blockquote>`),c.find(`div.wp-block-tcc-author-note`).wrapInner(`<em></em>`).after(`<hr>`),c.find(`p.has-small-font-size`).wrapInner(`<small></small>`),n(a.join(r,`templates/description-4a91cdc4.art`),{standfirst:s(`span.caption1`).html(),coverImage:s(`.wp-post-image`).attr(`src`),coverCaption:s(`.image-caption`).html(),article:c.html()})}async function p(n){let r=n.req.param(`category`)??`latest_sc`,i=await t.tryGet(new URL(`timelines.json`,s).href,async()=>await u(new URL(`timelines.json`,s).href),e.cache.routeExpire,!1),a=i.data.timelines.find(e=>e.id===r),o=await u(new URL(a.feed,s).href),c=o.data.stories.filter(e=>e.type===`article`),l=await Promise.all(c.map(e=>t.tryGet(e.shareurl,async()=>{let t=new URL(e.shareurl);switch(e.link=t.href,e.description=e.summary,e.pubDate=e.published,e.category=[],e.section&&(e.category=[...e.category,e.section]),e.taxonomy&&(e.taxonomy.collection_tag&&(e.category=[...e.category,...e.taxonomy.collection_tag]),e.taxonomy.sections&&(e.category=[...e.category,...e.taxonomy.sections])),e.category=[...new Set(e.category)],t.hostname){case`app.theinitium.com`:e.description=await d(t);break;case`theinitium.com`:e.description=await f(t);break;default:break}return e}))),p=`zh-hans`,m=`端传媒`;return a.timeline_sets[0]===`chinese-traditional`&&(p=`zh-hant`,m=`端傳媒`),{title:`${m} - ${a.title}`,link:`https://app.theinitium.com/t/latest/${r}/`,language:p,item:l}}export{c as route};