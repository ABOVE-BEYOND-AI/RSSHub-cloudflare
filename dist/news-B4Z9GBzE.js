import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{timezone as a}from"./timezone-BrxBCotj.js";import{ViewType as o}from"./types-D9T3SQ-7.js";import{invalid_parameter_default as s}from"./invalid-parameter-CfUmvEUg.js";import c from"node:path";import{load as l}from"cheerio";const u={newslist:`newsList`,r18list:`newsPornList`},d=async o=>{let{type:d=`newslist`,category:f=`all`}=o.req.param();if(!u.hasOwnProperty(d))throw new s(`Invalid type: ${d}`);let p=Number.parseInt(o.req.query(`limit`)??`30`,10),m=`https://news.gamebase.com.tw`,h=new URL(`news${f===`all`?``:`/newslist?type=${f}`}`,m).href,g=new URL(`api/news/getNewsList`,`https://api.gamebase.com.tw`).href,_=await r(g,{method:`post`,body:{GB_type:u[d],category:f,page:1}}),v=await r(h),y=l(v),b=y(`html`).attr(`lang`)??`zh-TW`,x=await Promise.all(_.return_msg?.list?.slice(0,p).map(o=>e.tryGet(`gamebase-news-${o.news_no}`,async()=>{let e=o.news_title,s=o.post_time,l=o.news_no?`news/detail/${o.news_no}`:void 0,u=[o.system],d=o.nickname,f=`gamebase-news-${o.news_no}`,p=o.news_img,h=o.updated??s,g=o.news_meta?.meta_des;if(!g){let e=await r(o.link);g=(e.match(/(\\u003C.*?)","/)?.[1]??``).replaceAll(String.raw`\"`,`"`).replaceAll(/\\u([\da-f]{4})/gi,(e,t)=>String.fromCodePoint(Number.parseInt(t,16)))}let _=t(c.join(i,`templates/description-881baa33.art`),{images:p&&!g?[{src:p,alt:e}]:void 0,intro:o.news_short_desc,description:g}),v={title:e,description:_,pubDate:s?a(n(s),8):void 0,link:l?new URL(l,m).href:void 0,category:u,author:d,guid:f,id:f,content:{html:_,text:_},image:p,banner:p,updated:h?a(n(h),8):void 0,language:b};return v}))??[]);return{title:y(`title`).text(),description:y(`meta[property="og:description"]`).attr(`content`),link:h,item:x,allowEmpty:!0,image:y(`meta[property="og:image"]`).attr(`content`),author:y(`meta[property="og:title"]`).attr(`content`)?.split(/\|/).pop()?.trim(),language:b,id:y(`meta[property="og:url"]`).attr(`content`)}},f={path:`/news/:type?/:category?`,name:`新聞`,url:`news.gamebase.com.tw`,maintainers:[`nczitzk`],handler:d,example:`/gamebase/news`,parameters:{type:`類型，見下表，預設為 newslist`,category:"分類，預設為 `all`，即全部，可在對應分類頁 URL 中找到"},description:":::tip\n若訂閱 [手機遊戲新聞](https://news.gamebase.com.tw/news/newslist?type=mobile)，網址為 `https://news.gamebase.com.tw/news/newslist?type=mobile`，請截取 `https://news.gamebase.com.tw/news/` 到末尾的部分 `newslist` 作為 `type` 參數填入，`mobile` 作為 `category` 參數填入，此時目標路由為 [`/gamebase/news/newslist/mobile`](https://rsshub.app/gamebase/news/newslist/mobile)。\n:::\n\n| newslist | r18list |\n| -------- | ------- |\n",categories:[`game`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`news.gamebase.com.tw/news`,`news.gamebase.com.tw/news/:type`],target:(e,t)=>{let n=e.type,r=new URL(t),i=r.searchParams.get(`type`)??void 0;return`/gamebase/news${n?`/${n}${i?`/${i}`:``}`:``}`}}],view:o.Articles,zh:{path:`/news/:type?/:category?`,name:`新闻`,url:`news.gamebase.com.tw`,maintainers:[`nczitzk`],handler:d,example:`/gamebase/news`,parameters:{type:`类型，见下表，默认为 newslist`,category:"分类，默认为 `all`，即全部，可在对应分类页 URL 中找到"},description:":::tip\n若订阅 [手机游戏新闻](https://news.gamebase.com.tw/news/newslist?type=mobile)，网址为 `https://news.gamebase.com.tw/news/newslist?type=mobile`，请截取 `https://news.gamebase.com.tw/news/` 到末尾的部分 `newslist` 作为 `type` 参数填入，`mobile` 作为 `category` 参数填入，此时目标路由为 [`/gamebase/news/newslist/mobile`](https://rsshub.app/gamebase/news/newslist/mobile)。\n:::\n\n| newslist | r18list |\n| -------- | ------- |\n"}};export{d as handler,f as route};