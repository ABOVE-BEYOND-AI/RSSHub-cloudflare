import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import{timezone as i}from"./timezone-BrxBCotj.js";import a from"node:path";import{load as o}from"cheerio";const s=(e,t,n)=>r(`https://feed.mix.sina.com.cn/api/roll/get`,{headers:{referer:`https://news.sina.com.cn/`},searchParams:{pageid:e,lid:t,k:``,num:n,page:1,r:Math.random(),_:Date.now()}}),c=e=>e.map(e=>({title:e.title,description:e.intro,link:e.url.replace(`http://`,`https://`),author:e.media_name,pubDate:t(e.intime,`X`),updated:t(e.mtime,`X`)})),l=(s,c)=>c(s.link,async()=>{let c=await r(s.link),l=o(c.data);l(`#left_hzh_ad, .appendQr_wrap, .app-kaihu-qr, .tech-quotation`).remove();let u=l(`meta[property="article:published_time"]`),d=l(`#pub_date, .date`),f=d.length?i(t(d.text(),[`YYYY年MM月DD日 HH:mm`,`YYYY年MM月DD日HH:mm`]),8):null,p=u.length?t(u.attr(`content`)):f;if(s.pubDate=s.pubDate??p,s.author=l(`meta[property="article:author"]`).attr(`content`),s.link.startsWith(`https://slide.sports.sina.com.cn/`)||s.link.startsWith(`https://slide.tech.sina.com.cn/`)){let t=JSON.parse(l(`script`).text().match(/var slide_data = ({.*?})\s/)[1]);s.description=e(a.join(n,`templates/slide-5c74a843.art`),{slideData:t})}else if(s.link.startsWith(`https://video.sina.com.cn/`)){let i=l(`script`).text().match(/video_id:'?(.*?)'?,/)[1],{data:o}=await r(`https://api.ivideo.sina.com.cn/public/video/play`,{searchParams:{video_id:i,appver:`V11220.210521.03`,appname:`sinaplayer_pc`,applt:`web`,tags:`sinaplayer_pc`,jsonp:``,plid:2021012801,prid:``,uid:``,tid:``,pid:1,ran:Math.random(),r:s.link,ssid:`gusr_pc_${Date.now()}`,preload:0,uu:``,isAuto:1}}),c=o.data,u=c.image,d=c.videos.find(e=>e.type===`mp4`).dispatch_result.url;s.description=e(a.join(n,`templates/video-68dabc54.art`),{poster:u,videoUrl:d}),s.pubDate=t(c.create_time,`X`)}else s.link.startsWith(`https://news.sina.com.cn/`)||s.link.startsWith(`https://mil.news.sina.com.cn/`)?(s.description=l(`#article`).html(),s.category=l(`meta[name="keywords"]`).attr(`content`).split(`,`)):(s.description=l(`#artibody`).html(),s.category=l(`#keywords`).data(`wbkey`)?.split(`,`));return s});export{s as getRollNewsList,l as parseArticle,c as parseRollNewsList};