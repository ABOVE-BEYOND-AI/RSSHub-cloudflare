import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import{ViewType as i}from"./types-D9T3SQ-7.js";import a from"node:path";import o from"dayjs";const s={path:`/freegames/:locale?/:country?`,categories:[`game`],view:i.Notifications,example:`/epicgames/freegames/en-US/US`,parameters:{locale:{description:`Locale`,default:`en-US`},country:{description:`Country`,default:`US`}},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`store.epicgames.com/:locale/free-games`],target:`/freegames/:locale`}],name:`Free games`,maintainers:[`DIYgod`,`NeverBehave`,`Zyx-A`,`junfengP`,`nczitzk`,`KotaHv`],handler:c};async function c(i){let s=i.req.param(`locale`)??`en-US`,c=i.req.param(`country`)??`US`,l=`https://store.epicgames.com`,u=`${l}/${s}/free-games?lang=${s}`,d=`https://store-site-backend-static-ipv4.ak.epicgames.com/freeGamesPromotions?locale=${s}&country=${c}&allowCountries=${c}`,f=`https://store-content-ipv4.ak.epicgames.com/api/${s}/content`,p=await r({method:`get`,url:d}),m=o(),h=p.data.data.Catalog.searchStore.elements.filter(e=>e.promotions&&e.promotions.promotionalOffers&&e.promotions.promotionalOffers.length&&e.promotions.promotionalOffers[0].promotionalOffers[0].discountSetting.discountType===`PERCENTAGE`&&e.promotions.promotionalOffers[0].promotionalOffers[0].discountSetting.discountPercentage===0&&o(e.promotions.promotionalOffers[0].promotionalOffers[0].startDate)<=m&&o(e.promotions.promotionalOffers[0].promotionalOffers[0].endDate)>m).map(async i=>{let c=`${l}/${s}/p/`,u=`${f}/products/`,d=!1;i.categories.some(e=>e.path===`bundles`)&&(c=`${l}/${s}/bundles/`,d=!0,u=`${f}/bundles/`);let p=i.catalogNs.mappings&&i.catalogNs.mappings.length>0?i.catalogNs.mappings[0].pageSlug:i.offerMappings&&i.offerMappings.length>0?i.offerMappings[0].pageSlug:i.productSlug??i.urlSlug;i.offerType===`ADD_ON`&&(p=i.offerMappings[0].pageSlug),c+=p,u+=p;let m=i.description;if(d){let e=await r({method:`get`,url:u});m=e.data.data.about.shortDescription}let h=i.keyImages[0].url;i.keyImages.some(e=>e.type===`DieselStoreFrontWide`?(h=e.url,!0):!1);let g=o(i.promotions.promotionalOffers[0].promotionalOffers[0].endDate).toISOString();return{title:i.title,author:i.seller.name,link:c,description:e(a.join(n,`templates/description-a3b89ca2.art`),{description:m,image:h,endDate:g}),pubDate:t(i.promotions.promotionalOffers[0].promotionalOffers[0].startDate)}});return{title:`Epic Games Store - Free Games`,link:u,item:await Promise.all(h)}}export{s as route};