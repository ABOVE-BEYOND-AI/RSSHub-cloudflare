import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import{ViewType as o}from"./types-D9T3SQ-7.js";import s from"node:path";import{load as c}from"cheerio";import l from"iconv-lite";const u={path:`/book/:id?`,categories:[`reading`],view:o.Notifications,example:`/jjwxc/book/7013024`,parameters:{id:`作品 id，可在对应作品页中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`作品章节`,maintainers:[`nczitzk`],handler:d};async function d(o){let u=o.req.param(`id`),d=o.req.query(`limit`)?Number.parseInt(o.req.query(`limit`),10):100,f=`https://www.jjwxc.net`,p=new URL(`onebook.php?novelid=${u}`,f).href,{data:m}=await i(p,{responseType:`buffer`}),h=c(l.decode(m,`gbk`)),g=h(`meta[name="Author"]`).prop(`content`),_=h(`meta[name="Keywords"]`).prop(`content`).split(/,/);_.pop();let v=_.pop(),y=h(`tr[itemprop="chapter"]`).toArray().map(e=>{e=h(e);let i=e.find(`td`).first().text().trim(),o=e.find(`span[itemprop="headline"]`).text().trim(),c=e.find(`td`).eq(2).text().trim(),l=new URL(`onebook.php?novelid=${u}&chapterid=${i}`,f).href,d=e.find(`td[itemprop="wordCount"]`).text(),p=e.find(`td.chapterclick`).text(),m=e.find(`td`).last().text().trim(),_=e.find(`span[itemprop="headline"] font`).last().text()===`[VIP]`,y=e.find(`td`).eq(1).last().text().trim()===`[锁]`;return{title:`${o} ${c}`,link:l,description:t(s.join(r,`templates/book-6ec795d5.art`),{chapterId:i,chapterName:o,chapterIntro:c,chapterUrl:l,chapterWords:d,chapterClicks:p,chapterUpdatedTime:m}),author:g,category:[_?`VIP`:void 0,...v?.split(/\s/)??[]].filter(Boolean),guid:`jjwxc-${u}#${i}`,pubDate:a(n(m),8),isVip:_,isLock:y}});y.reverse(),y=await Promise.all(y.slice(0,d).map(n=>n.isLock?Promise.resolve(n):e.tryGet(n.link,async()=>{if(!n.isVip){let{data:e}=await i(n.link,{responseType:`buffer`}),a=c(l.decode(e,`gbk`));a(`span.favorite_novel`).parent().remove(),n.description+=t(s.join(r,`templates/book-6ec795d5.art`),{description:a(`div.novelbody`).html()})}return delete n.isVip,n})));let b=h(`div.logo a img`),x=`https:${b.prop(`src`)}`,S=new URL(`favicon.ico`,f).href;return{item:y,title:`${b.prop(`alt`).replace(/logo/,``)} | ${g}${_[0]}`,link:p,description:h(`span[itemprop="description"]`).text(),language:`zh`,image:x,icon:S,logo:S,subtitle:h(`meta[name="Description"]`).prop(`content`),author:h(`meta[name="Author"]`).prop(`content`)}}export{u as route};