import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import a from"node:path";import{load as o}from"cheerio";const s={path:`/:category{.+}?`,example:`/wa`,radar:[{source:[`abc.net.au/:category*`],target:`/:category`}],parameters:{category:"Category, can be found in the URL, can also be filled in with the `documentId` in the source code of the page, `news/justin` as **Just In** by default"},name:`Channel & Topic`,categories:[`traditional-media`],description:"\n::: tip\n  All Topics in [Topic Library](https://abc.net.au/news/topics) are supported, you can fill in the field after `topic` in its URL, or fill in the `documentId`.\n\n  For example, the URL for [Computer Science](https://www.abc.net.au/news/topic/computer-science) is `https://www.abc.net.au/news/topic/computer-science`, the `category` is `news/topic/computer-science`, and the `documentId` of the Topic is `2302`, so the route is [/abc/news/topic/computer-science](https://rsshub.app/abc/news/topic/computer-science) and [/abc/2302](https://rsshub.app/abc/2302).\n\n  The supported channels are all listed in the table below. For other channels, please find the `documentId` in the source code of the channel page and fill it in as above.\n:::",maintainers:[`nczitzk`,`pseudoyu`],handler:c};async function c(s){let{category:c=`news/justin`}=s.req.param(),l=s.req.query(`limit`)?Number.parseInt(s.req.query(`limit`),10):30,u=`https://www.abc.net.au`,d=new URL(`news-web/api/loader/channelrefetch`,u).href,f=``,p;if(Number.isNaN(c))f=new URL(c,u).href;else{p=c;let e=new URL(`news/feed/${p}/rss.xml`,u).href,t=await r(e);f=t.match(/<link>([\w-./:?]+)<\/link>/)[1]}let m=await r(f),h=o(m);p=p??h(`div[data-uri^="coremedia://collection/"]`).first().prop(`data-uri`).split(/\//).pop();let g=await r(d,{query:{name:`PaginationArticles`,documentId:p,size:l}}),_=g.collection.slice(0,l).map(e=>{let r={title:e.title.children??e.title,link:e.link.startsWith(`https://`)?e.link:new URL(e.link,u).href,description:t(a.join(i,`templates/description-bd10ae5e.art`),{image:e.image?{src:e.image.imgSrc.split(/\?/)[0],alt:e.image.alt}:void 0}),author:e.newsBylineProps?.authors?.map(e=>e.name).join(`/`)??void 0,guid:`abc-${e.id}`,pubDate:n(e.dates.firstPublished),updated:e.dates.lastUpdated?n(e.dates.lastUpdated):void 0};return e.mediaIndicator&&(r.enclosure_type=`audio/mpeg`,r.itunes_item_image=e.image?.imgSrc.split(/\?/)[0]??void 0,r.itunes_duration=e.mediaIndicator.duration),r});_=await Promise.all(_.map(s=>e.tryGet(s.link,async()=>{try{let e=await r(s.link),c=o(e);c(`aside, header, [data-print="inline-media"], [data-component="EmbedBlock"]`).remove(),c(`#body *, div[data-component="FeatureMedia"]`).children().each(function(){let e=c(this);e.prop(`tagName`).toLowerCase()===`figure`?e.replaceWith(t(a.join(i,`templates/description-bd10ae5e.art`),{image:{src:e.find(`img`).prop(`src`).split(/\?/)[0],alt:e.find(`figcaption`).text().trim()}})):e.removeAttr(`id class role data-component data-uri`)}),s.title=c(`meta[property="og:title"]`).prop(`content`),s.description=``;let l=String.raw`"(?:MIME|content)?Type":"([\w]+/[\w]+)".*?"(?:fileS|s)?ize":(\d+),.*?"url":"([\w-.:/?]+)"`,u=e.match(new RegExp(l,`g`));if(u){let e=u.map(e=>e.match(new RegExp(l))).sort((e,t)=>Number.parseInt(e[2],10)-Number.parseInt(t[2],10)).pop();s.enclosure_url=e[3],s.enclosure_length=e[2],s.enclosure_type=e[1],s.description=t(a.join(i,`templates/description-bd10ae5e.art`),{enclosure:{src:s.enclosure_url,type:s.enclosure_type}})}s.description=t(a.join(i,`templates/description-bd10ae5e.art`),{description:(c(`div[data-component="FeatureMedia"]`).html()||``)+(c(`#body div[data-component="LayoutContainer"] div`).first().html()||``)})+s.description,s.category=c(`meta[property="article:tag"]`).toArray().flatMap(e=>c(e).prop(`content`).split(/ï¼Œ/).map(e=>e.trim())),s.guid=`abc-${c(`meta[name="ContentId"]`).prop(`content`)}`,s.pubDate=n(c(`meta[property="article:published_time"]`).prop(`content`)),s.updated=n(c(`meta[property="article:modified_time"]`).prop(`content`))}catch{}return s})));let v=new URL(h(`link[rel="apple-touch-icon"]`).prop(`href`)||``,u).href;return{item:_,title:h(`title`).first().text(),link:f,description:h(`meta[property="og:description"]`).prop(`content`),language:h(`html`).prop(`lang`),image:h(`meta[property="og:image"]`).prop(`content`).split(`?`)[0],icon:v,logo:v,subtitle:h(`meta[property="og:title"]`).prop(`content`),author:h(`meta[name="generator"]`).prop(`content`),allowEmpty:!0}}export{s as route};