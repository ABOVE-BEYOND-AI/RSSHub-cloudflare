import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{getSearchParams as a,rootUrl as o}from"./utils-C_M_Hqf8.js";import s from"node:path";import{load as c}from"cheerio";const l=async l=>{let{id:u=`1103`}=l.req.param(),d=l.req.query(`limit`)?Number.parseInt(l.req.query(`limit`),10):20,f=new URL(`subject/${u}`,o).href,p=new URL(`api/subject/${u}/article`,o).href,{data:m}=await i(p,{searchParams:a({Subject_Id:u})}),h=m.data.slice(0,d).map(e=>{let i=e.article_title,a=t(s.join(r,`templates/description-881baa33.art`),{intro:e.article_brief}),c=`cls-${e.article_id}`,l=e.article_img;return{title:i,description:a,pubDate:n(e.article_time,`X`),link:new URL(`detail/${e.article_id}`,o).href,category:e.subjects.map(e=>e.subject_name),author:e.article_author,guid:c,id:c,content:{html:a,text:e.article_brief},image:l,banner:l}});h=await Promise.all(h.map(a=>e.tryGet(a.link,async()=>{let{data:e}=await i(a.link),o=c(e),l=JSON.parse(o(`script#__NEXT_DATA__`).text())?.props?.initialState?.detail?.articleDetail??void 0;if(!l)return a;let u=l.title,d=t(s.join(r,`templates/description-881baa33.art`),{images:l.images.map(e=>({src:e,alt:u})),intro:l.brief,description:l.content}),f=`cls-${l.id}`,p=l.images?.[0]??void 0;return a.title=u,a.description=d,a.pubDate=n(l.ctime,`X`),a.category=[...new Set(l.subject?.flatMap(e=>[e.name,...e.subjectCategory?.flatMap(e=>[e.columnName||[],e.name||[]])??[]])??[])].filter(Boolean),a.author=l.author?.name??a.author,a.guid=f,a.id=f,a.content={html:d,text:l.content},a.image=p,a.banner=p,a.enclosure_url=l.audioUrl,a.enclosure_type=a.enclosure_url?`audio/${a.enclosure_url.split(/\./).pop()}`:void 0,a.enclosure_title=u,a})));let{data:g}=await i(f),_=c(g),v=JSON.parse(_(`script#__NEXT_DATA__`).text())?.props?.initialProps?.pageProps?.subjectDetail??void 0,y=`财联社`,b=v?.img??void 0;return{title:`${y} - ${v?.name??_(`title`).text()}`,description:v?.description??void 0,link:f,item:h,allowEmpty:!0,image:b,author:y}},u={path:`/subject/:id?`,name:`话题`,url:`www.cls.cn`,maintainers:[`nczitzk`],handler:l,example:`/cls/subject/1103`,parameters:{category:`分类，默认为 1103，即A股盘面直播，可在对应话题页 URL 中找到`},description:"::: tip\n  若订阅 [有声早报](https://www.cls.cn/subject/1151)，网址为 `https://www.cls.cn/subject/1151`。截取 `https://www.cls.cn/subject/` 到末尾的部分 `1151` 作为参数填入，此时路由为 [`/cls/subject/1151`](https://rsshub.app/cls/subject/1151)。\n:::\n    ",categories:[`finance`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.cls.cn/subject/:id`],target:e=>{let t=e.id;return`/subject${t?`/${t}`:``}`}}]};export{l as handler,u as route};