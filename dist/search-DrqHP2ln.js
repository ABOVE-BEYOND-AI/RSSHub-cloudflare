import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./md5-15Cn4YyR.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import"./got-BaOFZRd4.js";import"./config-not-found-B7nOMdXp.js";import{apiMapCategory as i,defaultDomain as a,getApiUrl as o,getRootUrl as s,processApiItems as c}from"./utils-Ca3v7XQt.js";import l from"node:path";const u={path:`/search/:option?/:category?/:keyword?/:time?/:order?`,categories:[`anime`],example:`/18comic/search/photos/all/NTR`,parameters:{option:"选项，可选 `video` 和 `photos`，默认为 `photos`",category:"分类，同上表，默认为 `all` 即全部",keyword:`关键字，同上表，默认为空`,time:"时间范围，同上表，默认为 `a` 即全部",order:"排列顺序，同上表，默认为 `mr` 即最新"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`jmcomic.group/`],target:`/:category?/:time?/:order?/:keyword?`}],name:`搜索`,maintainers:[],handler:d,url:`jmcomic.group/`,description:`::: tip
  关键字必须超过两个字，这是来自网站的限制。
:::`};async function d(u){let d=u.req.param(`option`)??`photos`,f=u.req.param(`category`)??`all`,p=u.req.param(`keyword`)??``,m=u.req.param(`time`)??`a`,{domain:h=a}=u.req.query(),g=s(h),_=u.req.param(`order`)??`mr`,v=`${g}/search/${d}${f===`all`?``:`/${f}`}${p?`?search_query=${p}`:`?`}${m===`a`?``:`&t=${m}`}${_===`mr`?``:`&o=${_}`}`,y=u.req.query(`limit`)?Number.parseInt(u.req.query(`limit`)):20,b=o();_=m===`a`?_:`${_}_${m}`,b=`${b}/search?search_query=${p}&o=${_}`;let x=await c(b),S=x.content;f!==`all`&&(S=x.content.filter(e=>e.category.title===i(f))),S=S.slice(0,y);let C=await Promise.all(S.map(i=>e.tryGet(`18comic:search:${i.id}`,async()=>{let e={};return e.title=i.name,e.link=`${g}/album/${i.id}`,e.guid=`18comic:/album/${i.id}`,e.updated=n(i.update_at),b=`${o()}/album?id=${i.id}`,x=await c(b),e.pubDate=new Date(x.addtime*1e3),e.category=x.tags.map(e=>e),e.author=x.author.map(e=>e).join(`, `),e.description=t(l.join(r,`templates/description-afe7e434.art`),{introduction:x.description,images:[`https://cdn-msp3.${h}/media/albums/${i.id}_3x4.jpg`],cover:`https://cdn-msp3.${h}/media/albums/${i.id}_3x4.jpg`,category:e.category}),e})));return{title:`Search Results For '${p}' - 禁漫天堂`,link:v.replace(/\?$/,``),item:C,allowEmpty:!0}}export{u as route};