import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as e}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as t}from"./esm-shims-BDPl6Msv.js";import{got_default as n}from"./got-BaOFZRd4.js";import{invalid_parameter_default as r}from"./invalid-parameter-CfUmvEUg.js";import{isValidHost as i}from"./valid-host-JqD2S4D4.js";import a from"node:path";import{load as o}from"cheerio";import{CookieJar as s}from"tough-cookie";const c=new s,l=n.extend({cookieJar:c});function u(e){let t=new URLSearchParams(e);return t.set(`is_format_data`,`1`),t.set(`is_new_list`,`1`),t.set(`type`,`1`),t.toString()}async function d(){let e=await l(`https://rent.591.com.tw`).text(),t=o(e),n=t(`meta[name="csrf-token"]`).attr(`content`);if(!n)throw Error(`CSRF token not found`);return n}async function f(e){let t=await d(),n=await l({url:e,headers:{"X-CSRF-TOKEN":t}}).json(),{data:{data:r}}=n;return r}const p=n=>e(a.join(t,`templates/house-68aed177.art`),{house:n}),m={path:`/:country/rent/:query?`,categories:[`other`],example:`/591/tw/rent/order=posttime&orderType=desc`,parameters:{country:`Country code. Only tw is supported now`,query:`Query Parameters`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Rental house`,maintainers:[`Yukaii`],handler:h,description:`::: tip
  Copy the URL of the 591 filter housing page and remove the front part \`https://rent.591.com.tw/?\`, you will get the query parameters.
:::`};async function h(e){let t=e.req.param(`query`)??``,n=e.req.param(`country`)??`tw`;if(!i(n)&&n!==`tw`)throw new r(`Invalid country codes. Only "tw" is supported now.`);let a=await f(`https://rent.591.com.tw/home/search/rsList?${u(t)}`),o=`https://rent.591.com.tw/?${t}`,s=a.map(e=>{let{title:t,post_id:n,price:r,price_unit:i}=e,a=`https://rent.591.com.tw/home/${n}`,o=`${t} - ${r} ${i}`,s=p(e);return{title:o,description:s,link:a}});return e.set(`json`,{houses:a}),{title:`591 租屋 - 自訂查詢`,link:o,description:`591 租屋 - 自訂查詢, query: ${t}`,item:s}}export{m as route};