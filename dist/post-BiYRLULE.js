import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import{timezone as i}from"./timezone-BrxBCotj.js";import a from"node:path";import{load as o}from"cheerio";async function s(e,t=0,n=7e6){let{data:i}=await r(`https://tieba.baidu.com/p/${e}?see_lz=${t}&pn=${n}&ajax=1`,{headers:{Referer:`https://tieba.baidu.com/`}}),a=o(i),c=Number.parseInt(a(`[max-page]`).attr(`max-page`));return c>n?s(e,c):i}const c={path:[`/tieba/post/:id`,`/tieba/post/lz/:id`],categories:[`bbs`],example:`/baidu/tieba/post/686961453`,parameters:{id:`帖子 ID`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`tieba.baidu.com/p/:id`]}],name:`帖子动态`,maintainers:[`u3u`],handler:l};async function l(r){let c=r.req.param(`id`),l=r.req.path.includes(`lz`)?1:0,u=await s(c,l),d=o(u),f=d(`.core_title_txt`).attr(`title`),p=d(`.p_postlist > [data-field]:not(:has(.ad_bottom_view))`);return{title:l?`【只看楼主】${f}`:f,link:`https://tieba.baidu.com/p/${c}?see_lz=${l}`,description:`${f}的最新回复`,item:p.toArray().map(r=>{let o=d(r),{author:s,content:l}=o.data(`field`),u=o.find(`.post-tail-wrap > .tail-info`).toArray().map(e=>d(e).text()),[p,m,h,g]=[``,``,``,``];return u.length===0&&`date`in l?(h=`${l.post_no}楼`,g=l.date,p=o.find(`.j_d_post_content`).html()):u.length===2?([h,g]=u,p=l.content):u.length===3&&([m,h,g]=u,p=l.content),{title:`${s.user_name}回复了帖子《${f}》`,description:e(a.join(n,`templates/post-c443ff41.art`),{pubContent:p,author:s.user_name,num:h,from:m}),pubDate:i(t(g,`YYYY-MM-DD hh:mm`),8),link:`https://tieba.baidu.com/p/${c}?pid=${l.post_id}#${l.post_id}`}})}}export{c as route};