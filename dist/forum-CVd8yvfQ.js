import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import o from"node:path";import{load as s}from"cheerio";import c from"iconv-lite";const l=`https://www.flyert.com.cn`,u=(e,i)=>e(`div.comiis_wzli`).slice(0,i).toArray().map(i=>{i=e(i);let a=i.find(`div.wzbt`).text().trim(),s=i.find(`div.wzpic img`).prop(`src`),c=t(o.join(r,`templates/description-881baa33.art`),{images:s?[{src:s,alt:a}]:void 0,description:i.find(`div.wznr`).html()}),u=i.find(`div.subcat span.y`).contents()?.eq(2)?.text().trim()??void 0,d=new URL(i.find(`div.wzbt a`).prop(`href`),l).href;return{title:a,description:c,pubDate:u?n(u):void 0,link:d,author:i.find(`div.subcat span.y a`).first().text(),content:{html:c,text:i.find(`div.wznr`).text()},image:s,banner:s}}),d=(e,t)=>e(`div.comiis_postlist`).toArray().filter(t=>(t=e(t),t.find(`span.comiis_common a[data-track]`).toArray().some(t=>{t=e(t);let n=t.attr(`data-track`)||``;return n.endsWith(`文章`)}))).slice(0,t).map(t=>{t=e(t);let r=e(t.find(`span.comiis_common a[data-track]`).toArray().find(t=>{t=e(t);let n=t.attr(`data-track`)||``;return n.endsWith(`文章`)})),i=t.find(`span.author_b span`).prop(`title`)||void 0;return{title:r.text().trim(),pubDate:i?n(i):void 0,link:new URL(r.prop(`href`),l).href,author:t.find(`a.author_t`).text().trim()}}),f=(e,i)=>{let s=e(`h1.ph`).text().trim(),c=t(o.join(r,`templates/description-881baa33.art`),{intro:e(`div.s`).text()||void 0,description:e(`div#artMain`).html()}),l=e(`p.xg1`).contents().first().text().trim()?.match(/(\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2})/)?.[1]??void 0,u=`flyert-${i.link.split(/=/).pop()}`;return i.title=s,i.description=c,i.pubDate=l?a(n(l),8):i.pubDate,i.author=e(`p.xg1 a`).first().text(),i.guid=u,i.id=u,i.content={html:c,text:e(`div#artMain`).text()},i},p=(e,i)=>{e(`img.zoom`).each((n,i)=>{i=e(i),i.replaceWith(t(o.join(r,`templates/description-881baa33.art`),{images:i.prop(`zoomfile`)||i.prop(`file`)?[{src:i.prop(`zoomfile`)||i.prop(`file`),alt:i.prop(`alt`)||i.prop(`title`)}]:void 0}))}),e(`i.pstatus`).remove(),e(`div.tip`).remove();let s=e(`span#thread_subject`).text().trim(),c=e(`div.post_message`).first().html(),l=e(`span[title]`).first().prop(`title`),u=i.link.match(/tid=(\d+)/)?.[1]??void 0,d=u?`flyert-${u}`:void 0;return i.title=s,i.description=c,i.pubDate=l?a(n(l),8):i.pubDate,i.author=e(`a.kmxi2`).first().text(),i.guid=d,i.id=d,i.content={html:c,text:e(`div.post_message`).first().text()},i},m=async t=>{let{params:n}=t.req.param(),r=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):5,a=n?decodeURIComponent(n).split(/&/).filter(e=>e.split(/=/).length===2).join(`&`):void 0,o=new URL(`forum.php${a?`?${a}`:``}`,l).href,{data:m}=await i(o,{responseType:`buffer`}),h=s(c.decode(m,`gbk`)),g=h(`meta[http-equiv="Content-Language"]`).prop(`content`),_=h(`table#threadlisttableid`).length===0?u(h,r):d(h,r);_=await Promise.all(_.map(t=>e.tryGet(t.link,async()=>{let{data:e}=await i(t.link,{responseType:`buffer`}),n=s(c.decode(e,`gbk`).replaceAll(/<\/?ignore_js_op>/g,``));return t=n(`div.firstpost`).length===0?f(n,t):p(n,t),t.language=g,t})));let v=`https:${h(`div.wp h2 a img`).prop(`src`)}`;return{title:`飞客 - ${h(`a.forum_name, li.a, li.cur, li.xw1, div.z > a.xw1`).toArray().map(e=>h(e).text()).join(` - `)}`,description:h(`meta[name="description"]`).prop(`content`),link:o,item:_,allowEmpty:!0,image:v,author:h(`meta[name="application-name"]`).prop(`content`)}},h={path:`/forum/:params{.+}?`,name:`会员说`,url:`www.flyert.com.cn`,maintainers:[`nczitzk`],handler:m,example:`/flyert/forum`,parameters:{params:`参数，默认为空，可在对应分类页 URL 中找到`},description:"::: tip\n  若订阅 [酒店集团优惠](https://www.flyert.com.cn/forum.php?mod=forumdisplay&sum=all&fid=all&catid=322&filter=sortid&sortid=144&searchsort=1&youhui_type=19)，网址为 `https://www.flyert.com.cn/forum.php?mod=forumdisplay&sum=all&fid=all&catid=322&filter=sortid&sortid=144&searchsort=1&youhui_type=19`。截取 `https://www.flyert.com.cn/forum.php?` 到末尾的部分 `mod=forumdisplay&sum=all&fid=all&catid=322&filter=sortid&sortid=144&searchsort=1&youhui_type=19` **进行 UrlEncode 编码** 后作为参数填入，此时路由为 [`/flyert/forum/mod%3Dforumdisplay%26sum%3Dall%26fid%3Dall%26catid%3D322%26filter%3Dsortid%26sortid%3D144%26searchsort%3D1%26youhui_type%3D226`](https://rsshub.app/flyert/forum/mod%3Dforumdisplay%26sum%3Dall%26fid%3Dall%26catid%3D322%26filter%3Dsortid%26sortid%3D144%26searchsort%3D1%26youhui_type%3D226)。\n:::\n    ",categories:[`bbs`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.flyert.com.cn/forum.php`],target:(e,t)=>{let n=[...t.searchParams.entries()].map(([e,t])=>e+`=`+t).join(`&`);return`/forum${n?`/${encodeURIComponent(n)}`:``}`}}]};export{m as handler,h as route};