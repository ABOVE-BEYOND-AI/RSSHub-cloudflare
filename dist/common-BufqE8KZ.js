import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{ViewType as a}from"./types-D9T3SQ-7.js";import o from"node:path";import{load as s}from"cheerio";const c={path:`/:category/:topic?`,categories:[`traditional-media`],view:a.Articles,example:`/reuters/world/us`,parameters:{category:{description:`find it in the URL, or tables below`,options:[{value:`world`,label:`World`},{value:`business`,label:`Business`},{value:`legal`,label:`Legal`},{value:`markets`,label:`Markets`},{value:`breakingviews`,label:`Breakingviews`},{value:`technology`,label:`Technology`},{value:`graphics`,label:`Graphics`},{value:`authors`,label:`Authors`}],default:`world`},topic:"find it in the URL, or tables below, leave empty for `All`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`reuters.com/:category/:topic?`,`reuters.com/`]}],name:`Category/Topic/Author`,maintainers:[`LyleLee`,`HenryQW`,`proletarius101`,`black-desk`,`nczitzk`,`pseudoyu`],handler:l,description:`-   \`:category\`:

      | World | Business | Legal | Markets | Breakingviews | Technology | Graphics |
      | ----- | -------- | ----- | ------- | ------------- | ---------- | -------- |
      | world | business | legal | markets | breakingviews | technology | graphics |

  -   \`world/:topic\`:

      | All | Africa | Americas | Asia Pacific | China | Europe | India | Middle East | United Kingdom | United States | The Great Reboot | Reuters Next |
      | --- | ------ | -------- | ------------ | ----- | ------ | ----- | ----------- | -------------- | ------------- | ---------------- | ------------ |
      |     | africa | americas | asia-pacific | china | europe | india | middle-east | uk             | us            | the-great-reboot | reuters-next |

  -   \`business/:topic\`:

      | All | Aerospace & Defense | Autos & Transportation | Energy | Environment | Finance | Healthcare & Pharmaceuticals | Media & Telecom | Retail & Consumer | Sustainable Business | Charged | Future of Health | Future of Money | Take Five | Reuters Impact |
      | --- | ------------------- | ---------------------- | ------ | ----------- | ------- | ---------------------------- | --------------- | ----------------- | -------------------- | ------- | ---------------- | --------------- | --------- | -------------- |
      |     | aerospace-defense   | autos-transportation   | energy | environment | finance | healthcare-pharmaceuticals   | media-telecom   | retail-consumer   | sustainable-business | charged | future-of-health | future-of-money | take-five | reuters-impact |

  -   \`legal/:topic\`:

      | All | Government | Legal Industry | Litigation | Transactional |
      | --- | ---------- | -------------- | ---------- | ------------- |
      |     | government | legalindustry  | litigation | transactional |

  -   \`authors/:topic\`:

      | Default | Jonathan Landay | any other authors |
      | ------- | --------------- | ----------------- |
      | reuters | jonathan-landay | their name in URL |

  More could be found in the URL of the category/topic page.`};async function l(a){let c=new Set([`authors`,`tags`]),l=[`world`],u=a.req.param(`category`),d=a.req.param(`topic`)??(u===`authors`?`reuters`:``),f=a.req.query(`limit`)?Number.parseInt(a.req.query(`limit`)):20,p=a.req.query(`sophi`)===`true`&&d!==``&&l.includes(u),m=`/${u}/${d?`${d}/`:``}`,h={Accept:`application/json, text/plain, */*`,"Accept-Language":`en-US,en;q=0.9`,Referer:`https://www.reuters.com/`};try{let{title:l,description:d,rootUrl:g,response:_}=await(async()=>{if(c.has(u)){let e=`https://www.reuters.com/pf/api/v3/content/fetch/articles-by-topic-v1`,t=await r(e,{query:{query:JSON.stringify({offset:0,size:f,topic_url:m,website:`reuters`})},headers:h});return{title:`${t.result.topics[0].name} | Reuters`,description:t.result.topics[0].entity_id,rootUrl:e,response:t}}else{let e=`https://www.reuters.com/pf/api/v3/content/fetch/articles-by-section-alias-or-id-v1`,t=await r(e,{query:{query:JSON.stringify({offset:0,size:f,section_id:m,website:`reuters`,...p?{fetch_type:`sophi`,sophi_page:`*`,sophi_widget:`topic`}:{}})},headers:h});return{title:t.result.section.title,description:t.result.section.section_about,rootUrl:e,response:t}}})(),v=_.result.articles.map(e=>({title:e.title,link:new URL(e.canonical_url,g).href,guid:e.id,pubDate:n(e.published_time),updated:n(e.updated_time),author:e.authors.map(e=>e.name).join(`, `),category:e.kicker.names,description:e.description}));v=v.filter((e,t)=>v.findIndex(t=>e.guid===t.guid)===t);let y=await Promise.allSettled(v.map(c=>a.req.query(`fulltext`)===`true`?e.tryGet(c.link,async()=>{let e=await r(c.link,{headers:h}),a=s(e.data);if(e.url.startsWith(`https://www.reuters.com/investigates/`)){let e=JSON.parse(a(`script[type="application/ld+json"]`).text());return a(`.special-report-article-container .container, #slide-dek, #slide-end, .share-in-article-container`).remove(),c.title=e.headline,c.pubDate=n(e.dateCreated),c.author=e.creator,c.category=e.keywords,c.description=a(`.special-report-article-container`).html(),c}let l=a(`script#fusion-metadata`).text().match(/Fusion.globalContent=({[\S\s]*?});/);if(l){let e=JSON.parse(l[1]);return c.title=e.result.title||c.title,c.description=t(o.join(i,`templates/description-073fbea1.art`),{result:e.result}),c.pubDate=n(e.result.display_time),c.author=e.result.authors.map(e=>e.name).join(`, `),c.category=e.result.taxonomy.keywords,c}return a(`.title`).remove(),a(`.article-metadata`).remove(),c.title=a(`meta[property="og:title"]`).attr(`content`),c.pubDate=n(e.data.match(/"datePublished":"(.*?)","dateModified/)[1]),c.author=e.data.match(/{"@type":"Person","name":"(.*?)"}/g).map(e=>e.match(/"name":"(.*?)"/)[1]).join(`, `),c.description=a(`article`).html(),c}):c));return v=y.filter(e=>e.status===`fulfilled`).map(e=>e.value),{title:l,description:d,image:`https://www.reuters.com/pf/resources/images/reuters/logo-vertical-default-512x512.png?d=116`,link:`https://www.reuters.com${m}`,item:v}}catch{let e=d?`https://www.reuters.com/arc/outboundfeeds/v4/mobile/section${m}?outputType=json`:`https://www.reuters.com/arc/outboundfeeds/v4/mobile/section/${u}/?outputType=json`,t=await r(e,{headers:h});if(t.wireitems?.length){let e=t.wireitems.map(e=>{let r=e.templates.find(e=>e.template===`story_with_image`)?.story;return r?{title:r.hed,link:e.templates.find(e=>e.template===`story_with_image`)?.template_action?.url,guid:r.usn,pubDate:n(r.updated_at),updated:n(r.updated_at),description:r.lede,author:r.authors?.map(e=>e.name).join(`, `),category:[t.analytics?.topic_channel,t.analytics?.topic_sub_channel].filter(Boolean)}:null}).filter(Boolean);return{title:t.analytics?.title||`${t.wire_name} | Reuters`,description:t.analytics?.content_title,image:`https://www.reuters.com/pf/resources/images/reuters/logo-vertical-default-512x512.png?d=116`,link:t.canonical_action?.url||`https://www.reuters.com${m}`,category:[t.analytics?.topic_channel,t.analytics?.topic_sub_channel].filter(Boolean),item:e.slice(0,f)}}}}export{c as route};