import{rand_user_agent_default as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{got_default as a}from"./got-BaOFZRd4.js";import o from"node:path";import{load as s}from"cheerio";import c from"p-map";const l=e({browser:`chrome`,os:`android`,device:`mobile`}),u=e=>t.tryGet(e.link,async()=>{let t=e.link.replace(/(?<=^https:\/\/\w+\.wsj\.com)/,`/amp`),c=await a({url:t,method:`get`,headers:{"User-Agent":l}}),u=c.data,d=s(u),f=d(`head > meta[name="description"]`).attr(`content`),p=d(`meta[itemprop="dateModified"]`).attr(`content`),m=d(`meta[itemprop="datePublished"]`).attr(`content`),h=d(`.author > a[rel="author"]`).text(),g=d(`meta[name="keywords"]`).attr(`content`).split(`,`).map(e=>e.trim()),_=d(`article`);e.subTitle=d(`h2.sub-head`).html(),_.find(`.media-object-podcast`).remove(),_.find(`.bylineWrap`).each((e,t)=>{d(t).find(`p`).each(function(){d(this).replaceWith(d(this).html())})}),_.find(`.bigTop-hero`).each((e,t)=>{let n=d(t).find(`amp-img`).attr(`src`),r=d(t).find(`amp-img`).attr(`alt`),i=d(t).find(`.imageCaption`).text().trim(),a=d(t).find(`.imageCredit`).text().trim(),o=d(`<figure><img src="${n}" alt="${r}"><figcaption>${i} <span>${a}</span></figcaption></figure>`);d(o).insertBefore(t),d(t).remove()}),_.find(`amp-img`).each((e,t)=>{let n=d(`<img width="${t.attribs.width}" height="${t.attribs.height}" src="${t.attribs.src}" alt="${t.attribs.alt}">`);d(n).insertBefore(t),d(t).remove()}),_.find(`amp-iframe`).each((e,t)=>{let n=d(`<iframe width="${t.attribs.width}" height="${t.attribs.height}" src="${t.attribs.src}">`);d(n).insertBefore(t),d(t).remove()});let v=[`amp-ad`,`.wsj-ad`,`h1`,`h2`,`.zonedModule`,`.snippet`,`.newsletter-inset`];for(let e of v)_.find(e).each((e,t)=>{d(t).remove()});return _.find(`.paywall`).each((e,t)=>{d(t.childNodes).insertBefore(t),d(t).remove()}),e.article=_.html(),e.description=n(o.join(i,`templates/article-description-8e28f8db.art`),{item:e}),{title:e.title,pubDate:r(m),updated:r(p),author:h,link:e.link,summary:f,description:e.description,category:g,icon:`https://s.wsj.net/media/wsj_launcher-icon-4x.png`,logo:`https://vir.wsj.net/fp/assets/webpack4/img/wsj-logo-big-black.165e51cc.svg`}}),d={"en-us":`https://www.wsj.com`,"zh-cn":`https://cn.wsj.com/zh-hans`,"zh-tw":`https://cn.wsj.com/zh-hant`},f={path:`/:lang/:category?`,categories:[`traditional-media`],example:`/wsj/en-us/opinion`,parameters:{lang:"Language, `en-us`, `zh-cn`, `zh-tw`",category:`Category. See below`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`News`,maintainers:[`oppilate`],handler:p,description:`en_us

| World | U.S. | Politics | Economy | Business | Tech       | Markets | Opinion | Books & Arts | Real Estate | Life & Work | Sytle               | Sports |
| ----- | ---- | -------- | ------- | -------- | ---------- | ------- | ------- | ------------ | ----------- | ----------- | ------------------- | ------ |
| world | us   | politics | economy | business | technology | markets | opinion | books-arts   | realestate  | life-work   | style-entertainment | sports |

  zh-cn / zh-tw

| 国际  | 中国  | 金融市场 | 经济    | 商业     | 科技       | 派        | 专栏与观点 |
| ----- | ----- | -------- | ------- | -------- | ---------- | --------- | ---------- |
| world | china | markets  | economy | business | technology | life-arts | opinion    |

  Provide full article RSS for WSJ topics.`};async function p(e){let t=e.req.param(`lang`),n=e.req.param(`category`)||``,r=d[t],i=` - ${t.toUpperCase()}`,o=r;n.length>0&&(o=`${r}/news/${n}`,i=`${i} - ${n}`);let l=await a({method:`get`,url:o}),f=s(l.data),p=f(`script:contains("window.__STATE__")`).text(),m=JSON.parse(p.match(/{.*}/)[0]).data,h=Object.entries(m).filter(([e,t])=>{if(!e.startsWith(`article`))return!1;let n=t.data.data.url;return n.includes(`wsj.com/articles/`)}).map(([e])=>e),g=h.map(e=>{let t={};return t.title=m[e].data.data.headline,t.link=m[e].data.data.url,t.test=e,t}),_=await c(g,e=>u(e),{concurrency:10});return{title:`WSJ${i}`,link:o,description:`WSJ${i}`,item:_}}export{f as route};