import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";const o=t=>{let n=[`https://api.bgm.tv/calendar`,`https://cdn.jsdelivr.net/npm/bangumi-data/dist/data.json`];return Promise.all(n.map((n,r)=>t(n,async()=>{let{data:e}=await i(n);if(r===1){let t=[];for(let n of e.items){let e=n.sites.find(e=>e.site===`bangumi`);e&&(n.bgmId=e.id,t.push(n))}e.items=t}return e},e.cache.contentExpire,!1)))};var s=o;const c={path:`/calendar/today`,categories:[`anime`],example:`/bangumi.tv/calendar/today`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`bgm.tv/calendar`]}],name:`放送列表`,maintainers:[`magic-akari`],handler:l,url:`bgm.tv/calendar`};async function l(){let[e,i]=await s(t.tryGet),o=i.siteMeta,c=new Date(Date.now());c.setUTCHours(c.getUTCHours()+9);let l=c.getUTCDay(),u=e.find(e=>e.weekday.id%7===l),d=new Set(u.items.map(e=>e.id.toString())),f={};for(let e of u.items)f[e.id]=(e.images||{}).large;let p=i.items.filter(e=>d.has(e.bgmId));for(let e of p)e.image=f[e.bgmId];return{title:`bangumi 每日放送`,link:`https://bgm.tv/calendar`,item:p.map(e=>{let t=new Date(Date.now());t.setSeconds(0);let i=new Date(e.begin||t);t.setHours(i.getHours()),t.setMinutes(i.getMinutes()),t.setSeconds(i.getSeconds());let s=`https://bangumi.tv/subject/${e.bgmId}`,c=`${s}#${new Intl.DateTimeFormat(`zh-CN`).format(t)}`,l=n(a.join(r,`templates/today-7f5f417a.art`),{bgm:e,siteMeta:o});return{id:c,guid:c,title:[e.title,Object.values(e.titleTranslate).map(e=>e.join(`｜`)).join(`｜`)].filter(Boolean).join(`｜`),updated:t.toISOString(),pubDate:t.toUTCString(),link:s,description:l,content:{html:l}}})}}export{c as route};