import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import{load as o}from"cheerio";const s=`https://nzmz.xyz`,c=async(e,t,n,r,a)=>{let c=await e(t,async()=>{let{data:e}=await i(t);return e}),l=o(c);return l(r).eq(Number.parseInt(n,10)).find(a).toArray().map(e=>(e=l(e),{link:new URL(e.prop(`href`),s).href}))},l=(e,t)=>e(`newzmz#${t.match(/details-(.*?)\.html/)[1]}`,async()=>{let{data:e}=await i(t),r=o(e),a=r(`div.chsname`).text(),s=r(`div.engname`).text(),c=r(`div.aliasname`).text().replace(/又名：/,``).split(`/`).map(e=>e.trim()).filter(Boolean),l=r(`a.addgz`).prop(`href`);return{link:l,pubDate:n(r(`span.duration`).first().text().match(/(\d{4}-\d{2}-\d{2})/)[1]),description:{image:r(`div.details-bg img`).prop(`src`),nameZh:a,nameEn:s,alias:c,update:r(`span.upday`).text(),links:r(`div.ep-infos a[title]`).toArray().map(e=>(e=r(e),{title:e.prop(`title`),link:e.prop(`href`)}))},author:r(`ul.sws-list`).first().find(`h5.title`).toArray().map(e=>r(e).text()).join(` / `),category:[a,s,...c]}}),u=async(e,n,s,c,l)=>{let{data:u}=await i(e.link),d=o(u);return d(s).toArray().map(i=>{i=d(i);let o=i.find(c).toArray().map(e=>d(e).text()),s=i.find(l).toArray().map(e=>(e=d(e),{title:e.find(`p.link-name`).text(),link:e.find(`a[title]`).prop(`href`)})),u=i.find(`span.up`).text().replaceAll(/[\s-]+/g,``),f=`${e.description.nameZh||e.description.nameEn}|${u}`,p=`newzmz#${e.link.match(/view\/(.*?)\.html/)[1]}-${u}`;return{guid:p,title:f,link:e.link,description:t(a.join(r,`templates/description-f7b4d948.art`),{...e.description,categories:o,downLinks:s}),author:e.author,category:[...e.category,...o].filter(Boolean),pubDate:e.pubDate,enclosure_url:s.findLast(e=>e.title===n)?.link??s[0].link,enclosure_type:`application/x-bittorrent`}})},d={path:`/:id?/:downLinkType?`,categories:[`multimedia`],example:`/newzmz/qEzRyY3v`,parameters:{id:`剧集 id，可在剧集下载页 URL 中找到`,downLinkType:`下载链接类型，默认为磁力链`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`newzmz.com/`],target:``}],name:`指定剧集`,maintainers:[`nczitzk`],handler:f,url:`newzmz.com/`,description:"::: tip\n  [雪国列车 (剧版)](https://nzmz.xyz/details-qEzRyY3v.html) 的下载页 URL 为 `https://v.ys99.xyz/view/qEzRyY3v.html`，即剧集 id 为 `qEzRyY3v`\n:::"};async function f(t){let{id:n=`1`,downLinkType:r=`磁力链`}=t.req.param(),a=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):50,d=!Number.isNaN(n),f=new URL(d?`index.html`:`details-${n}.html`,s).href,p=await e.tryGet(f,async()=>{let{data:e}=await i(f);return e}),m=o(p),h=d?await c(e.tryGet,f,n,`div.rowMod`,`ul.slides li a`):[{link:f}];h=await Promise.all(h.slice(0,a).map(t=>l(e.tryGet,t.link))),h=await Promise.all(h.filter(e=>e.link!==`#`).map(e=>u(e,r,`div.team-con-area`,`div.item-label a`,`ul.team-icons li`))),h=h.flat();let g=d?m(`div.rowMod`).eq(Number.parseInt(n,10)).find(`h2.row-header-title`).text():``,_=`${m(`title`).text()}${g?` - ${g}`:``}`,v=m(`link[rel="shortcut icon"]`).prop(`href`);return{item:d?h:h.slice(0,a),title:_,link:f,description:m(`meta[name="description"]`).prop(`content`),language:`zh-cn`,image:m(`img.logo-img`).prop(`src`),icon:v,logo:v,subtitle:m(`meta[name="keywords"]`).prop(`content`),author:_,allowEmpty:!0}}export{d as route};