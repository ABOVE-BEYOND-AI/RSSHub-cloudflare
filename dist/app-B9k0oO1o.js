import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import i from"node:path";import{FetchError as a}from"ofetch";import o from"dayjs";import s from"dayjs/plugin/utc.js";import c from"dayjs/plugin/timezone.js";import l from"dayjs/plugin/advancedFormat.js";const u={path:`/app/:category{.+}?`,categories:[`traditional-media`],example:`/washingtonpost/app/national`,parameters:{category:`Category from the path of the URL of the corresponding site, see below`},features:{requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`App`,maintainers:[`quiniapiezoelectricity`],radar:[{source:[`www.washingtonpost.com/:category`],target:`/app/:category`}],handler:f,description:`::: tip
For example, the category for https://www.washingtonpost.com/national/investigations would be /national/investigations.
:::`};function d(e){let t={};for(let n of e)t[n.id]=t[n.id]?Object.assign(t[n.id],n):n;return Object.values(t)}async function f(u){let f=u.req.param(`category`)??``,p={Accept:`*/*`,Connection:`keep-alive`,"User-Agent":`Classic/6.70.0`};o.extend(s),o.extend(c),o.extend(l),t.defaults.imports.dayjs=o;let m=`https://jsonapp1.washingtonpost.com/fusion_prod/v2/${f}`,h=await r.get(m,{headers:p}),g=h.data.tracking.page_title.includes(`Washington Post`)?h.data.tracking.page_title:`The Washington Post - ${h.data.tracking.page_title}`,_=`https://washingtonpost.com`+h.data.tracking.page_path,v=h.data.regions[0].items.filter(e=>e.items),y=v.flatMap(e=>e.items[0].items.filter(e=>e.is_from_feed===!0).map(e=>{let t={id:e.id,title:e.headline.text,link:e.link.url,pubDate:e.link.display_date,updated:e.link.last_modified};return e.blurbs?.items[0]?.text&&(t.description=e.blurbs?.items[0]?.text),t})),b=d(y),x=await Promise.all(b.map(o=>e.tryGet(o.link,async()=>{let e;try{e=await r(`https://rainbowapi-a.wpdigital.net/rainbow-data-service/rainbow/content-by-url.json?followLinks=false&url=${o.link}`,{headers:p})}catch(e){if(e instanceof a&&e.statusCode===415)return o;throw e}return o.title=e.data.title??o.title,o.author=e.data.items.filter(e=>e.type===`byline`)?.flatMap(e=>e.authors.map(e=>e.name))?.join(`, `)??``,o.description=t(i.join(n,`templates/description-8c76ddeb.art`),{content:e.data.items}),o})));return{title:g,link:_,item:x}}export{u as route};