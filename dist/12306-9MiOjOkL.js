import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{invalid_parameter_default as a}from"./invalid-parameter-CfUmvEUg.js";import o from"node:path";const s=`https://kyfw.12306.cn`;async function c(t){let n=await i({method:`get`,url:t,headers:{UserAgent:e.ua,Referer:`https://www.12306.cn/index/index.html`}});return n.headers[`set-cookie`].join(`,`).match(/JSESSIONID=([^;]+);/)[0]}function l(n){return t.tryGet(n,async()=>{let t=await i({method:`get`,url:`${s}/otn/resources/js/framework/station_name.js`,headers:{UserAgent:e.ua,Referer:`https://kyfw.12306.cn/otn/leftTicket/init`}});return t.data.split(`@`).map(e=>{let t=e.split(`|`);return t.includes(n)?{code:t[2],name:t[1]}:null}).find(Boolean)})}const u={path:`/:date/:from/:to/:type?`,categories:[`travel`],example:`/12306/2022-02-19/重庆/永川东`,parameters:{date:`时间，格式为（YYYY-MM-DD）`,from:`始发站`,to:`终点站`,type:`售票类型，成人和学生可选，默认为成人`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`售票信息`,maintainers:[`Fatpandac`],handler:d};async function d(t){let u=t.req.param(`date`),d=await l(t.req.param(`from`)),f=await l(t.req.param(`to`)),p=t.req.param(`type`)??`ADULT`,m=`${s}/otn/leftTicket/queryA?leftTicketDTO.train_date=${u}&leftTicketDTO.from_station=${d.code}&leftTicketDTO.to_station=${f.code}&purpose_codes=${p}`,h=`${s}/otn/leftTicket/init?linktypeid=dc&fs=${d.code}&ts=${f.code}&date=${u}&flag=N,N,Y`,g=await i.get(m,{headers:{UserAgent:e.ua,Referer:`https://kyfw.12306.cn/otn/leftTicket/init`,Cookie:await c(h)}});if(g.data.data===void 0||g.data.data.length===0)throw new a(`没有找到相关车次，请检查参数是否正确`);let _=g.data.data.result,v=g.data.data.map,y=_.map(e=>{let t=e.split(`|`),i={trainNo:t[3],fromStation:v[t[6]],toStation:v[t[7]],startTime:t[8],arriveTime:t[9],duration:t[10],today:t[11],A9:t[32],M:t[31],O:t[30],A6:t[29],A4:t[28],F:t[27],A3:t[26],A2:t[25],A1:t[24],WZ:t[23],QT:t[22]};return{title:`${i.fromStation} → ${i.toStation} ${i.startTime} ${i.arriveTime}`,description:n(o.join(r,`templates/train-11793805.art`),{trainInfo:i}),link:h,guid:Object.values(i).join(`|`)}});return{title:`${d.name} → ${f.name} ${u}`,link:h,item:y}}export{u as route};