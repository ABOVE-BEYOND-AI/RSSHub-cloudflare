import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{getSubPath as r}from"./common-utils-C27Jp3s6.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{got_default as a}from"./got-BaOFZRd4.js";import{timezone as o}from"./timezone-BrxBCotj.js";import{finishArticleItem as s}from"./wechat-mp-BqaqpHen.js";import{load as c}from"cheerio";const l=async(l,u)=>{let d=r(u).split(`/`).filter(e=>e!==``),[f,p]=d,m=l.pathstartat===void 0?0:l.pathstartat,h=`http://`+p+`.`+f+`.gov.cn`;for(let e=0;e<m;e++){let t=d[e+2];h=h+`/`+t}let g=l.defaultPath,_=l.name_element,v=l.name_match_type,y=l.name_match,b=l.name_join,x=l.list_element,S=l.list_include;if(x===void 0&&(x=`a[href*="content"]`,S=`site`),S===`site`){x=x.split(`,`).filter(e=>e!==``);for(let e=0;e<x.length;e++)x[e]+=`[href*="`+h.slice(7)+`"]`;x=x.join(`,`)}let C=l.title_element,w=l.title_match,T=l.author_element,E=l.author_match,D=l.authorisme,O=l.description_element,k=l.pubDate_element,A=l.pubDate_match,j=l.pubDate_format;d.splice(0,2+m);let M=d.join(`/`);M=M===``?g:M.endsWith(`/`)?M:M+`/`;let N=`${h}/${M}`,P=``,F=``,I=``;if(M.startsWith(`gkmlpt`)){C=void 0,w=void 0,O=`div[class="article-content"]`,k=void 0,A=void 0,j=void 0;let e=await a(`${h}/gkmlpt/api/all/0`);F=D+`政府信息公开平台`,I=e.data.articles.filter(e=>e.url.includes(`content`))}else{let e=await a(N),t=e.data;switch(P=c(t),v){case`name`:F=_;break;case`meta`:_=_.split(`,`).filter(e=>e!==``);for(let e=0;e<_.length;e++)_[e]=P(`meta[name="`+_[e].trim()+`"]`).attr(`content`);F=_.join(b);break;case`element`:_=_.split(`,`).filter(e=>e!==``);for(let e=0;e<_.length;e++)_[e]=P(_[e].trim()).text().match(y)[1];F=_.join(b);break;default:F=P(`head title`).text();break}I=P(x)}let L=I.map((e,t)=>{let n=``;return M.startsWith(`gkmlpt`)?n=e.url:(n=P(t).attr(`href`),n.startsWith(`http`)||(n=n.startsWith(`/`)?`${h}${n}`:`${h}/${n}`)),n}),R=await Promise.all(L.map(r=>{let l=new URL(r);return l.pathname===`/zcjdpt`?e.tryGet(r,async()=>{let e=`https://zcjd.cloud.gd.gov.cn/api/home/article`+l.search,s=await a(e),c=s.data.data;for(let e=0;e<c.jie_du_items.length;e++)c.jie_du_items[e].jd_content=c.jie_du_items[e].jd_content.replaceAll(/((\n {4})|(\n))/g,`</p><p style="font-size: 16px;line-height: 32px;text-indent: 2em;">`);return{link:r,title:c.art_title,description:t(d.join(i,`templates/zcjdpt-2599868d.art`),c),pubDate:o(n(c.pub_time),8),author:/(本|本网|本站)/.test(c.pub_unite)?D:c.pub_unite}}):l.host===`mp.weixin.qq.com`?s({link:r}):e.tryGet(r,async()=>{let{data:e}=await a(r),t=c(e),i=``;i=T===void 0?t(`meta[name="ContentSource"]`).attr(`content`):t(T).text().trim().match(E)[1].trim().replaceAll(/(-*$)/g,``);let s=``;s=k===void 0?t(`meta[name="PubDate"]`).attr(`content`):t(k).text().trim().match(A)[1].trim().replaceAll(/(-*$)/g,``);let l=``;l=C===void 0?t(`meta[name="ArticleTitle"]`).attr(`content`):t(C).text().trim().match(w)[1];let u=O.split(`,`).filter(e=>e!==``);for(let e=0;e<u.length;e++)u[e]=t(u[e].trim()).html();let d=u.join(``);return{link:r,title:l,description:d,pubDate:o(n(s,j),8),author:/本|本网|本站/.test(i)?D:i}})}));return{title:F,link:N,item:R}};export{l as gdgov};