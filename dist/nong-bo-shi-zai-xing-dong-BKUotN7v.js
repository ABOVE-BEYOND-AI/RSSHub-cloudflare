import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import o from"node:path";import{load as s}from"cheerio";const c=`https://web.cmc.hebtv.com/cms/rmt0336/19/19js/st/ds/nmpd/nbszxd/index.shtml`,l={path:`/nbszxd`,categories:[`traditional-media`],example:`/hebtv/nbszxd`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!0,supportPodcast:!0,supportScihub:!1},radar:[{source:[`web.cmc.hebtv.com/cms/rmt0336/19/19js/st/ds/nmpd/nbszxd/index.shtml`]}],name:`农博士在行动`,maintainers:[`iamqiz`,`nczitzk`],handler:u,url:`web.cmc.hebtv.com/cms/rmt0336/19/19js/st/ds/nmpd/nbszxd/index.shtml`};async function u(l){let u=l.req.query(`limit`)?Number.parseInt(l.req.query(`limit`),10):40,d=new URL(`cmsback/api/article/getMyArticleDetail`,`http://api.cmc.hebtv.com`).href,f=await i(c),p=s(f.data),m=p(`.video_box .tv_items`).first().children().toArray().map(e=>{e=p(e);let t=e.find(`a`).first(),r=t.text().match(/\d+/),i=r?r[0]:``;return{title:t.text(),link:`${c}/../${t.attr(`href`)}`,pubDate:i?a(n(i,`YYYYMMDD`),8):null,author:`时间|`+i}}),h=await Promise.all(m.slice(0,u).map(s=>e.tryGet(s.link,async()=>{let{data:e}=await i(s.link),c=e.match(/tenantid = '(\w+)';/)[1],l=s.link.match(/\/nbszxd\/(\d+)/)[1],{data:u}=await i(d,{searchParams:{tenantId:c,articleId:l}}),f=u.data,p;return f.articleContentDto?.videoDtoList?.length>0&&(p=f.articleContentDto?.videoDtoList[0]),s.title=f.title,s.author=f.source,s.guid=`hebtv-nbszxd-${l}`,s.pubDate=a(n(f.publishDate),8),s.updated=a(n(f.modifyTime),8),p&&(s.itunes_item_image=p.poster,s.itunes_duration=f.articleContentDto?.videoEditDtoList[0]?.sourceMediaInfo?.duration,s.enclosure_url=p.formats[0]?.url,s.enclosure_length=f.articleContentDto?.videoEditDtoList[0].sourceMediaInfo?.fileSize,s.enclosure_type=s.enclosure_url?`video/${s.enclosure_url?.split(/\./)?.pop()}`:void 0),s.description=t(o.join(r,`templates/description-676d5a69.art`),{video:p?{src:s.enclosure_url,type:s.enclosure_type,poster:s.itunes_item_image}:void 0}),s}))),g=p(`meta[name="description"]`).prop(`content`),_=g.split(/,/)[0],v=p(`link[rel="shortcut icon"]`).prop(`href`);return{item:h,title:p(`title`).text(),link:c,description:g,language:p(`html`).prop(`lang`),image:p(`div.logo a img`).prop(`src`),icon:v,logo:v,subtitle:p(`meta[name="keywords"]`).prop(`content`),author:_,itunes_author:_,itunes_category:`News`,allowEmpty:!0}}export{l as route};