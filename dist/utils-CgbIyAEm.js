import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import i from"node:path";import a from"@bbob/html";import o from"@bbob/preset-html5";const s=`https://instant.1point3acres.com`,c=`https://api.1point3acres.com`,l={new:`最新帖子`,hot:`热门帖子`},u=e=>e.walk(e=>typeof e==`string`&&e===`
`?{tag:`br`,content:null}:e),d=async(l,d,f)=>{let p=await r({method:`get`,url:d,headers:{referer:s}}),m=await Promise.all(p.data.threads.map(d=>{let p={guid:d.tid,title:d.subject,author:d.author,link:`${s}/thread/${d.tid}`,description:d.summary,pubDate:t((f===``?d.lastpost:d.dateline)*1e3),category:[d.forum_name,...d.tags.map(e=>e.displayname)]};return l(p.link,async()=>{try{let t=await r({method:`get`,url:`${c}/api/v3/threads/${p.guid}`,headers:{referer:s}}),l=t.data.thread,d=o.extend(e=>({...e,attach:(e,{render:t})=>{let n=t(e.content),r=l.attachment_list.find(e=>e.aid===Number.parseInt(n));return r.isimage?{tag:`img`,attrs:{src:r.url}}:{tag:`a`,attrs:{href:`https://www.1point3acres.com/bbs/plugin.php?id=attachcenter:page&aid=${n}`,rel:`noopener`,target:`_blank`},content:`https://www.1point3acres.com/bbs/plugin.php?id=attachcenter:page&aid=${n}`}},url:e=>{let t=Object.keys(e.attrs)[0];if(t.startsWith(`https://link.1p3a.com/?url=`)){let n=decodeURIComponent(t.replace(`https://link.1p3a.com/?url=`,``));return{tag:`a`,attrs:{href:n,rel:`noopener`,target:`_blank`},content:e.content}}return{tag:`a`,attrs:{href:t,rel:`noopener`,target:`_blank`},content:e.content}}}));if(p.description=a(l.message_bbcode,[d(),u]),!l.message_bbcode.includes(`[attach]`)&&l.attachment_list.length>0)for(let t of l.attachment_list)p.description+=t.isimage===1?`<br>`+e(i.join(n,`templates/image-8260a861.art`),{url:t.url,height:t.height,width:t.width}):``}catch{}return p})}));return m};export{d as ProcessThreads,c as apiRootUrl,s as rootUrl,l as types};