import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{art as n}from"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{got_default as a}from"./got-BaOFZRd4.js";import{timezone as o}from"./timezone-BrxBCotj.js";import s from"node:path";import{FetchError as c}from"ofetch";import{load as l}from"cheerio";const u=`3d5_f6A(S$G_FD=2S(Dr6%7BW_h37@rE`,d={path:`/:category?`,categories:[`traditional-media`],example:`/lorientlejour/977-lebanon`,parameters:{category:`Category from the last segment of the URL of the corresponding site, see below for more information, /977-Lebanon by default`},features:{requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1,requireConfig:[{name:`LORIENTLEJOUR_USERNAME`,optional:!0,description:`L'Orient-Le Jour/L'Orient Today Email or Username`},{name:`LORIENTLEJOUR_PASSWORD`,optional:!0,description:`L'Orient-Le Jour/L'Orient Today Password`},{name:`LORIENTLEJOUR_TOKEN`,optional:!0,description:`To obtain a token, log into L'Orient-Le Jour/L'Orient Today App and inspect the connection request to find the token parameter from the request URL`}]},name:`Category`,maintainers:[`quiniapiezoelectricity`],handler:p,description:`  ::: tip
For example, the path for the sites https://today.lorientlejour.com/section/977-lebanon and https://www.lorientlejour.com/rubrique/1-liban would be /lorientlejour/977-lebanon and /lorientlejour/1-liban respectively.
Multiple categories seperated by '|' is also supported, e.g. /lorientlejour/977-lebanon|1-liban.
:::`,radar:[{source:[`www.lorientlejour.com/*/:category`],target:`/:category`},{source:[`www.lorientlejour.com`],target:`/1-Liban`},{source:[`today.lorientlejour.com/*/:category`],target:`/:category`},{source:[`today.lorientlejour.com`],target:`/977-Lebanon`}]};async function f(n){let r=`https://www.lorientlejour.com/cmsapi/categories.php?key=${u}&action=view&categoryId=${n}`,i=await t.tryGet(r,async()=>await a({method:`get`,url:r}),e.cache.routeExpire,!1);return i.data.data[0]}async function p(d){let p=(d.req.param(`category`)??`977-Lebanon`).split(`|`).map(e=>e.match(/^(\d+)/i)[0]??e),m=d.req.query(`limit`)??25,h,g=await t.get(`lorientlejour:token`);if(g)h=g;else if(e.lorientlejour.token)h=e.lorientlejour.token,t.set(`lorientlejour:token`,h);else if(e.lorientlejour.username&&e.lorientlejour.password){let n=`https://www.lorientlejour.com/cmsapi/visitors.php?key=${u}&action=login&loginName=${e.lorientlejour.username}&password=${e.lorientlejour.password}`,r=await a(n);h=r.data.data.token,t.set(`lorientlejour:token`,h)}if(h)try{await a(`https://www.lorientlejour.com/cmsapi/visitors.php?key=${u}&action=login_token&token=${h}`)}catch(e){throw e instanceof c&&e.statusCode===403&&await t.set(`lorientlejour:token`,``),e}let _=`L'Orient Le Jour/L'Orient Today`,v=``,y=`https://www.lorientlejour.com`,b=``;if(p.length===1){let e=await f(p[0]);b=e.typeId.locale?e.typeId.locale:e.typeId.name===`English`?`en-US`:`fr-FR`,_=b===`en-US`?`L'Orient Today - ${e.name}`:`L'Orient Le Jour - ${e.name}`,v=e.description,y=e.url}let x=await Promise.all(p.map(async e=>{let t=await f(e);return t.children.map(e=>e.id)})),S=[...new Set([...p,...x.flat()])],C=`https://www.lorientlejour.com/cmsapi/content.php?text=clean&key=${u}&action=search&category=${encodeURIComponent(JSON.stringify(S))}&limit=${m}&text=false&page=1`;h&&(C+=`&token=${h}`);let w=await a(C),T=w.data.data.map(e=>{e.link=e.url,e.author=e.authors.map(e=>e.name).join(`, `),e.pubDate=o(r(e.firstPublished),3),e.updated=o(r(e.lastUpdate),3),e.category=e.categories.map(e=>e.name);let t=e.contents,a=l(t),c=a(`html`);return c.find(`.inline-embeded-article`).remove(),c.find(`.relatedArticles`).remove(),e.inline_attachments&&c.find(`.inlineImage`).each(function(){let t=a(this).attr(`src`),n=e.inline_attachments.find(e=>e.url===t);n&&n.description&&(a(this).wrap(`<figure></figure>`),a(this).after(`<figcaption>${n.description}</figcaption>`))}),e.description=n(s.join(i,`templates/description-b70dec08.art`),{summary:e.summary,attachments:e.attachments,article:c.html()}),e});return{title:_,description:v,language:b,link:y,item:T}}export{d as route};