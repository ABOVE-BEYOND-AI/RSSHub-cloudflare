import{config as e}from"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as t}from"./cache-C3AIQtoX.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{ofetch_default as r}from"./ofetch-DRl42yaJ.js";import{load as i}from"cheerio";const a={path:`/podcast/:id/:region?`,categories:[`multimedia`],example:`/apple/podcast/id1559695855/cn`,parameters:{id:`播客id，可以在 Apple 播客app 内分享的播客的 URL 中找到`,region:`地區代碼，例如 cn、us、jp，預設為 cn`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`podcasts.apple.com/:region/podcast/:showName/:id`,`podcasts.apple.com/:region/podcast/:id`]}],name:`播客`,maintainers:[`Acring`],handler:o,url:`www.apple.com/apple-podcasts/`};async function o(a){let{id:o,region:s}=a.req.param(),c=o.match(/id(\d+)/)?.[1],l=`https://podcasts.apple.com`,u=`${l}/${s||`cn`}/podcast/${o}`,d=await r(u),f=i(d),p=JSON.parse(f(`#serialized-server-data`).text()),m=p[0].data.shelves.find(e=>e.contentType===`showHeaderRegular`).items[0],h=await t.tryGet(`apple:podcast:bearer`,async()=>{let e=new URL(f(`head script[type="module"]`).attr(`src`),l).href,t=await r(e,{parseResponse:e=>e}),n=t.match(/="(eyJhbGci.*?)",/)[1];return n},e.cache.contentExpire,!1),g=await r(`https://amp-api.podcasts.apple.com/v1/catalog/us/podcasts/${c}/episodes`,{query:{"extend[podcast-channels]":`editorialArtwork,subscriptionArtwork,subscriptionOffers`,include:`channel`,limit:25,with:`entitlements`,l:`en-US`},headers:{Authorization:`Bearer ${h}`,Origin:l}}),_=g.data.map(({attributes:e})=>{let t=e.offers[0];return{title:e.name,enclosure_url:e.assetUrl||t.hlsUrl,enclosure_type:e.assetUrl?`audio/mp4`:`application/vnd.apple.mpegurl`,itunes_duration:(e.durationInMilliseconds||t.durationInMilliseconds)/1e3,link:e.url,pubDate:n(e.releaseDateTime),description:e.description.standard.replaceAll(`
`,`<br>`),author:e.artistName,itunes_item_image:e.artwork.url.replace(/\{w\}x\{h\}(?:\{c\}|bb)\.\{f\}/,`3000x3000bb.webp`),category:e.genreNames}}),v=g.data.find(e=>e.type===`podcast-episodes`).relationships.channel.data.find(e=>e.type===`podcast-channels`).attributes;return{title:v.name,link:v.url,itunes_author:m.contextAction.podcastOffer.author,item:_,description:(m.description||v.description.standard).replaceAll(`
`,` `),image:(v.logoArtwork||v.subscriptionArtwork).url.replace(/\{w\}x\{h\}(?:\{c\}|bb)\.\{f\}/,`3000x3000bb.webp`),itunes_category:m.metadata.find(e=>Object.hasOwn(e,`category`)).category?.title||m.metadata.find(e=>Object.hasOwn(e,`category`)).category}}export{a as route};