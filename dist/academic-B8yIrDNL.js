import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import o from"node:path";import{load as s}from"cheerio";const c=async c=>{let{id:l=`1`}=c.req.param(),u=c.req.query(`limit`)?Number.parseInt(c.req.query(`limit`),10):10,d=`https://www.eshukan.com`,f=new URL(`academic/index.aspx?cid=${l}`,d).href,{data:p}=await i(f),m=s(p),h=m(`ul.article li`).slice(0,u).toArray().map(e=>{e=m(e);let i=e.find(`a`),s=i.contents().last().text(),c=e.find(`p span`).text().match(/(\d{4}\/\d{2}\/\d{2}\s\d{2}:\d{2}:\d{2})/)?.[1];e.find(`p span`).remove();let l=t(o.join(r,`templates/description-f29cc099.art`),{intro:e.find(`p`).text()});return{title:s,description:l,pubDate:c?a(n(c),8):void 0,link:new URL(i.prop(`href`),f).href,content:{html:l,text:e.find(`p`).text()}}});h=await Promise.all(h.map(c=>e.tryGet(c.link,async()=>{let{data:e}=await i(c.link),l=s(e),u=l(`h1`).text(),d=t(o.join(r,`templates/description-f29cc099.art`),{intro:l(`div.summary`).html(),description:l(`div.detail`).html()}),f=l(`div.author`).text().match(/(\d{4}\/\d{2}\/\d{2}\s\d{2}:\d{2}:\d{2})/)?.[1];return c.title=u,c.description=d,c.pubDate=f?a(n(f),8):c.pubDate,c.author=l(`div.author a`).text(),c.content={html:d,text:l(`div.detail`).text()},c})));let g=m(`title`).text(),_=new URL(m(`div.logo img`).prop(`src`),d).href;return{title:g,description:m(`meta[name="description"]`).prop(`content`),link:f,item:h,allowEmpty:!0,image:_,author:g.split(/_/).pop()}},l={path:`/academic/:id?`,name:`学术资讯`,url:`www.eshukan.com`,maintainers:[`nczitzk`],handler:c,example:`/eshukan/academic/1`,parameters:{category:"栏目 id，默认为 `1`，即期刊动态，可在对应栏目页 URL 中找到"},description:"::: tip\n  若订阅 [期刊动态](https://www.eshukan.com/academic/index.aspx?cid=1)，网址为 `https://www.eshukan.com/academic/index.aspx?cid=1`。截取 `https://www.eshukan.com/academic/index.aspx?cid=` 到末尾的部分 `1` 作为参数填入，此时路由为 [`/eshukan/academic/1`](https://rsshub.app/eshukan/academic/1)。\n:::\n    ",categories:[`study`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.eshukan.com/academic/index.aspx`],target:(e,t)=>{t=new URL(t);let n=t.searchParams.get(`id`);return`/academic${n?`/${n}`:``}`}}]};export{c as handler,l as route};