import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import{load as o}from"cheerio";const s=`https://chn.oversea.cnki.net`,c={path:`/journals/debut/:name`,categories:[`journal`],example:`/cnki/journals/debut/LKGP`,parameters:{name:`期刊缩写，可以在网址中得到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`navi.cnki.net/knavi/journals/:name/detail`]}],name:`网络首发`,maintainers:[`Fatpandac`],handler:l};async function l(c){let l=c.req.param(`name`),u=`${s}/knavi/JournalDetail?pcode=CjFD&pykm=${l}`,d=await i.get(u).then(e=>o(e.data)(`head > title`).text()),f=`${s}/knavi/JournalDetail/GetnfAllOutline`,p=await i({method:`post`,url:f,form:{pageIdx:`0`,type:`2`,pcode:`CJFD`,pykm:l}}),m=o(p.data),h=m(`dd`).toArray().map(e=>({title:m(e).find(`span.name > a`).text().trim(),link:`${s}/kcms/detail/${new URLSearchParams(new URL(`${s}/${m(e).find(`span.name > a`).attr(`href`)}`).search).get(`url`)}.html`,pubDate:n(m(e).find(`span.company`).text(),`YYYY-MM-DD HH:mm:ss`)})),g=await Promise.all(h.map(n=>e.tryGet(n.link,async()=>{let e=await i.get(n.link),s=o(e.data);return n.description=t(a.join(r,`templates/desc-ffba0d62.art`),{author:s(`h3.author > span`).toArray().map(e=>s(e).text()).join(` `),company:s(`a.author`).toArray().map(e=>s(e).text()).join(` `),content:s(`div.row > span.abstract-text`).parent().text()}),n})));return{title:`${d} - 全网首发`,link:`https://navi.cnki.net/knavi/journals/${l}/detail`,item:g}}export{c as route};