import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{ofetch_default as n}from"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{ViewType as i}from"./types-D9T3SQ-7.js";import a from"node:path";import o from"dayjs";import s from"dayjs/plugin/localizedFormat.js";import"dayjs/locale/zh-cn.js";import c from"dayjs/plugin/utc.js";import l from"dayjs/plugin/timezone.js";o.extend(s),o.extend(l),o.extend(c);const u=async()=>{let e=await n(`https://m.mi.com/v1/crowd/crowd_home`,{headers:{referrer:`https://m.mi.com/`},method:`POST`});return e.data.list},d=t=>e.tryGet(`mi:crowdfunding:${t.project_id}`,async()=>{let e=await n(`https://m.mi.com/v1/crowd/crowd_detail`,{headers:{referrer:`https://m.mi.com/crowdfunding/home`},method:`POST`,query:{project_id:t.project_id}});return e.data.crowd_funding_info.product_market_price===void 0&&(e.data.crowd_funding_info.product_market_price=t.product_market_price),e.data.crowd_funding_info.start_time_desc===void 0&&(e.data.crowd_funding_info.start_time_desc=p(e.data.crowd_funding_info.start_time)),e.data.crowd_funding_info.end_time_desc===void 0&&(e.data.crowd_funding_info.end_time_desc=p(e.data.crowd_funding_info.end_time)),e.data.crowd_funding_info}),f=e=>t(a.join(r,`templates/crowdfunding-a2440baa.art`),e),p=e=>o.unix(e).tz(`Asia/Shanghai`).locale(`zh-cn`).format(`lll`);var m={getCrowdfundingList:u,getCrowdfundingItem:d,renderCrowdfunding:f};const h={path:`/crowdfunding`,categories:[`shopping`],example:`/mi/crowdfunding`,name:`小米众筹`,maintainers:[`DIYgod`,`nuomi1`],handler:v,features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`m.mi.com/crowdfunding/home`],target:`/crowdfunding`}],view:i.Notifications},g=async e=>{let t=e.flatMap(e=>e.items.map(e=>m.getCrowdfundingItem(e)));return await Promise.all(t)},_=e=>({title:e.project_name,description:m.renderCrowdfunding(e),link:`https://m.mi.com/crowdfunding/proddetail/${e.project_id}`,image:e.big_image,language:`zh-cn`});async function v(){let e=await m.getCrowdfundingList(),t=await g(e),n=t.map(e=>_(e));return{title:`小米众筹`,link:`https://m.mi.com/crowdfunding/home`,item:n,allowEmpty:!0,image:`https://m.mi.com/static/img/icons/apple-touch-icon-152x152.png`,language:`zh-cn`}}export{h as route};