import{art as e}from"./render-DE4LRFBD.js";import{__dirname as t}from"./esm-shims-BDPl6Msv.js";import{invalid_parameter_default as n}from"./invalid-parameter-CfUmvEUg.js";import r from"node:path";import i from"query-string";import{GenreNotation as a,NarouNovelFetch as o,R18Site as s,SearchBuilder as c,SearchBuilderR18 as l}from"narou";let u=function(e){return e.YOMOU=`yomou`,e.NOCTURNE=`noc`,e.MOONLIGHT=`mnlt`,e.MIDNIGHT=`mid`,e}({});const d={[u.YOMOU]:`小説を読もう`,[u.NOCTURNE]:`ノクターン`,[u.MOONLIGHT]:`ムーンライト`,[u.MIDNIGHT]:`ミッドナイト`},f={path:`/search/:sub/:query`,categories:[`reading`],example:`/syosetu/search/noc/word=ハーレム&notword=&type=r&mintime=&maxtime=&minlen=30000&maxlen=&min_globalpoint=&max_globalpoint=&minlastup=&maxlastup=&minfirstup=&maxfirstup=&isgl=1&notbl=1&order=new?limit=5`,parameters:{sub:{description:`The target Syosetu subsite.`,options:Object.entries(u).map(([,e])=>({value:e,label:d[e]}))},query:`Search parameters in Syosetu format.`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Search`,maintainers:[`SnowAgar25`],handler:_},p=e=>e??void 0;function m(e,t){let n=i.parse(e),r={gzip:5,lim:t};return r.word=p(n.word),r.notword=p(n.notword),r.title=p(n.title),r.ex=p(n.ex),r.keyword=p(n.keyword),r.wname=p(n.wname),r.sasie=p(n.sasie),r.iszankoku=p(n.iszankoku),r.isbl=p(n.isbl),r.isgl=p(n.isgl),r.istensei=p(n.istensei),r.istenni=p(n.istenni),r.stop=p(n.stop),r.notzankoku=p(n.notzankoku),r.notbl=p(n.notbl),r.notgl=p(n.notgl),r.nottensei=p(n.nottensei),r.nottenni=p(n.nottenni),r.minlen=p(n.minlen),r.maxlen=p(n.maxlen),r.type=p(n.type),r.order=p(n.order),r.genre=p(n.genre),r.nocgenre=p(n.nocgenre),(n.mintime||n.maxtime)&&(r.time=`${n.mintime||``}-${n.maxtime||``}`),r}const h=e=>e===u.YOMOU;function g(e,t){if(h(e))return new c(t,new o);let r={...t};switch(e){case u.NOCTURNE:r.nocgenre=s.Nocturne;break;case u.MOONLIGHT:r.nocgenre||(r.nocgenre=[s.MoonLight,s.MoonLightBL].join(`-`));break;case u.MIDNIGHT:r.nocgenre=s.Midnight;break;default:throw new n(`Invalid Syosetu subsite.
Valid subsites are: yomou, noc, mnlt, mid`)}return new l(r,new o)}async function _(n){let{sub:i,query:o}=n.req.param(),s=`https://${i}.syosetu.com/search/search/search.php?${o}`,c=Math.min(Number(n.req.query(`limit`)??40),40),l=m(o,c),u=g(i,l),d=await u.execute(),f=d.values.map(n=>({title:n.title,link:`https://${h(i)?`ncode`:`novel18`}.syosetu.com/${String(n.ncode).toLowerCase()}`,description:e(r.join(t,`templates/description-e1f33e28.art`),{novel:n,genreText:a[n.genre]}),author:n.writer,category:n.keyword.split(/[\s/\uFF0F]/).filter(Boolean)})),p=[];return l.word&&p.push(l.word),l.notword&&p.push(`-${l.notword}`),{title:p.length>0?`Syosetu Search: ${p.join(` `)}`:`Syosetu Search`,link:s,item:f}}export{f as route};