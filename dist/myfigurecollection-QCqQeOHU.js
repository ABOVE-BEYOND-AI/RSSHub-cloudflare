import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import{invalid_parameter_default as i}from"./invalid-parameter-CfUmvEUg.js";import{isValidHost as a}from"./valid-host-JqD2S4D4.js";import o from"node:path";import{load as s}from"cheerio";const c={potd:`picture/browse/potd/`,potw:`picture/browse/potw/`,potm:`picture/browse/potm/`},l={path:`/:category?/:language?`,categories:[`shopping`],example:`/myfigurecollection/potd`,parameters:{category:`分类，默认为每日圖片`,language:"语言，见上表，默认为空，即 `en`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`zh.myfigurecollection.net/browse`,`zh.myfigurecollection.net/`]}],name:`圖片`,maintainers:[`nczitzk`],handler:u,url:`zh.myfigurecollection.net/browse`,description:`| 每日圖片 | 每週圖片 | 每月圖片 |
| -------- | -------- | -------- |
| potd     | potw     | potm     |`};async function u(l){let u=l.req.param(`language`)??``,d=l.req.param(`category`)??`figure`;if(u&&!a(u))throw new i(`Invalid language`);let f=`https://${u===`en`||u===``?``:`${u}.`}myfigurecollection.net`,p=`${f}/${Object.hasOwn(c,d)?c[d]:d}`,m=await r({method:`get`,url:p}),h=s(m.data),g=h(`.item-icon, .picture-icon`).slice(0,l.req.query(`limit`)?Number.parseInt(l.req.query(`limit`)):25).toArray().map(e=>{e=h(e).find(`a`);let t=e.attr(`href`);return{link:t.startsWith(`http`)?t:`${f}${t}`}});return g=await Promise.all(g.map(i=>e.tryGet(i.link,async()=>{try{let e=await r({method:`get`,url:i.link}),a=s(e.data);i.title=a(`.headline`).text(),i.description=t(o.join(n,`templates/description-49fdbaa3.art`),{pictures:/myfigurecollection\.net\/picture\//.test(i.link)?[{src:a(`meta[property="og:image"]`).attr(`content`)}]:JSON.parse(decodeURIComponent(a(`meta[name="pictures"]`).attr(`content`))),fields:a(`.form-field`).toArray().map(e=>({key:a(e).find(`.form-label`).text(),value:a(e).find(`.form-input`).text()}))})}catch{i.title=`Item #${i.link.split(`/`).pop()}`}return i}))),{title:h(`title`).text().replace(/ \(.*\)/,``),link:p,item:g}}export{l as route};