import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as e}from"./render-DE4LRFBD.js";import"./ofetch-DRl42yaJ.js";import{__dirname as t}from"./esm-shims-BDPl6Msv.js";import{got_default as n}from"./got-BaOFZRd4.js";import r from"node:path";import i from"dayjs";import a from"dayjs/plugin/customParseFormat.js";import o from"node:crypto";import{load as s}from"cheerio";import c from"city-timezones";import l from"dayjs/plugin/utc.js";import u from"dayjs/plugin/timezone.js";i.extend(a),i.extend(l),i.extend(u);const d={expandOdd:e=>{e.prototype.odd=function(){let t=[];return this.each((e,n)=>{e%2==1&&t.push(n)}),e(t)}},expandEven:e=>{e.prototype.even=function(){let t=[];return this.each((e,n)=>{e%2==0&&t.push(n)}),e(t)}},expandReverse:e=>{e.prototype.reverse=function(){let t=[];return this.each((e,n)=>{t.push(n)}),t.reverse(),e(t)}},generateGuid:e=>{let t=o.createHash(`sha512`);t.update(e);let n=t.digest(`hex`).toUpperCase();return n},parseDatetime:(e,t,n,r,a)=>{let o=`YYYY/MM/DD`,s=`YYYY/MM/DD HH:mm`,l=`MM/DD/YYYY`,u=`MM/DD/YYYY HH:mm`,d;switch(a){case`ja`:d=i(e,o,!0).isValid()?o:i(e,s,!0).isValid()?s:void 0;break;case`en`:d=i(e,l,!0).isValid()?l:i(e,u,!0).isValid()?u:void 0;break}if(t){let e=[[`郵便局`],[`都`,`道`,`府`,`県`]];if(e[0].some(e=>t.includes(e))||e[1].some(e=>n.includes(e)))r=`Asia/Tokyo`;else{let e=t.replace(` EMS`,``).replace(` INT`,``);try{try{r=c.lookupViaCity(e)[0].timezone}catch{r=c.lookupViaCity(n)[0].timezone}}catch{}}}return d?[i.tz(e,d,r).valueOf(),r]:[new Date(e).getTime(),r]}};var f=d;let p=`日本郵便`;async function m(i){let a=i.req.param(`reqCode`),o=`reqCodeNo1=`+a,c=`ja`;i.req.param(`locale`)===`en`&&(c=`en`,p=`Japanpost`);let l=`&locale=`+c,u=`https://trackings.post.japanpost.jp/services/srv/search/direct?`+o+l,d=await n({method:`get`,url:u}),m=s(d.data);f.expandEven(m),f.expandOdd(m);let h=m(`.tableType01`).eq(1).find(`tr`).slice(2),g=m(`.tableType03`).eq(0).find(`tr`).slice(1),_;if(g.length&&(_=g.toArray().map(e=>{let t=m(e).find(`td`);return{officeType:t.eq(0).text().trim(),officeName:t.eq(1).html().trim(),officeTel:t.eq(2).html().trim()}})),!h.length){let e=m(`.tableType01`).eq(0).find(`tr`).eq(2).find(`td`).eq(1).text().trim();throw Error(e)}let v=h.even(),y=h.odd(),b=m(`.tableType01`).eq(0).find(`tr`).eq(1).find(`td`).eq(1).text().trim(),x=m(`.tableType01`).eq(0).find(`tr`).eq(1).find(`td`).eq(2).text().trim(),S=c===`ja`?`付加サービス：`:`Additional services: `,C,w;return{title:`${p} ${a} ${b}`,link:u,description:`${p} ${a} ${b}`,language:c,icon:`https://www.post.japanpost.jp/favicon.ico`,logo:`https://www.post.japanpost.jp/favicon.ico`,item:v.toArray().map((n,i)=>{let o=m(n).find(`td`),s=o.eq(1).text().trim(),l=o.eq(4).text().trim(),d=o.eq(3).text().trim(),p=y.eq(i).find(`td`).eq(0).text().trim(),h=`${s} ${d} ${l}`,g=o.eq(2).text().trim(),v=e(r.join(t,`templates/track_item_desc-8ae6c583.art`),{packageStatus:s,packageTrackRecord:g,packageOfficeZipCode:p,packageOffice:d,packageRegion:l,index:i,officeItemList:_,serviceText:S,packageService:x}),b=o.eq(0).text().trim(),T=f.generateGuid(a+h+v+b),E;return[E,w]=f.parseDatetime(b,d,l,w,c),C&&E<=C&&(E=C+1e3),C=E,{title:h,description:v,pubDate:new Date(E),link:u,guid:T.slice(0,32)}})}}const h={name:`Track & Trace Service`,path:`/track/:reqCode/:locale?`,example:`/japanpost/track/EJ123456789JP/en`,url:`trackings.post.japanpost.jp/services/srv/search/`,handler:m,categories:[`other`],maintainers:[`tuzi3040`],parameters:{reqCode:`Package Number`,locale:"Language, default to japanese `ja`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},description:`| Japanese | English |
| -------- | ------- |
| ja       | en      |`,zh:{name:`邮件追踪查询`,description:`| 日语 | 英语 |
| ---- | ---- |
| ja   | en   |`},ja:{name:`郵便追跡サービス`,description:`| 日本語 | 英語 |
| ---- | ---- |
| ja   | en   |`}};export{h as route};