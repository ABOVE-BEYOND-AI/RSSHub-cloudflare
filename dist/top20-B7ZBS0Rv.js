import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n,parseRelativeDate as r}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as i}from"./esm-shims-BDPl6Msv.js";import{got_default as a}from"./got-BaOFZRd4.js";import o from"node:path";import{load as s}from"cheerio";const c=e=>t(o.join(i,`templates/description-4270576b.art`),{content:e});t.defaults.imports.parseContent=c;const l={path:`/top20`,categories:[`blog`],example:`/zhubai/top20`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`analy.zhubai.love/`]}],name:`上周热门 TOP 20`,maintainers:[`nczitzk`],handler:u,url:`analy.zhubai.love/`};async function u(t){let i=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):20,o=`http://analy.zhubai.wiki`,l=new URL(`a/zb/s/ht/pl/wk`,`https://open.zhubai.wiki`).href,{data:u}=await a.post(l),d=u.data.slice(0,i).map(e=>({title:e.pn,link:e.pu??e.pq??e.fp,description:e.pa,author:e.zn,pubDate:r(e.lu.replace(/\.\d+/,``))}));d=await Promise.all(d.map(t=>e.tryGet(t.link,async()=>{let e=t.link.match(/\/(?:pl|pq|fp)\/([\w-]+)\/(\d+)/),{data:r}=await a(`https://${e[1]}.zhubai.love/api/posts/${e[2]}`);return t.title=r.title??t.title,t.description=r.content?c(JSON.parse(r.content)):t.description,t.author=r.author?.name??t.author,t.pubDate=r.created_at?n(r.created_at):t.pubDate,t})));let{data:f}=await a(o),p=s(f),m=p(`link[rel="apple-touch-icon"]`).prop(`href`);return{item:d,title:`${p(`meta[property="og:title"]`).prop(`content`)} - TOP20`,link:o,description:p(`meta[property="og:description"]`).prop(`content`),language:p(`html`).prop(`lang`),image:p(`meta[property="og:image"]`).prop(`content`),icon:m,logo:m,subtitle:p(`meta[property="og:description"]`).prop(`content`),author:p(`meta[name="twitter:site"]`).prop(`content`)}}export{l as route};