import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{art as e}from"./render-DE4LRFBD.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as n}from"./esm-shims-BDPl6Msv.js";import{got_default as r}from"./got-BaOFZRd4.js";import{timezone as i}from"./timezone-BrxBCotj.js";import a from"node:path";import{load as o}from"cheerio";const s=`wp-json/wp/v2`,c={search:`s`},l={category:`categories`,tag:`tags`,search:void 0},u=new Set([`search`]),d=(e,t,n=!1)=>{let r=(e,i)=>{let a=Object.keys(e).filter(t=>e[t]?.length>0&&(n?Object.hasOwn(l,t):Object.hasOwn(c,t)));if(a.length===0)return i;let o=a[0],s=e[o],u={...e};delete u[o];let d=g(o,n),f=s.map(e=>Object.hasOwn(e,t)?e[t]:e);return d&&i.append(d,f.join(`,`)),r(u,i)};return r(e,new URLSearchParams)},f=async(e,t)=>{let n=async(e,r)=>{if(r.length===0)return[];let[i,...a]=r,o=await h(e,i,t);return[...o?.id&&o?.slug?[{id:o.id,name:o.name,slug:o.slug}]:[],...await n(e,a)]},r=async(e,t)=>{let i=Object.keys(e);if(i.length===0)return t;let a=i[0],o=e[a],s={...e};return delete s[a],r(s,{...t,[a]:u.has(a)?o:await n(a,o)})};return await r(e,{})},p=(e,t,n=new URLSearchParams)=>{let r=n.toString(),i=r?`?${r}`:``;return`${t}/${e}${i}`},m=async(e,t)=>{let n=async e=>{if(e.length===0)return;let[t,...i]=e;try{let{data:e}=await r.get(t);return e}catch{return n(i)}},i=await n([e,t]);if(!i)return{};let a=o(i),s=a(`title`).first().text(),c=new URL(`wp-content/uploads/site_logo.png`,t).href;return{title:s,description:a(`meta[property="og:description"]`).attr(`content`)||a(`meta[name="description"]`).attr(`content`),link:e,allowEmpty:!0,image:c,author:a(`meta[property="og:site_name"]`).attr(`content`),language:a(`html`).attr(`lang`)}},h=async(e,t,n)=>{let i=`${n}/${s}/${g(e,!0)}`,{data:a}=await r(i,{searchParams:{search:t}});return a.length>0?a[0]:void 0},g=(e,t=!1)=>{let n=t?l:c;return Object.hasOwn(n,e)?n[e]??e:void 0},_=e=>{let t=Object.keys(e).filter(t=>e[t].length>0&&!Object.hasOwn(c,t));if(t.length===0)return;let n=t[0];return e[n].map(e=>e.slug).join(`/`)},v=e=>{let t=(e,n={},r)=>{if(!e)return n;let[i,...a]=e.split(/\/|,/),o=Object.hasOwn(l,i),s=o?i:r,c=s?{...n,[s]:[...n[s]||[],...o?[]:[i]]}:n;return t(a.join(`/`),c,s)};return t(e,{})},y=async c=>{let{filter:l}=c.req.param(),u=c.req.query(`limit`)?Number.parseInt(c.req.query(`limit`),10):40,h=`https://the.bi/s`,g=v(l),y=await f(g,h),b=d(g,`name`,!1),x=d(y,`id`,!0);x.append(`_embed`,`true`),x.append(`per_page`,String(u)),x.append(`page`,`1`);let S=p(`${s}/posts`,h,x),C=p(_(y)??``,h,b),{data:w}=await r(S),T=w.slice(0,u).map(r=>{let s=r._embedded[`wp:term`],c=r.guid?.rendered??r.guid,l=o(r.content?.rendered??r.content),u=l(`a[id='publication']`).text(),d=l(`img#poster`).prop(`data-srcset`);l(`figure.graf`).each((t,r)=>{r=l(r);let i=r.find(`img`);r.replaceWith(e(a.join(n,`templates/description-c3c936c5.art`),{images:i?[{src:i.prop(`src`),width:i.prop(`width`),height:i.prop(`height`)}]:void 0}))});let f=l(`h1`).text(),p=l(`h2`).text();l(`h1`).parent().remove();let m=e(a.join(n,`templates/description-c3c936c5.art`),{images:d?[{src:d}]:void 0,intro:p,description:l.html()});return{title:r.title?.rendered??r.title??f,description:m,pubDate:i(t(r.date_gmt),0),updated:i(t(r.modified_gmt),0),link:r.link,category:[...new Set(s.flat().map(e=>e.name))],author:[...r._embedded.author,{name:u}],guid:c,id:c,content:{html:m,text:l.text()}}}),E=await m(C,h);return{...E,item:T}},b={path:`/:filter{.+}?`,name:`分类`,url:`the.bi`,maintainers:[`nczitzk`],handler:y,example:`/the`,parameters:{filter:`过滤器，见下方描述`},description:`::: tip
  如果你想订阅特定类别或标签，可以在路由中填写 filter 参数。\`/category/rawmw7dsta2jew\` 可以实现订阅 [剩余价值](https://the.bi/s/rawmw7dsta2jew) 类别。此时，路由是 [\`/the/category/rawmw7dsta2jew/\`](https://rsshub.app/the/category/rawmw7dsta2jew).

  你还可以订阅多个类别。\`/category/rawmw7dsta2jew,rawbcvxkktdkq8/\` 可以实现同时订阅 [剩余价值](https://the.bi/s/rawmw7dsta2jew) 和 [打江山](https://the.bi/s/rawbcvxkktdkq8) 两个类别。此时，路由是 [\`/the/category/rawmw7dsta2jew,rawbcvxkktdkq8\`](https://rsshub.app/the/category/rawmw7dsta2jew,rawbcvxkktdkq8).

  类别和标签也可以合并订阅。\`/category/rawmw7dsta2jew/tag/raweekl3na8trq\` 订阅 [剩余价值](https://the.bi/s/rawmw7dsta2jew) 类别和 [动物](https://the.bi/s/raweekl3na8trq) 标签。此时，路由是 [\`/the/category/rawmw7dsta2jew/tag/raweekl3na8trq\`](https://rsshub.app/the/category/rawmw7dsta2jew/tag/raweekl3na8trq).

  你还可以搜索关键字。\`/search/中国\` 搜索关键字 [中国](https://the.bi/s/?s=中国)。在这种情况下，路径是 [\`/the/search/中国\`](https://rsshub.app/the/search/中国).
:::

| 分类                                           | ID                                                               |
| ---------------------------------------------- | ---------------------------------------------------------------- |
| [时局图](https://the.bi/s/rawj7o4ypewv94)      | [rawj7o4ypewv94](https://rsshub.app/the/category/rawj7o4ypewv94) |
| [剩余价值](https://the.bi/s/rawmw7dsta2jew)    | [rawmw7dsta2jew](https://rsshub.app/the/category/rawmw7dsta2jew) |
| [打江山](https://the.bi/s/rawbcvxkktdkq8)      | [rawbcvxkktdkq8](https://rsshub.app/the/category/rawbcvxkktdkq8) |
| [中国经济](https://the.bi/s/raw4krvx85dh27)    | [raw4krvx85dh27](https://rsshub.app/the/category/raw4krvx85dh27) |
| [水深火热](https://the.bi/s/rawtn8jpsc6uvv)    | [rawtn8jpsc6uvv](https://rsshub.app/the/category/rawtn8jpsc6uvv) |
| [东升西降](https://the.bi/s/rawai5kd4z15il)    | [rawai5kd4z15il](https://rsshub.app/the/category/rawai5kd4z15il) |
| [大局 & 大棋](https://the.bi/s/raw2efkzejrsx8) | [raw2efkzejrsx8](https://rsshub.app/the/category/raw2efkzejrsx8) |
| [境外势力](https://the.bi/s/rawmpalhnlphuc)    | [rawmpalhnlphuc](https://rsshub.app/the/category/rawmpalhnlphuc) |
| [副刊](https://the.bi/s/rawxght2jr2u5z)        | [rawxght2jr2u5z](https://rsshub.app/the/category/rawxght2jr2u5z) |
| [天高地厚](https://the.bi/s/rawrsnh9zakqdx)    | [rawrsnh9zakqdx](https://rsshub.app/the/category/rawrsnh9zakqdx) |
| [Oyster](https://the.bi/s/rawdhl9hugdfn9)      | [rawdhl9hugdfn9](https://rsshub.app/the/category/rawdhl9hugdfn9) |
  `,categories:[`new-media`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`the.bi/s/:category?`],target:e=>{let t=e.category;return`/the${t?`/category/${t}`:``}`}},{title:`时局图`,source:[`the.bi/s/rawj7o4ypewv94`],target:`/category/rawj7o4ypewv94`},{title:`剩余价值`,source:[`the.bi/s/rawmw7dsta2jew`],target:`/category/rawmw7dsta2jew`},{title:`打江山`,source:[`the.bi/s/rawbcvxkktdkq8`],target:`/category/rawbcvxkktdkq8`},{title:`中国经济`,source:[`the.bi/s/raw4krvx85dh27`],target:`/category/raw4krvx85dh27`},{title:`水深火热`,source:[`the.bi/s/rawtn8jpsc6uvv`],target:`/category/rawtn8jpsc6uvv`},{title:`东升西降`,source:[`the.bi/s/rawai5kd4z15il`],target:`/category/rawai5kd4z15il`},{title:`大局 & 大棋`,source:[`the.bi/s/raw2efkzejrsx8`],target:`/category/raw2efkzejrsx8`},{title:`境外势力`,source:[`the.bi/s/rawmpalhnlphuc`],target:`/category/rawmpalhnlphuc`},{title:`副刊`,source:[`the.bi/s/rawxght2jr2u5z`],target:`/category/rawxght2jr2u5z`},{title:`天高地厚`,source:[`the.bi/s/rawrsnh9zakqdx`],target:`/category/rawrsnh9zakqdx`},{title:`Oyster`,source:[`the.bi/s/rawdhl9hugdfn9`],target:`/category/rawdhl9hugdfn9`}]};export{y as handler,b as route};