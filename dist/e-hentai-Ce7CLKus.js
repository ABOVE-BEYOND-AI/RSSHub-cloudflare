import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import a from"node:path";import{load as o}from"cheerio";const s={path:`/:what?/:id?/:needTorrents?/:needImages?`,name:`Unknown`,maintainers:[],features:{nsfw:!0},handler:c};async function c(s){let c=s.req.param(`id`)??``,l=s.req.param(`what`)??``,u=/t|y/i.test(s.req.param(`needTorrents`)??`true`),d=/t|y/i.test(s.req.param(`needImages`)??`true`),f=`https://e-hentai.org/${c?l===`search`?`?${c}`:l===`category`?c:`${l}/${c}`:l}`,p=await i({method:`get`,url:f}),m=o(p.data);m(`.itd`).parent().remove();let h=m(`table.gltc tbody tr`).slice(1,s.req.query(`limit`)?Number.parseInt(s.req.query(`limit`))+1:d?16:26).toArray().map(e=>(e=m(e),{title:e.find(`div.glink`).text(),author:e.find(`td.glhide div a`).text(),link:e.find(`td.glname a`).attr(`href`),pubDate:n(e.find(`div.ir`).prev().text()),category:e.find(`div.gt`).toArray().map(e=>m(e).attr(`title`).replace(/^:/,``)),description:d?``:`<img src="${e.find(`div.glthumb div img`).attr(`data-src`)??e.find(`div.glthumb div img`).attr(`src`)}">`,enclosure_url:u&&e.find(`div.gldown a img[title="Show torrents"]`).length>0?e.find(`.gldown a`).attr(`href`):void 0}));return h=await Promise.all(h.map(async n=>{if(n.enclosure_url){let t=``,r=await e.get(n.enclosure_url);if(!r){let a=await i({method:`get`,url:n.enclosure_url}),s=o(a.data);s(`h1, input[name="torrent_info"]`).remove(),t=s(`form`).parent().html(),r=s(`table tbody tr td a`).toArray().map(e=>(e=s(e),{link:e.attr(`href`),title:e.text()})),e.set(n.enclosure_url,r)}n.description+=t,n.enclosure_url=r[0].link,n.enclosure_type=`application/x-bittorrent`}if(d){let s=await e.get(n.link);if(!s){let t=await i({method:`get`,url:n.link}),r=o(t.data);s=await Promise.all(r(`.gdtm a`).toArray().map(t=>e.tryGet(r(t).attr(`href`),async()=>{let e=await i({method:`get`,url:r(t).attr(`href`)}),n=o(e.data);return n(`#img`).attr(`src`)}))),e.set(n.link,s)}n.description+=t(a.join(r,`templates/images-c6c5dab2.art`),{images:s})}return n})),{title:`${c||l||`Front Page`} - E-Hentai Galleries`,link:f,item:h}}export{s as route};