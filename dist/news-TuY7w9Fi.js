import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import"./timezone-BrxBCotj.js";import{domain as a,getMeta as o,processItems as s,processMeta as c}from"./util-Dd__-ucA.js";import l from"node:path";import{load as u}from"cheerio";const d={path:`/news/:category{.+}?`,categories:[`university`],example:`/whu/news`,parameters:{category:`新闻栏目，可选`},name:`新闻网`,maintainers:[],handler:p,description:"\ncategory 参数可选，范围如下:\n\n| 新闻栏目 | 武大资讯 | 学术动态 | 珞珈影像 | 武大视频 |\n| -------- | -------- | -------- | -------- | -------- |\n| 参数     |  0 或 `wdzx/wdyw`  | 1 或 `kydt` | 2 或 `stkj/ljyx` | 3 或 `stkj/wdsp` |\n\n此外 route 后可以加上 `?limit=n` 的查询参数，表示只获取前 n 条新闻；如果不指定默认为 10。\n"},f=e=>{let t=[`wdzx/wdyw`,`kydt`,`stkj/ljyx`,`stkj/wdsp`];return[`0`,`1`,`2`,`3`].includes(e)?t[e]:t.includes(e)?e:`wdzx/wdyw`};async function p(d){let{category:p}=d.req.param(),m=d.req.query(`limit`)?Number.parseInt(d.req.query(`limit`),10):10;p=f(p);let h=`https://news.${a}`,g=new URL(`${p}.htm`,h).href,{data:_}=await i(g),v=u(_),y=v(`ul.wdzxList li a[title], ul.xsdtList li a, div.topPic a[title], ul.nypicList li a[title], div.topVid a[title], ul.nyvidList li a[title]`).slice(0,m).toArray().map(e=>{e=v(e);let i=e.find(`div.img img`);return{title:e.prop(`title`)??e.find(`h4.eclips`).text(),link:new URL(e.prop(`href`),h).href,pubDate:n(e.find(`time`).text(),[`YYYY.MM.DD`,`DDYYYY.MM`]),description:t(l.join(r,`templates/description-9e3ccd8d.art`),{description:e.find(`div.txt p`).html(),image:i.prop(`src`)?{src:new URL(i.prop(`src`),h).href,alt:i.prop(`alt`)}:void 0})}});y=await s(y,e.tryGet,h);let b=c(_),x=o(b,`SiteName`),S=o(b,`ColumnName`),C=new URL(v(`link[rel="shortcut icon"]`).prop(`href`),h).href;return{item:y,title:`${x} - ${S}`,link:g,description:o(b,`description`),language:v(`html`).prop(`lang`),image:new URL(v(`div.logo img`).prop(`src`),h).href,icon:C,logo:C,subtitle:S,author:x,allowEmpty:!0}}export{d as route};