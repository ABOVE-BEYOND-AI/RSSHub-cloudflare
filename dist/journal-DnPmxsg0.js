import"./config-HRWLmo66.js";import"./logger-DHpG8Bim.js";import"./helpers-LVq640iW.js";import{cache_default as e}from"./cache-C3AIQtoX.js";import{art as t}from"./render-DE4LRFBD.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import"./ofetch-DRl42yaJ.js";import{__dirname as r}from"./esm-shims-BDPl6Msv.js";import{got_default as i}from"./got-BaOFZRd4.js";import{timezone as a}from"./timezone-BrxBCotj.js";import o from"node:path";import{load as s}from"cheerio";const c={path:`/journal/:id/:category?`,categories:[`journal`],example:`/rsc/journal/ta`,parameters:{id:`Journal id, can be found in URL`,category:`Category, see below, All Recent Articles by default`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Journal`,maintainers:[`nczitzk`],handler:l,description:`::: tip
  All journals at [Current journals](https://pubs.rsc.org/en/journals)
:::

| All Recent Articles | Advance Articles |
| ------------------- | ---------------- |
| allrecentarticles   | advancearticles  |`};async function l(c){let{id:l,category:u=`allrecentarticles`}=c.req.param(),d=c.req.query(`limit`)?Number.parseInt(c.req.query(`limit`),10):50,f=`https://pubs.rsc.org`,p=new URL(`en/journals/journalissues/${l}#!recentarticles`,f).href,m=new URL(`en/journals/getrecentarticles`,f).href,{data:h}=await i.post(m,{form:{name:l,pageno:1,iscontentavailable:!0,category:u}}),g=s(h);g(`div.capsule__article-image`).each(function(){g(this).replaceWith(t(o.join(r,`templates/image-8ef00cc6.art`),{image:g(this).find(`img`).prop(`data-original`)}))});let _=g(`div.capsule--article`).slice(0,d).toArray().map(e=>{e=g(e);let t=e.find(`div.article__authors`).text().trim(),r=e.find(`div.text--small span a`).text().split(/org\//).pop(),i=!!e.find(`span.capsule__context img.ver-t`).prop(`alt`),o=!!e.find(`span.capsule__context span`).text(),s=new URL(e.find(`div.capsule__action--buttons a`).prop(`href`).split(`?`).pop(),f).href;return{title:e.find(`h3.capsule__title`).text(),link:new URL(e.find(`a.capsule__action`).prop(`href`),f).href,description:e.find(`div.capsule__column-wrapper`).html(),author:t,category:[e.find(`span.capsule__context`).text().trim(),...t.split(/,\s|and\s/),i||o],guid:`rsc-${r}`,pubDate:a(n(e.find(`div.text--small span.block`).text().split(/on\s/).pop(),`DD MMM YYYY`),1),enclosure_url:s,enclosure_type:s?`application/pdf`:void 0,doi:r}});_=await Promise.all(_.map(t=>e.tryGet(t.guid,async()=>{if(t.category.pop()){let{data:e}=await i(t.link.replace(/\/articlelanding\//,`/articlehtml/`)),r=s(e);r(`#pnlArticleAccess, #pnlArticleContent`).remove(),r(`div.abstract, div.article-abstract__heading`).prevAll().remove(),t.title=r(`meta[name="DC.title"]`).prop(`content`),t.description=r(`#wrapper, article.article-control`).html(),t.pubDate=a(n(r(`meta[name="citation_online_date"]`).prop(`content`),`YYYY/MM/DD`),1),t.enclosure_url=r(`meta[name="citation_pdf_url"]`).prop(`content`),t.enclosure_type=t.enclosure_url?`application/pdf`:void 0,t.doi=r(`meta[name="DC.Identifier"]`).prop(`content`)}return t})));let{data:v}=await i(p);g=s(v);let y=new URL(g(`link[rel="apple-touch-icon"]`).prop(`href`),f).href;return{item:_,title:g(`meta[name="citation_title"]`).prop(`content`),link:p,description:g(`meta[property="og:description"]`).prop(`content`),language:`en`,image:new URL(g(`div.page-head__cell--image span img`).prop(`src`),f).href,icon:y,logo:y,subtitle:g(`title`).text(),author:g(`meta[name="citation_journal_abbrev"]`).prop(`content`),allowEmpty:!0}}export{c as route};